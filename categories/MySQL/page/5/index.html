<!doctype html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8">
    <meta name="baidu-site-verification" content="dIcXMeY8Ya">
    
    <title>`MySQL`分类下的文章 | 软件开发吧</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="keywords" content="Jelon, 前端, Web, 张德龙, 前端开发">
    <meta name="description" content="Jelon个人前端小站">

    
    <link rel="alternative" href="/atom.xml" title="软件开发吧" type="application/atom+xml">
    
    
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->
    
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?fd459238242776d173cdc64918fb32f2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</head>
</html>
<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">软件开发吧</span>
                    <span class="description"></span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/categories/MySQL/page/5/index.html" class="item ">
                <a href="/" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="/categories/MySQL/page/5/index.html" class="item ">
                <a href="/lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="/categories/MySQL/page/5/index.html" class="item ">
                <a href="/about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="/categories/MySQL/page/5/index.html" class="item ">
                <a href="/comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/jangdelong" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="http://weibo.com/jangdelong" class="sinaweibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href="https://www.facebook.com/profile.php?id=100011855760219&amp;ref=bookmarks" class="qqweibo" target="_blank"><b>■</b> Facebook</a>
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="/img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon">
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章分类 -->

    <h3 class="widget-hd">
        <strong>
            
                `MySQL`分类下的文章
            
        </strong>
    </h3>
    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/24/2019030500111/">
    		MySQL 高可用架构在业务层面的分析研究
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-24T07:28:29.000Z">2015-11-24</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><strong>前言：</strong> 相对于传统行业的相对服务时间9x9x6或者9x12x5，因为互联网电子商务以及互联网游戏的实时性，所以服务要求7<em>24小时，业务架构不管是应用还是数据库，都需要容灾互备，在mysql的体系中，最好通过在最开始阶段的数据库架构阶段来实现容灾系统。所以这里从业务宏观角度阐述下mysql架构的方方面面。 <strong>一. MySQL架构设计—业务分析</strong> （1）读多写少 虚线表示跨机房部署，比如电子商务系统，一个Master既有读也有些写，对读数据一致性需要比较重要的，读要放在Master上面。 M(R)仅仅是一个备库，只有M(WR)挂了之后，才会切换到M(R)上，这个时候M(R)就变成了读写库。比如游戏系统，有很多Salve会挂载后面一个M(R)上面。 （2）读多写少MMS-电商 如果是电子商务类型的，这种读多写少的，一般是1个master拖上4到6个slave，所有slave挂载在一个master也足够了。 切换的时候，把M1的读写业务切换到M2上面，然后把所有M1上的slave挂到M2上面去，如下所示：<img src="/uploads/2015/11/26230597_14125236608Q14.png" alt> （3）读多写少MMSS-游戏 如果是游戏行业的话，读非常多蛮明显的，会出现一般1个Master都会挂上10个以上的Slave的情况，所以这个时候，可以把一部分Slave挂载新的M(R)上面。至少会减少一些压力，这样至少服务器挂掉的时候，不会对所有的slave有影响，还有一部分在M(R)上的slave在继续，不会对所有的slave受到影响，见图3，<img src="/uploads/2015/11/26230597_14125236982QDx.png" alt> 图3 （4）读少写多 意味着读并不会影响写的效率，所以读写都可以放在一个M1(WR)，而另外一个不提供读也不提供写，只提供standby冗余异地容灾。<img src="/uploads/2015/11/26230597_1412523725kDa3.png" alt> 这个异地容灾是非常重要的，否则如果是单机的，单边的业务，万一idc机房故障了，一般就会影响在线业务的，这种 造成业务2小时无法应用，对于在线电子商务交易来说，影响是蛮大的，所以为了最大限度的保证7</em>24小时，必须要做到异地容灾，MM要跨idc机房。虽然对资源有一些要求，但是对HA来说是不可缺少的，一定要有这个MM机制。 做切换的时候，把所有的读写从M1直接切换到M2上就可以了。<img src="/uploads/2015/11/26230597_1412523759LF7F.png" alt> （5）读写平分秋色 读和写差不多，但是读不能影响写的能力，把读写放在M1(WR)上，然后把一部分读也放在M2(R)上面，当然M1和M2也是跨机房部署的。 切换的时候，把一部分读和全部写从M1切换到M2上就可以了。 <strong>二. MySQL架构设计—常见架构</strong> （1）强一致性 对读一致性的权衡，如果是对读写实时性要求非常高的话，就将读写都放在M1上面，M2只是作为standby，就是采取和上面的一（4）的读少写多的一样的架构模式。 比如，订单处理流程，那么对读需要强一致性，实时写实时读，类似这种涉及交易的或者动态实时报表统计的都要采用这种架构模式<img src="/uploads/2015/11/26230597_1412523786141I.png" alt> （2）弱一致性 如果是弱一致性的话，可以通过在M2上面分担一些读压力和流量，比如一些报表的读取以及静态配置数据的读取模块都可以放到M2上面。比如月统计报表，比如首页推荐商品业务实时性要求不是很高，完全可以采用这种弱一致性的设计架构模式。<img src="/uploads/2015/11/26230597_1412523811aApV.png" alt> （3）中间一致性 如果既不是很强的一致性又不是很弱的一致性，那么我们就采取中间的策略，就是在同机房再部署一个S1(R)，作为备库，提供读取服务，减少M1(WR)的压力，而另外一个idc机房的M2只做standby容灾方式的用途。 当然这里会用到3台数据库服务器，也许会增加采购压力，但是我们可以提供更好的对外数据服务的能力和途径，实际中尽可能两者兼顾。 <img src="/uploads/2015/11/26230597_1412523913ceoM.png" alt> （4）统计业务 比如PV、UV操作、页数的统计、流量的统计、数据的汇总等等，都可以划归为统计类型的业务。 数据库上做大查询的统计是非常消耗资源的。统计分为实时的统计和非实时的统计，由于mysql主从是逻辑sql的模式，所以不能达到100%的实时，如果是online要严格的非常实时的统计比如像火车票以及金融异地结算等的统计，mysql这块不是它的强项，就只有查询M1主库来实现了。 A，但是对于不是严格的实时性的统计，mysql有个很好的机制是binlog，我们可以通过binlog进行解析Parser，解析出来写入统计表进行统计或者发消息给应用端程序来进行统计。这种是准实时的统计操作，有一定的短暂的可接受的统计延迟现象，如果要100%实时性统计只有查询M1主库了。 通过binlog的方式实现统计，在互联网行业，尤其是电商和游戏这块，差不多可以解决90%以上的统计业务。有时候如果用户或者客户提出要实时read-time了，大家可以沟通一下为什么需要实时，了解具体的业务场景，有些可能真的不需要实时统计，需要有所权衡，需要跟用户和客户多次有效沟通，做出比较适合业务的统计架构模型。 B，还有一种offline统计业务，比如月份报表年报表统计等，这种完全可以把数据放到数据仓库里面或者第三方Nosql里面进行统计。 <img src="/uploads/2015/11/26230597_1412523957JKio.png" alt> （5）历史数据迁移 历史数据迁移，需要尽量不影响现在线上的业务，尽量不影响现在线上的查询写入操作，为什么要做历史数据迁移？因为有些业务的数据是有时效性的，比如电商中的已经完成的历史订单等，不会再有更新操作了，只有很简单的查询操作，而且查询也不会很频繁，甚至可能一天都不会查询一次。 如果这时候历史数据还在online库里面或者online表里面，那么就会影响online的性能，所以对于这种，可以把数据迁移到新的历史数据库上，这个历史数据库可以是mysql也可以是nosql，也可以是数据仓库甚至hbase大数据等。 实现途径是通过slave库查询出所有的数据，然后根据业务规则比如时间、某一个纬度等过滤筛选出数据，放入历史数据库(History Databases)里面。迁移完了，再回到主库M1上，删除掉这些历史数据。这样在业务层面，查询就要兼顾现在实时数据和历史数据，可以在filter上面根据迁移规则把online查询和history查询对接起来。比如说一个月之内的在online库查询一个月之前的在history库查询，可以把这个规则放在DB的迁移filter层和应用查询业务模块层。如果可以的话，还可以配置更细化，通过应用查询业务模块层来影响DB的迁移filter层，比如以前查询分为一个月为基准，现在查询业务变化了，以15天为基准，那么应用查询业务模块层变化会自动让DB的filter层也变化，实现半个自动化，更加智能一些。 <img src="/uploads/2015/11/26230597_1412524001L6F6.png" alt> （6）MySQL Sharding 像oracle这种基于rac基于共享存储的方式，不需要sharding只需要扩从rac存储就能实现了。但是这种代价相对会比较高一些，共享存储一般都比较贵，随着业务的扩展数据的爆炸式增长，你会不停累计你的成本，甚至达到一个天文数字。 目前这种share disk的方式，除了oracle的业务逻辑层做的非常完善之外其他的解决方案都还不是很完美。 Mysql的sharding也有其局限性，sharding之后的数据查询访问以及统计都会有很大的问题，mysql的sharding是解决share nothing的存储的一种分布式的方法，大体上分为垂直拆分和水平拆分。 （6.1）垂直拆分 可以横向拆分，可以纵向拆分，可以横向纵向拆分，还可以按照业务拆分。 6.1.1横向拆分 Mysql库里面的横向拆分是指，每一个数据库实例里面都有很多个db库，每一个db库里面都有A表B表，比如db1库有A表B表，db2库里也有A表和B表，那么我们把db1、db2库的A表B表拆分出来，把一个库分成2个，就拆分成db1、db2、db3、db4，其中db1库和db2库放A表数据，db3库和db4库放B表的数据，db1、db2库里面只有A表数据，db3、db4库里面只有B表的数据。 打个比方，作为电商来说，每个库里面都有日志表和订单表，假如A表是日志表log表，B表是订单表Order表，一般说来写日志和写订单没有强关联性，我们可以讲A表日志表和B表订单表拆分出来。那么这个时候就做了一次横向的拆分工作，将A表日志表和B表订单表拆分开来放在不同的库，当然A表和B表所在的数据库名也可以保持一致(PS：在不同的实例里面)，如下图所示： <img src="/uploads/2015/11/26230597_1412524048ma3Z.png" alt> PS：这种拆分主要针对于不同的业务对表的影响不大，表之间的业务关联很弱或者基本上没有业务关联。拆分的好处是不相关的数据表拆分到不同的实例里面，对数据库的容量扩展和性能提高的均衡来说，都是蛮有好处的。 6.1.2纵向拆分 把同一个实例上的不同的db库拆分出来，放入单独的不同实例中。这种拆分的适应场景和要求是db1和db2是没有多少业务联系的，类似6.1.2里面的A表和B表那样。如果你用到了跨库业务同时使用db1和db2的话，个人建议要重新考虑下业务，重新梳理下尽量把一个模块的表放在一个库里面，不要垮库操作。 这种库纵向拆分里面，单独的库db1，表A和表B是强关联的。如下图所示： <img src="/uploads/2015/11/26230597_1412524091tz9A.png" alt> PS：看到很多使用mysql的人，总是把很多没有业务关联性的表放在一个库里面，或者总是把很多个的db库放在同一个实例里面，就像使用oracle那样就一个instance的概念而已。Mysql的使用一大原则就是简单，尽量单一，简单的去使用mysql，库要严格的分开；表没有关系的，要严格拆分成库。这样的话扩展我们的业务就非常方便简单了，只需要把业务模块所在的db拆分出来，放入新的数据库服务器上即可。 6.1.3横向纵向拆分 有些刚起步的，开始为了快速出产品，就把所以的库所有的表都放在一个实例上，等业务发展后，就面临着数据拆分，这里就会把横向纵向拆分结合起来，一起实现，如下图所示： <img src="/uploads/2015/11/26230597_1412524129f4bF.png" alt> 6.1.4业务拆分 跟水平拆分有点类似，但是有不同的地方。比如一个供应商，可能整个网站上有10个供应商，一个网站上面每一个供应商都有一定的量，而且供应商之间的数据量规模都差不多的规模，那么这个时候就可以使用供应商的纬度来做拆分。 比如usern库中，a、b、c表都是强关联的，都有完整的业务逻辑存在，这里只有用户（供应商）纬度是没有关联的，那这个时候就可以把数据以用户的纬度来进行拆分。 就是用户1和用户2各自都有一套完整的业务逻辑，而且彼此之间不关联，所以就可以把用户1和用户2数据拆分到不同的数据库实例上面。目前很多互联网公司或者游戏公司有很多业务都是以用户纬度进行拆分的，比如qunaer、sohu game、sina等。 <img src="/uploads/2015/11/26230597_1412524160Vz9P.png" alt> （6.2） 水平拆分 水平拆分相对要简单一些，但是难度偏大，会导致分布式的情况、跨数据的情况、跨事务的情况可以分为大概三类，1是历史数据和实时数据拆分，2是单库多表拆分，3是多库多表拆分。 <strong>　　6.2.1实时数据历史数据的拆分</strong> 和历史数据迁移是一样的逻辑，就是要将online库的数据迁移到listory的数据库里面，对于实时的读写来说，数据是放在online db库里面，对于时间较远的数据来说，是放在历史History DB记录库里面的，这里的历史库可以是mysql也可以是别的nosql库等。 <img src="/uploads/2015/11/26230597_1412524200g5G6.png" alt> <strong>　　6.2.2单库多表拆分</strong> 主要不是解决容量问题，而是解决性能问题而扩展的，加入当前实例只有一个DB，有一个大表，一个大表就把整个实例占满了，这个时候就不能拆分db了，因为只有一个单表，这个时候我们就只能拆表了，拆表的方式主要是解决性能问题，因为单个表越大，对于mysql来说遍历表的树形结构遍历数据会消耗更多的资源，有时候一个简单的查询就可能会引起整个db的很多叶子节点都要变动。表的insert、update、delete操作都会引起几乎所有节点的变更，此时操作量会非常大，操作的时候读写性能都会很低，这个时候我们就可以考虑把大表拆分成多个小表，工作经历中是按照hash取模打散成16个小表，也有按照id主键/50取模打散到50个小表当中，下图实例是打散成2个小表。 <img src="/uploads/2015/11/26230597_1412524223NCxs.png" alt> <strong>　　6.2.3多库多表拆分</strong> 在单库多表的基础上，如果单库空间资源已经不足以提供业务支撑的话，可以考虑多库多表的方式来做，解决了空间问题和性能问题，不过会有一个问题就是跨库查询操作，查询就会有另外的策略，比如说加一个logic db层来实现跨库跨实例自动查询，简单如下图所示： <img src="/uploads/2015/11/26230597_1412524249tDq8.png" alt> <strong>　　6.2.4水平拆分小结</strong> 水平拆分原则： -- a.尽量均匀的拆分维度。 – b.尽量避免跨库事务。 – c.尽量避免跨库查询。 设计： –a根据拆分维度，做mod进行数据表拆分，大部分都是取模的拆分机制，比如hash的16模原则等。 –b根据数据容量，划分数据库拆分 数据操作 –a跨事务操作：分布式事务，通过预写日志的方式来间接地实现。 –b跨库查询：数据汇总or消息服务 <strong>　　6.2.5案例说明</strong> u 案例： – 按照用户维度进行拆分成64个分库，1024个分表 ?user_id%1024拆分到1024张分表中 ? 每个分库中存放1024/64张分表 ? 取模的时候，可以用id的最后4位数据或者3位数字来取模就可以了。 <img src="/uploads/2015/11/26230597_1412524295NgP6.png" alt> u 操作1：采用Configure DB – 拆分之后的查询操作，做一个Configure DB，这个DB存放的是所有实例的库表的映射关系，当我APP发来有一个请求查询user1的数据，那么这个user1的数据是存放在上千个实例中的哪一个库表呢？这个关联信息就在Configure DB里面，APP先去Configure DB里面取得user1的关联系信息(比如是存放在d_01库上的t_0016表里面)，然后APP根据关联信息直接去查询对应的d_01实例的t_0016表里面取得数据。 <img src="/uploads/2015/11/26230597_1412524329zfFY.png" alt> u 操作2：采用Proxy – 拆分之后的查询操作，做一个Proxy，APP访问Proxy，Proxy根据访问规则就可以直接路由到具体的db实例，生成新的sql去操作对应的db实例，然后通过Proxy协议进行操作把操作结果返回给APP。 – 优势是Proxy和db实例是在一个网段，这样Proxy与db实例的操作的时间是非常短的。 <img src="/uploads/2015/11/26230597_1412524367P848.png" alt> u 操作3：采用Data Engine – 拆分之后的查询操作，有一个Data Engine Service，这个DES里面配置了所有数据库实例的映射关系，需要在APP应用端安装一个Agent，是同步逻辑，在JDBC层实现，DES可以实现读写分离，原理可以参考TDDL的实现。 <img src="/uploads/2015/11/26230597_1412524397urm8.png" alt> <strong>　　6.3集群管理</strong> 纵向扩容：一个实例拆分成多个实例，纵向拆分比较简单，修改的东西比较少，拆分的时候要通知到Configure DB或者DES，以免拆分之后查询不到数据或者数据录入不到新的db上面，如下图所示： <img src="/uploads/2015/11/26230597_14125244398C03.png" alt> 横向扩容：比较复杂，在纵向扩容成2个库的基础之上，再一次对库的表进行扩容，所以需要及时通知Configure DB和DES更细库和表的路由连接信息。 <img src="/uploads/2015/11/26230597_1412524468uW2X.png" alt></p>

            
            <p class="more">
                <a href="/2015/11/24/2019030500111/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/24/2019030500111/" title="MySQL 高可用架构在业务层面的分析研究">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/4.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/24/2019030500121/">
    		Mysql:is not allowed to connect to this MySQL server
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-24T06:22:41.000Z">2015-11-24</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>Mysql:is not allowed to connect to this MySQL server</p>
<p>如果你想连接你的mysql的时候发生这个错误： ERROR 1130: Host ‘192.168.1.1’ is not allowed to connect to this MySQL server 解决方法： 1。 改表法。可能是你的帐号不允许从远程登陆，只能在localhost。这个时候只要在localhost的那台电脑，登入mysql后，更改 “mysql” 数据库里的 “user” 表里的 “host” 项，从”localhost”改称”%” mysql -u root -pvmwaremysql&gt;use mysql;mysql&gt;update user set host = ‘%’ where user = ‘root’;mysql&gt;select host, user from user; 2. 授权法。例如，你想myuser使用mypassword从任何主机连接到mysql服务器的话。 GRANT ALL PRIVILEGES ON <em>.</em> TO ‘myuser‘@’%’ IDENTIFIED BY ‘mypassword’ WITH GRANT OPTION; 如果你想允许用户myuser从ip为192.168.1.1的主机连接到mysql服务器，并使用123456作为密码 GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root‘@’192.168.1.1’ IDENTIFIED BY ‘123456’ WITH GRANT OPTION;</p>

            
            <p class="more">
                <a href="/2015/11/24/2019030500121/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/24/2019030500121/" title="Mysql:is not allowed to connect to this MySQL server">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/4.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/09/2019030500062/">
    		MySQL 5.6关闭DNS查询
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-09T09:07:50.000Z">2015-11-09</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>MySQL服务器的日志记录中看到如下的警告：</p>
<pre><code>2015-11-09 08:37:02 1489 [Warning] IP address &apos;104.223.72.XXX&apos; has been resolved to the host name &apos;104.223.72.XXX.static.quadranet.com&apos;, which resembles IPv4-address itself.
</code></pre><p>分析：104.223.72.XXX经查询，是美国的IP地址，国内有XX防火墙阻拦，DNS解析不了很正常。由于MySQL服务器在内存中维持了一个Host缓存，用于存储客户端的信息，包括：IP地址、Host主机名、错误信息等。对于非本地的TCP连接，MySQL服务器都会查询此缓存。对于使用本地环回地址（比如：127.0.0.1或者::1）的TCP连接、或者是使用Unix套接字文件的TCP连接、命名管道的TCP连接、共享内存的TCP连接，都不会使用Host缓存。 注：Loopback，本地环回接口（或地址），亦称回送地址。此类接口是应用最为广泛的一种虚接口，几乎在每台路由器上都会使用。在Windows系统中，采用127.0.0.1作为本地环回地址。 对于每一个新的客户端连接，MySQL服务器使用客户端的IP地址进行检索，查看客户端的主机名是否在Host缓存中。如果Host缓存中不存在，MySQL服务器会尝试解析主机名。首先，MySQL服务器会解析主机名对应的IP地址，并与客户端的原始IP地址进行比较，确保是同一个IP地址。然后MySQL服务器把这些信息写入Host缓存中。如果Host缓存已满，MySQL服务器会使用最近最少使用算法，删除部分缓存数据。 MySQL服务器执行主机名解析使用了线程安全的gethostbyaddr_r()函数调用和gethostbyname_r()函数调用，只要操作系统支持。否则，执行查找的线程会锁定一个互斥变量，再调用gethostbyaddr()函数和gethostbyname()函数。在这种情况下，如果主机名不在缓存中，也没有别的线程能解析主机名，必须等到互斥变量被释放后才可以。 MySQL服务器使用Host缓存主要有几个目的： 1）通过缓存的IP和主机名的对应关系，避免了对于客户端的每个连接都要做DNS查询。相反，对于给定的主机，只需针对首次连接进行DNS查询。 2）Host缓存中还保护了连接过程中发生的错误信息。有些错误可能是“阻塞”信息，对于给定的客户端如果连续出现这种信息，那么服务器会阻塞来自此客户端的进一步的连接。MySQL的系统变量max_connect_errors就描述了这种情况，意思是MySQL服务器在阻塞客户端连接之前允许客户端连接错误的次数。 要解除已经被阻塞的主机，需要刷新Host缓存，执行语句：</p>
<pre><code>mysql&gt; flush hosts
</code></pre><p>或者是在Shell环境下执行：</p>
<pre><code># mysqladmin flush-hosts
</code></pre><p>Host缓存在MySQL中是默认开启的，要关闭Host缓存，可以在启动MySQL时添加–skip-host-cache参数选项。 要禁用DNS主机名查找，可以在启动MySQL时添加–skip-name-resolve参数选项。在这种情况下，MySQL服务器会只使用IP地址来匹配连接。如果DNS查询很慢，或者是客户端非常多，那么关闭DNS查询可以改进MySQL服务器的性能。 解决办法： 修改my.cnf配置文件，找到[mysqld]处，添加：</p>
<pre><code>skip-name-resolve
</code></pre><p>再重启MySQL服务。 证明：</p>
<pre><code>mysql&gt; show variables like &quot;%skip%&quot;;
+------------------------+-------+
| Variable_name          | Value |
+------------------------+-------+
| skip_external_locking  | ON    |
| skip_name_resolve      | ON    |
| skip_networking        | OFF   |
| skip_show_database     | OFF   |
| slave_skip_errors      | OFF   |
| sql_slave_skip_counter | 0     |
+------------------------+-------+
6 rows in set (0.00 sec)
</code></pre>
            
            <p class="more">
                <a href="/2015/11/09/2019030500062/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/09/2019030500062/" title="MySQL 5.6关闭DNS查询">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/9.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/06/2019030500082/">
    		mysql 学习记录（三）--字段
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-06T04:35:55.000Z">2015-11-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <ol>
<li>1.填充字段</li>
<li>mysql&gt; create database test1;</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; use test1;</p>
</li>
<li>Database changed</li>
<li>mysql&gt; create table t1(id1 int,id2 int(5));</li>
<li><p>Query OK, 0 rows affected (0.06 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+</li>
<li>| id1  | id2  |</li>
<li>+——+——+</li>
<li>|    1 |    1 |</li>
<li>+——+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t1 modify id1 int zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id2 int(5) zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+————+——-+</li>
<li>| id1        | id2   |</li>
<li>+————+——-+</li>
<li>| 0000000001 | 00001 |</li>
<li>+————+——-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1111111);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+————+———+</li>
<li>| id1        | id2     |</li>
<li>+————+———+</li>
<li>| 0000000001 |   00001 |</li>
<li>| 0000000001 | 1111111 |</li>
<li>+————+———+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>2.自增长字段的建立</p>
</li>
<li>mysql&gt; create table ai1(id int auto_increment not null primary key);</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; create table ai2(id int auto_increment not null,primary key(id));</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; create table ai3(id int auto_increment not null,unique(id));</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>3.带小数的字段设置</p>
</li>
<li>mysql&gt; alter table t1 rename t1_test;</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t1_test;</p>
</li>
<li>+——-+—————————+——+—–+———+——-+</li>
<li>| Field | Type                      | Null | Key | Default | Extra |</li>
<li>+——-+—————————+——+—–+———+——-+</li>
<li>| id1   | int(10) unsigned zerofill | YES  |     | NULL    |       |</li>
<li>| id2   | int(5) unsigned zerofill  | YES  |     | NULL    |       |</li>
<li>+——-+—————————+——+—–+———+——-+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t1( id1 float(5,2) default null, id2 double(5,2) default null, id3 decimal(5,2) default null);</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.23,1.23,1.23);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.234,1.234,1.23);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.234,1.234,1.234);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t1 modify id1 float;</p>
</li>
<li>Query OK, 0 rows affected (0.02 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id2 double;</p>
</li>
<li>Query OK, 0 rows affected (0.01 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id3 decimal;</p>
</li>
<li>Query OK, 3 rows affected, 3 warnings (0.04 sec)</li>
<li><p>Records: 3  Duplicates: 0  Warnings: 3</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.234,1.234,1.234);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li>+——-+——+——————————————+</li>
<li>| Level | Code | Message                                  |</li>
<li>+——-+——+——————————————+</li>
<li>| Note  | 1265 | Data truncated for column ‘id3’ at row 1 |</li>
<li>+——-+——+——————————————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——-+——-+——+</li>
<li>| id1   | id2   | id3  |</li>
<li>+——-+——-+——+</li>
<li>|  1.23 |  1.23 |    1 |</li>
<li>|  1.23 |  1.23 |    1 |</li>
<li>|  1.23 |  1.23 |    1 |</li>
<li>| 1.234 | 1.234 |    1 |</li>
<li>+——-+——-+——+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t2(id bit(1));</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t2;</p>
</li>
<li>+——-+——–+——+—–+———+——-+</li>
<li>| Field | Type   | Null | Key | Default | Extra |</li>
<li>+——-+——–+——+—–+———+——-+</li>
<li>| id    | bit(1) | YES  |     | NULL    |       |</li>
<li>+——-+——–+——+—–+———+——-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t2 values(1);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select bin(id),hex(id) from t2;</p>
</li>
<li>+———+———+</li>
<li>| bin(id) | hex(id) |</li>
<li>+———+———+</li>
<li>| 1       | 1       |</li>
<li>+———+———+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t2 values(2);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.00 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li>+———+——+———————————————+</li>
<li>| Level   | Code | Message                                     |</li>
<li>+———+——+———————————————+</li>
<li>| Warning | 1264 | Out of range value for column ‘id’ at row 1 |</li>
<li>+———+——+———————————————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t2 modify id bit(2);</p>
</li>
<li>Query OK, 2 rows affected (0.04 sec)</li>
<li><p>Records: 2  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; insert into t2 values(2);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select bin(id),hex(id) from t2;</p>
</li>
<li>+———+———+</li>
<li>| bin(id) | hex(id) |</li>
<li>+———+———+</li>
<li>| 1       | 1       |</li>
<li>| 1       | 1       |</li>
<li>| 10      | 2       |</li>
<li>+———+———+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t(d date,t time ,dt datetime);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———-+——+—–+———+——-+</li>
<li>| Field | Type     | Null | Key | Default | Extra |</li>
<li>+——-+———-+——+—–+———+——-+</li>
<li>| d     | date     | YES  |     | NULL    |       |</li>
<li>| t     | time     | YES  |     | NULL    |       |</li>
<li>| dt    | datetime | YES  |     | NULL    |       |</li>
<li>+——-+———-+——+—–+———+——-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>4.与时间有关的字段设置</p>
</li>
<li>mysql&gt; insert into t values(now(),now(),now());</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+————+———-+———————+</li>
<li>| d          | t        | dt                  |</li>
<li>+————+———-+———————+</li>
<li>| 2015-10-02 | 06:04:42 | 2015-10-02 06:04:42 |</li>
<li>+————+———-+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_test;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; create table t(id1 timestamp);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———–+——+—–+——————-+—————————–+</li>
<li>| Field | Type      | Null | Key | Default           | Extra                       |</li>
<li>+——-+———–+——+—–+——————-+—————————–+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |</li>
<li>+——-+———–+——+—–+——————-+—————————–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t values(null);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+</li>
<li>| id1                 |</li>
<li>+———————+</li>
<li>| 2015-10-02 06:05:20 |</li>
<li>+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t add id2 timestamp;</p>
</li>
<li>Query OK, 1 row affected (0.04 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; show create table t \G;</p>
</li>
<li><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></li>
<li>Table: t</li>
<li>Create Table: CREATE TABLE `t` (</li>
<li>`id1` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</li>
<li>`id2` timestamp NOT NULL DEFAULT ‘0000-00-00 00:00:00’</li>
<li>) ENGINE=InnoDB DEFAULT CHARSET=utf8</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>ERROR:</p>
</li>
<li><p>No query specified</p>
</li>
<li><p>mysql&gt; create table t8( id1 timestamp not null default current_timestamp, id2 datetime default null );</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; show variables like ‘time_zone’;</p>
</li>
<li>+—————+——–+</li>
<li>| Variable_name | Value  |</li>
<li>+—————+——–+</li>
<li>| time_zone     | SYSTEM |</li>
<li>+—————+——–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t8 ;</p>
</li>
<li><p>Empty set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t8 values(now(),now());</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t8;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 06:07:16 | 2015-10-02 06:07:16 |</li>
<li>+———————+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; set time_zone=’+9:00’;</p>
</li>
<li><p>Query OK, 0 rows affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t8;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:07:16 | 2015-10-02 06:07:16 |</li>
<li>+———————+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; desc t8;</p>
</li>
<li>+——-+———–+——+—–+——————-+——-+</li>
<li>| Field | Type      | Null | Key | Default           | Extra |</li>
<li>+——-+———–+——+—–+——————-+——-+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP |       |</li>
<li>| id2   | datetime  | YES  |     | NULL              |       |</li>
<li>+——-+———–+——+—–+——————-+——-+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| Field | Type      | Null | Key | Default             | Extra                       |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP   | on update CURRENT_TIMESTAMP |</li>
<li>| id2   | timestamp | NO   |     | 0000-00-00 00:00:00 |                             |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) values(‘19700101080001’);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) values(19700101080001);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) values(19700101080000);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li><p>Empty set (0.00 sec)</p>
</li>
<li><p>mysql&gt; desc t1;</p>
</li>
<li>+——-+—————+——+—–+———+——-+</li>
<li>| Field | Type          | Null | Key | Default | Extra |</li>
<li>+——-+—————+——+—–+———+——-+</li>
<li>| id1   | float         | YES  |     | NULL    |       |</li>
<li>| id2   | double        | YES  |     | NULL    |       |</li>
<li>| id3   | decimal(10,0) | YES  |     | NULL    |       |</li>
<li>+——-+—————+——+—–+———+——-+</li>
<li><p>3 rows in set (0.01 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| Field | Type      | Null | Key | Default             | Extra                       |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP   | on update CURRENT_TIMESTAMP |</li>
<li>| id2   | timestamp | NO   |     | 0000-00-00 00:00:00 |                             |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) value(‘2038-01-19 11:14:07’);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:07 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) value(‘2038-01-19 11:14:08’);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:07 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:08 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) value(‘2097-01-19 11:14:08’);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:07 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:08 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>7 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_date;</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; create table t(y year);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| Field | Type    | Null | Key | Default | Extra |</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| y     | year(4) | YES  |     | NULL    |       |</li>
<li>+——-+———+——+—–+———+——-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t values(2100);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+——+</li>
<li>| y    |</li>
<li>+——+</li>
<li>| 2100 |</li>
<li>+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t6(dt datetime);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(‘2007-9-3 12:10:10’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(‘2007/9/3 12+10+10’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(‘20070903121010’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(20070903121010);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t6;</p>
</li>
<li>+———————+</li>
<li>| dt                  |</li>
<li>+———————+</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>+———————+</li>
<li><p>4 rows in set (0.01 sec)</p>
</li>
<li><p>5.varchar与char字段的长度</p>
</li>
<li>mysql&gt; create table vc(v varchar(4),c char(4));</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into vc values(‘ab ‘,’ab     ‘);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select length(v),length(c) from vc;</p>
</li>
<li>+———–+———–+</li>
<li>| length(v) | length(c) |</li>
<li>+———–+———–+</li>
<li>|         3 |         2 |</li>
<li>+———–+———–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select concat(v,’+’),concat(c,’+’) from vc;</p>
</li>
<li>+—————+—————+</li>
<li>| concat(v,’+’) | concat(c,’+’) |</li>
<li>+—————+—————+</li>
<li>| ab +          | ab+           |</li>
<li>+—————+—————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; drop table t;</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; create table t (c binary(3));</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into t set c=’a’;</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select *,hex(c),c=’a’,c=’a\0’,c=’a\0\0’ from t;</p>
</li>
<li>+——+——–+——-+———+———–+</li>
<li>| c    | hex(c) | c=’a’ | c=’a\0’ | c=’a\0\0’ |</li>
<li>+——+——–+——-+———+———–+</li>
<li>| a    | 610000 |     0 |       0 |         1 |</li>
<li>+——+——–+——-+———+———–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_binary;</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>6.枚举型字段</p>
</li>
<li>mysql&gt; create table t(gender enum(‘M’,’F’));</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into t values(‘m’),(‘1’),(‘f’),(null);</p>
</li>
<li>Query OK, 4 rows affected (0.01 sec)</li>
<li><p>Records: 4  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+——–+</li>
<li>| gender |</li>
<li>+——–+</li>
<li>| M      |</li>
<li>| M      |</li>
<li>| F      |</li>
<li>| NULL   |</li>
<li>+——–+</li>
<li><p>4 rows in set (0.01 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_enum;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>7.set类型字段设置</p>
</li>
<li>mysql&gt; create table t(col set (‘a’,’b’,’c’,’d’ ));</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; insert into t value(‘a,b’),(‘a,d,a’),(‘a,b’),(‘a,c’),(‘a’);</p>
</li>
<li>Query OK, 5 rows affected (0.01 sec)</li>
<li><p>Records: 5  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+——+</li>
<li>| col  |</li>
<li>+——+</li>
<li>| a,b  |</li>
<li>| a,d  |</li>
<li>| a,b  |</li>
<li>| a,c  |</li>
<li>| a    |</li>
<li>+——+</li>
<li>5 rows in set (0.00 sec)</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/06/2019030500082/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/06/2019030500082/" title="mysql 学习记录（三）--字段">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/06/2019030500083/">
    		mysql 学习记录（二）--查询，权限，字段控制
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-06T04:32:01.000Z">2015-11-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <ol>
<li>1.统计列分类数目</li>
<li>mysql&gt; select count(1) from test;</li>
<li>+———-+</li>
<li>| count(1) |</li>
<li>+———-+</li>
<li>|        9 |</li>
<li>+———-+</li>
<li><p>1 row in set (0.02 sec)</p>
</li>
<li><p>2.分组统计</p>
</li>
<li>mysql&gt; select ename,count(1) from test group by ename;</li>
<li>+———-+———-+</li>
<li>| ename    | count(1) |</li>
<li>+———-+———-+</li>
<li>| aaaaa    |        3 |</li>
<li>| ccccc    |        1 |</li>
<li>| def      |        1 |</li>
<li>| newName2 |        1 |</li>
<li>| newName3 |        1 |</li>
<li>| newNane1 |        1 |</li>
<li>| ttttt    |        1 |</li>
<li>+———-+———-+</li>
<li><p>7 rows in set (0.00 sec)</p>
</li>
<li><p>3.在分组的统计数据的基础上再进行相同的统计</p>
</li>
<li>mysql&gt; select ename,count(1) from test group by ename with rollup;</li>
<li>+———-+———-+</li>
<li>| ename    | count(1) |</li>
<li>+———-+———-+</li>
<li>| aaaaa    |        3 |</li>
<li>| ccccc    |        1 |</li>
<li>| def      |        1 |</li>
<li>| newName2 |        1 |</li>
<li>| newName3 |        1 |</li>
<li>| newNane1 |        1 |</li>
<li>| ttttt    |        1 |</li>
<li>| NULL     |        9 |</li>
<li>+———-+———-+</li>
<li><p>8 rows in set (0.00 sec)</p>
</li>
<li><p>4.按分组统计的结果计数</p>
</li>
<li>mysql&gt; select ename,count(1) from test group by ename having count(1) &gt; 1;</li>
<li>+——-+———-+</li>
<li>| ename | count(1) |</li>
<li>+——-+———-+</li>
<li>| aaaaa |        3 |</li>
<li>+——-+———-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>5.统计总数量、最大值、最小值</p>
</li>
<li>mysql&gt; select sum(age),max(age),min(age) from test;</li>
<li>+———-+———-+———-+</li>
<li>| sum(age) | max(age) | min(age) |</li>
<li>+———-+———-+———-+</li>
<li>|      112 |       81 |        1 |</li>
<li>+———-+———-+———-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>6.左右连接</p>
</li>
<li>mysql&gt; create table emp( ename varchar(20), hiredate date, sal int(11), deptno int(11) );</li>
<li><p>Query OK, 0 rows affected (0.04 sec)</p>
</li>
<li><p>mysql&gt; insert into emp(ename,hiredate,sal,deptno) values (‘zzx’,’2000-01-01’,2000,1), (‘lisa’,’2003-02-01’,4000,2), (‘bjguan’,’</p>
</li>
<li>2004-04-02’,5000,1), (‘bzshen’,’2005-04-01’,4000,3);</li>
<li>Query OK, 4 rows affected (0.00 sec)</li>
<li><p>Records: 4  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from emp;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table  dept ( deptno int(11), deptname varchar(20) );</p>
</li>
<li><p>Query OK, 0 rows affected (0.05 sec)</p>
</li>
<li><p>mysql&gt; insert into dept(deptno,deptname) values (1,’tech’), (2,’sale’), (3,’hr’);</p>
</li>
<li>Query OK, 3 rows affected (0.01 sec)</li>
<li><p>Records: 3  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from dept;</p>
</li>
<li>+——–+———-+</li>
<li>| deptno | deptname |</li>
<li>+——–+———-+</li>
<li>|      1 | tech     |</li>
<li>|      2 | sale     |</li>
<li>|      3 | hr       |</li>
<li>+——–+———-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp,dept where emp.deptno = dept.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bjguan | tech     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp</p>
</li>
<li>-&gt; left join dept on emp.deptno = dept.deptno;</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bjguan | tech     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into emp (ename) values (‘dony’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp left join dept on emp.deptno = dept.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bjguan | tech     |</li>
<li>| bzshen | hr       |</li>
<li>| dony   | NULL     |</li>
<li>+——–+———-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>| dony   | NULL       | NULL |   NULL |</li>
<li>+——–+————+——+——–+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp right join dept on emp.deptno = dept.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| bjguan | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp right join dept on dept.deptno=emp.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| bjguan | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp where deptno in ( select deptno from dept);</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>7.几种嵌套查询</p>
</li>
<li>mysql&gt; select * from emp where deptno = ( select deptno from dept limit 1);</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>+——–+————+——+——–+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp where deptno in ( select deptno from dept );</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select emp.* from emp ,dept where emp.deptno = dept.deptno;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>8.组合查询</p>
</li>
<li>mysql&gt; select deptno from emp union  select deptno from dept;</li>
<li>+——–+</li>
<li>| deptno |</li>
<li>+——–+</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      3 |</li>
<li>|   NULL |</li>
<li>+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select deptno from emp union all   select deptno from dept;</p>
</li>
<li>+——–+</li>
<li>| deptno |</li>
<li>+——–+</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      1 |</li>
<li>|      3 |</li>
<li>|   NULL |</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      3 |</li>
<li>+——–+</li>
<li><p>8 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select deptno from emp union  select deptno from dept;</p>
</li>
<li>+——–+</li>
<li>| deptno |</li>
<li>+——–+</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      3 |</li>
<li>|   NULL |</li>
<li>+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>9.权限设置举例</p>
</li>
<li>mysql&gt; grant select,update on test1.* to z1@localhost identified by ‘test’;</li>
<li><p>Query OK, 0 rows affected (0.00 sec)</p>
</li>
<li><p>[root@ ~]# mysql -uz1 -ptest</p>
</li>
<li>mysql&gt; use test1;</li>
<li>Reading table information for completion of table and column names</li>
<li><p>You can turn off this feature to get a quicker startup with -A</p>
</li>
<li><p>mysql&gt; insert into emp(sal,deptno) values(‘2000’,3);</p>
</li>
<li><p>ERROR 1142 (42000): INSERT command denied to user ‘z1‘@’localhost’ for table ‘emp’.</p>
</li>
<li><p>10.内置帮助的使用</p>
</li>
<li>mysql&gt; ? contents</li>
<li>You asked for help about help category: “Contents”</li>
<li>For more information, type ‘help <item>‘, where <item> is one of the following</item></item></li>
<li>categories:</li>
<li>Account Management</li>
<li>Administration</li>
<li>Compound Statements</li>
<li>Data Definition</li>
<li>Data Manipulation</li>
<li>Data Types</li>
<li>Functions</li>
<li>Functions and Modifiers for Use with GROUP BY</li>
<li>Geographic Features</li>
<li>Help Metadata</li>
<li>Language Structure</li>
<li>Plugins</li>
<li>Procedures</li>
<li>Storage Engines</li>
<li>Table Maintenance</li>
<li>Transactions</li>
<li>User-Defined Functions</li>
<li><p>Utility</p>
</li>
<li><p>mysql&gt; ? data types</p>
</li>
<li>You asked for help about help category: “Data Types”</li>
<li>For more information, type ‘help <item>‘, where <item> is one of the following</item></item></li>
<li>topics:</li>
<li>AUTO_INCREMENT</li>
<li>BIGINT</li>
<li>BINARY</li>
<li>BIT</li>
<li>BLOB</li>
<li>BLOB DATA TYPE</li>
<li>BOOLEAN</li>
<li>CHAR</li>
<li>CHAR BYTE</li>
<li>DATE</li>
<li>DATETIME</li>
<li>DEC</li>
<li>DECIMAL</li>
<li>DOUBLE</li>
<li>DOUBLE PRECISION</li>
<li>ENUM</li>
<li>FLOAT</li>
<li>INT</li>
<li>INTEGER</li>
<li>LONGBLOB</li>
<li>LONGTEXT</li>
<li>MEDIUMBLOB</li>
<li>MEDIUMINT</li>
<li>MEDIUMTEXT</li>
<li>SET DATA TYPE</li>
<li>SMALLINT</li>
<li>TEXT</li>
<li>TIME</li>
<li>TIMESTAMP</li>
<li>TINYBLOB</li>
<li>TINYINT</li>
<li>TINYTEXT</li>
<li>VARBINARY</li>
<li>VARCHAR</li>
<li><p>YEAR DATA TYPE</p>
</li>
<li><p>11.通过操作此表可以实现迅速修改表名等操作。</p>
</li>
<li><p>mysql&gt; select * from information_schema.tables;</p>
</li>
<li><p>12.字段的长度测试</p>
</li>
<li>mysql&gt; create table t1(id1 int,id2 int(5));</li>
<li><p>Query OK, 0 rows affected (0.06 sec)</p>
</li>
<li><p>mysql&gt; desc t1;</p>
</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| Field | Type    | Null | Key | Default | Extra |</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| id1   | int(11) | YES  |     | NULL    |       |</li>
<li>| id2   | int(5)  | YES  |     | NULL    |       |</li>
<li><p>+——-+———+——+—–+———+——-+</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+</li>
<li>| id1  | id2  |</li>
<li>+——+——+</li>
<li>|    1 |    1 |</li>
<li>+——+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t1 modify id1 int zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id2 int(5) zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1111111);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+————+———+</li>
<li>| id1        | id2     |</li>
<li>+————+———+</li>
<li>| 0000000001 |   00001 |</li>
<li>| 0000000001 | 1111111 |</li>
<li>+————+———+</li>
<li>2 rows in set (0.00 sec)</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/06/2019030500083/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/06/2019030500083/" title="mysql 学习记录（二）--查询，权限，字段控制">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/06/2019030500081/">
    		mysql 学习记录（一）--建表，增加，删除，修改，基本查询
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-06T04:27:38.000Z">2015-11-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/学习/" title="学习">学习</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <ol>
<li>1.建立数据库</li>
<li>mysql&gt; create database test1;</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>2.建立了数据再建立，则：</p>
</li>
<li>mysql&gt; create database test1;</li>
<li><p>ERROR 1007 (HY000): Can’t create database ‘test1’; database exists</p>
</li>
<li><p>3.显示数据库信息：</p>
</li>
<li>mysql&gt; show databases;</li>
<li>+——————–+</li>
<li>| Database           |</li>
<li>+——————–+</li>
<li>| information_schema |</li>
<li>| mysql              |</li>
<li>| performance_schema |</li>
<li>| test               |</li>
<li>| test1              |</li>
<li>+——————–+</li>
<li><p>5 rows in set (0.05 sec)</p>
</li>
<li><p>4.进入数据库</p>
</li>
<li>mysql&gt; use test1;</li>
<li><p>Database changed</p>
</li>
<li><p>5.显示表中的数据库：</p>
</li>
<li>mysql&gt; show tables;</li>
<li><p>Empty set (0.00 sec)</p>
</li>
<li><p>6.删除数据库：</p>
</li>
<li>mysql&gt; drop database test1;</li>
<li><p>Query OK, 0 rows affected (0.07 sec)</p>
</li>
<li><p>7.建立表：</p>
</li>
<li>mysql&gt; create database test1;</li>
<li>Query OK, 1 row affected (0.01 sec)</li>
<li>mysql&gt; use test1;</li>
<li>Database changed</li>
<li>mysql&gt; create table emp(ename varchar(10), hiredate date , sal decimal(10,2), deptno int(2));</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li>mysql&gt; desc emp;</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(10)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>8.显示DDL语句：</p>
</li>
<li>mysql&gt; show create table emp \G;</li>
<li><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></li>
<li>Table: emp</li>
<li>Create Table: CREATE TABLE `emp` (</li>
<li>`ename` varchar(10) DEFAULT NULL,</li>
<li>`hiredate` date DEFAULT NULL,</li>
<li>`sal` decimal(10,2) DEFAULT NULL,</li>
<li>`deptno` int(2) DEFAULT NULL</li>
<li>) ENGINE=InnoDB DEFAULT CHARSET=utf8</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>ERROR:</p>
</li>
<li><p>No query specified</p>
</li>
<li><p>9.删除表：</p>
</li>
<li>mysql&gt; drop table emp;</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>10.修改表字段名称，删除表字段</p>
</li>
<li>mysql&gt; create table emp(ename varchar(10), hiredate date , sal decimal(10,2), deptno int(2));\</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(10)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp modify ename varchar(20);</p>
</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(20)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp add column age int(3);</p>
</li>
<li>Query OK, 0 rows affected (0.06 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(20)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>| age      | int(3)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp drop column age;</p>
</li>
<li>Query OK, 0 rows affected (0.06 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(20)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp change age age1 int(4);</p>
</li>
<li>ERROR 1054 (42S22): Unknown column ‘age’ in ‘emp’</li>
<li>mysql&gt; alter table emp change sal sal_salart int(4);</li>
<li>Query OK, 0 rows affected (0.04 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>| sal_salart | int(4)      | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>11.修改表字段顺序：</p>
</li>
<li>mysql&gt; alter table emp add birth date after ename;</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table emp add testColumn date after ename;</p>
</li>
<li>Query OK, 0 rows affected (0.08 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| testColumn | date        | YES  |     | NULL    |       |</li>
<li>| birth      | date        | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>| sal_salart | int(4)      | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp modify sal_salart int(5) first;</p>
</li>
<li>Query OK, 0 rows affected (0.06 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| sal_salart | int(5)      | YES  |     | NULL    |       |</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| testColumn | date        | YES  |     | NULL    |       |</li>
<li>| birth      | date        | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp rename emp_test;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>12.增加字段：</p>
</li>
<li>mysql&gt; alter table emp_test add column age int(3);</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp_test;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| sal_salart | int(5)      | YES  |     | NULL    |       |</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| testColumn | date        | YES  |     | NULL    |       |</li>
<li>| birth      | date        | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>| age        | int(3)      | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>6 rows in set (0.00 sec)</li>
<li>mysql&gt; alter table emp_test rename test;</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>13.插入数据：</p>
</li>
<li>mysql&gt; use test1;</li>
<li>Reading table information for completion of table and column names</li>
<li><p>You can turn off this feature to get a quicker startup with -A</p>
</li>
<li><p>Database changed</p>
</li>
<li><p>mysql&gt; insert into test(ename,age) values(‘abc’,3);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into test(ename,age) values(‘abc’,3),(‘def’,9);</p>
</li>
<li>Query OK, 2 rows affected (0.01 sec)</li>
<li><p>Records: 2  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    9 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>14.修改数据：</p>
</li>
<li>mysql&gt; update test set age = 8 where ename = ‘def’;</li>
<li>Query OK, 1 row affected (0.01 sec)</li>
<li><p>Rows matched: 1  Changed: 1  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    8 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; update test set age = 8 where ename = ‘def22222222’;</p>
</li>
<li>Query OK, 0 rows affected (0.01 sec)</li>
<li><p>Rows matched: 0  Changed: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    8 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; update test set age = 81 where ename = ‘def22222222’;</p>
</li>
<li>Query OK, 0 rows affected (0.01 sec)</li>
<li><p>Rows matched: 0  Changed: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    8 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; update test set age = 81 where ename = ‘def’;</p>
</li>
<li>Query OK, 1 row affected (0.00 sec)</li>
<li><p>Rows matched: 1  Changed: 1  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>15.删除数据</p>
</li>
<li>mysql&gt; delete from test where age = 3;</li>
<li><p>Query OK, 2 rows affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert test(ename,age) values (‘aaaaa’,3),(‘aaaaa’,5),(‘ccccc’,3), (‘aaaaa’,9), (‘ttttt’,2);</p>
</li>
<li>Query OK, 5 rows affected (0.01 sec)</li>
<li><p>Records: 5  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>16.查询数据：</p>
</li>
<li>mysql&gt; alter table test rename test_col;</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from test_col;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table test_col rename test;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; selecdt distinct ename from test;</p>
</li>
<li>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘selecdt distinct ename from test’ at line 1</li>
<li>mysql&gt; select distinct ename from test;</li>
<li>+——-+</li>
<li>| ename |</li>
<li>+——-+</li>
<li>| def   |</li>
<li>| aaaaa |</li>
<li>| ccccc |</li>
<li>| ttttt |</li>
<li>+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test where ename = ‘aaaaa’;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test where age &lt; 8;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test order by age;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table test add column salart int (11);</p>
</li>
<li>Query OK, 6 rows affected (0.06 sec)</li>
<li><p>Records: 6  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table test change salart salary int (11);</p>
</li>
<li>Query OK, 6 rows affected (0.05 sec)</li>
<li><p>Records: 6  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+——-+————+——-+———-+——+——–+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |   NULL |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |   NULL |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |   NULL |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |   NULL |</li>
<li>+————+——-+————+——-+———-+——+——–+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into test(ename,age,salary) values  (‘newNane1’,1,100),</p>
</li>
<li>-&gt; (‘newName2’,3,80),</li>
<li>-&gt; (‘newName3’,5,10);</li>
<li>Query OK, 3 rows affected (0.01 sec)</li>
<li><p>Records: 3  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename    | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>|       NULL | def      | NULL       | NULL  | NULL     |   81 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    5 |   NULL |</li>
<li>|       NULL | ccccc    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    9 |   NULL |</li>
<li>|       NULL | ttttt    | NULL       | NULL  | NULL     |    2 |   NULL |</li>
<li>|       NULL | newNane1 | NULL       | NULL  | NULL     |    1 |    100 |</li>
<li>|       NULL | newName2 | NULL       | NULL  | NULL     |    3 |     80 |</li>
<li>|       NULL | newName3 | NULL       | NULL  | NULL     |    5 |     10 |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li><p>9 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test order by salary;</p>
</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename    | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>|       NULL | def      | NULL       | NULL  | NULL     |   81 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    5 |   NULL |</li>
<li>|       NULL | ccccc    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    9 |   NULL |</li>
<li>|       NULL | ttttt    | NULL       | NULL  | NULL     |    2 |   NULL |</li>
<li>|       NULL | newName3 | NULL       | NULL  | NULL     |    5 |     10 |</li>
<li>|       NULL | newName2 | NULL       | NULL  | NULL     |    3 |     80 |</li>
<li>|       NULL | newNane1 | NULL       | NULL  | NULL     |    1 |    100 |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li><p>9 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test order by salary limit 6,3;</p>
</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename    | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>|       NULL | newName3 | NULL       | NULL  | NULL     |    5 |     10 |</li>
<li>|       NULL | newName2 | NULL       | NULL  | NULL     |    3 |     80 |</li>
<li>|       NULL | newNane1 | NULL       | NULL  | NULL     |    1 |    100 |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>3 rows in set (0.00 sec)</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/06/2019030500081/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/06/2019030500081/" title="mysql 学习记录（一）--建表，增加，删除，修改，基本查询">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/05/2019030500030/">
    		数据库对于开发应该知道的优化操作
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-05T12:01:04.000Z">2015-11-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/数据库/" title="数据库">数据库</a> / 
    
        <a href="/tags/优化/" title="优化">优化</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><strong>对于数据库的一些优化操作</strong> 1：<em>访问少，查询小，</em> 应用程序中，保证在实现功能的基础上，尽量减少对数据库的访问次数；通过搜索参数，尽量减少对表的访问行数,最小化结果集，从而减轻网络负担；能够分开的操作尽量分开处理，提高每次的响应速度；在数据窗口使用SQL时，尽量把使用的索引放在选择的首列；算法的结构尽量简单；在查询时，不要过多地使用通配符如： SELECT <em> FROM T1语句， 要用到几列就选择几列如：SELECT COL1,COL2 FROM T1； 在可能的情况下尽量限制尽量结果集行数如：SELECT TOP 300 COL1,COL2,COL3 FROM T1,因为某些情况下用户是不需要那么多的数据的。 不要在应用中使用数据库游标，游标是非常有用的工具，但比使用常规的、面向集的SQL语句需要更大的开销；按照特定顺序提取数据的查找。 2：<em>类型不乱用</em> 避免使用不兼容的数据类型。 例如float和int、char和varchar、binary和varbinary是不兼容的。数据类型的不兼容可能使优化器无法执行一些本来可以进行的优化操作。例如: SELECT name FROM employee WHERE salary ＞ 60000 在这条语句中,如salary字段是money型的,则优化器很难对其进行优化,因为60000 是个整型数。我们应当在编程时将整型转化成为钱币型,而不要等到运行时转化。 3：<em>避免在WHERE子句中对字段进行函数或表达式操作</em>， 这将导致引擎放弃使用索引而进行全表扫描。如： SELECT </em> FROM T1 WHERE F1/2=100 应改为: SELECT <em> FROM T1 WHERE F1=100\</em>2 SELECT * FROM RECORD WHERE SUBSTRING(CARD_NO,1,4)=’5378’ 应改为: SELECT <em> FROM RECORD WHERE CARD_NO LIKE ‘5378%’ SELECT member_number, first_name, last_name FROM members WHERE DATEDIFF(yy,datofbirth,GETDATE()) &gt; 21 应改为: SELECT member_number, first_name, last_name FROM members WHERE dateofbirth &lt; DATEADD(yy,-21,GETDATE()) 即：任何对列的操作都将导致表扫描，它包括数据库函数、计算表达式等等，查询 时要尽可能将操作移至等号右边。 4、 <em>避免使用操作符</em> 如：!=或＜＞、IS NULL或IS NOT NULL、IN ，NOT IN等这样的操作符, 因为这会使系统无法使用索引,而只能直接搜索表中的数据。例如: SELECT id FROM employee WHERE id != ‘B%’ 优化器将无法通过索引来确定将要命中的行数,因此需要搜索该表的所有行。 5、 尽量使用数字型字段，一部分开发人员和数据库管理人员喜欢把包含数值信 息的字段 设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在 处理查询和连接回逐个比较字符串中每一个字符，而对于数字型而言只需要比较一 次就够了。 6、 <em>合理使用EXISTS,NOT EXISTS子句</em> 如下所示： a.SELECT SUM(T1.C1)FROM T1 WHERE( (SELECT COUNT(</em>)FROM T2 WHERE T2.C2=T1.C2&gt;0) b.SELECT SUM(T1.C1) FROM T1WHERE EXISTS( SELECT <em> FROM T2 WHERE T2.C2=T1.C2) 两者产生相同的结果，但是后者的效率显然要高于前者。因为后者不会产生大量锁 定的表扫描或是索引扫描。 如果你想校验表里是否存在某条纪录，不要用count(</em>)那样效率很低，而且浪费服 务器资源。可以用EXISTS代替。如： IF (SELECT COUNT(<em>) FROM table_name WHERE column_name = ‘xxx’) 可以写成： IF EXISTS (SELECT </em> FROM table_name WHERE column_name = ‘xxx’) 经常需要写一个T_SQL语句比较一个父结果集和子结果集，从而找到是否存在在父 结果集中有而在子结果集中没有的记录，如： a.SELECT a.hdr_key FROM hdr_tbl a WHERE NOT EXISTS (SELECT <em> FROM dtl_tbl b WHERE a.hdr_key = b.hdr_key) b.SELECT a.hdr_key FROM hdr_tbl a LEFT JOIN dtl_tbl b ON a.hdr_key = b.hdr_key WHERE b.hdr_key IS NULL c.SELECT hdr_key FROM hdr_tbl WHERE hdr_key NOT IN (SELECT hdr_key FROM dtl_tbl) 三种写法都可以得到同样正确的结果，但是效率依次降低。 7、 尽量避免在索引过的字符数据中，使用非打头字母搜索。这也使得引擎无法 利用索引。 见如下例子： SELECT </em> FROM T1 WHERE NAME LIKE ‘%L%’ SELECT <em> FROM T1 WHERE SUBSTING(NAME,2,1)=’L’ SELECT </em> FROM T1 WHERE NAME LIKE ‘L%’ 即使NAME字段建有索引，前两个查询依然无法利用索引完成加快操作，引擎不得不 对全表所有数据逐条操作来完成任务。而第三个查询能够使用索引来加快操作。 8、<em>利用多条件查询</em> 分利用连接条件，在某种情况下，两个表之间可能不只一个的连接条件，这 时在 WHERE 子句中将连接条件完整的写上，有可能大大提高查询速度。 例： SELECT SUM(A.AMOUNT) FROM ACCOUNT A,CARD B WHERE A.CARD_NO = B.CARD_NO SELECT SUM(A.AMOUNT) FROM ACCOUNT A,CARD B WHERE A.CARD_NO = B.CARD_NO AND A.ACCOUNT_NO=B.ACCOUNT_NO 第二句将比第一句执行快得多。 9、 <em>消除对大型表行数据的顺序存取</em> 尽管在所有的检查列上都有索引，但某些形式的WHERE子句强迫优化器使用 顺序存取。如： SELECT <em> FROM orders WHERE (customer_num=104 AND order_num&gt;1001) OR order_num=1008 解决办法可以使用并集来避免顺序存取： SELECT </em> FROM orders WHERE customer_num=104 AND order_num&gt;1001 UNION SELECT <em> FROM orders WHERE order_num=1008 这样就能利用索引路径处理查询。 10、 <em>避免困难的正规表达式</em> LIKE关键字支持通配符匹配，技术上叫正规表达式。但这种匹配特别耗费时 间。例如：SELECT </em> FROM customer WHERE zipcode LIKE “98_ _ _” 即使在zipcode字段上建立了索引，在这种情况下也还是采用顺序扫描的方式。如 果把语句改为SELECT <em> FROM customer WHERE zipcode &gt;“98000”，在执行查询 时就会利用索引来查询，显然会大大提高速度。 11、 <em>使用视图加速查询</em> 把表的一个子集进行排序并创建视图，有时能加速查询。它有助于避免多重排序操作，而且在其他方面还能简化优化器的工作。例如： SELECT cust.name，rcvbles.balance，……other columns FROM cust，rcvbles WHERE cust.customer_id = rcvlbes.customer_id AND rcvblls.balance&gt;0 AND cust.postcode&gt;“98000” ORDER BY cust.name 如果这个查询要被执行多次而不止一次，可以把所有未付款的客户找出来放在一个 视图中，并按客户的名字进行排序： CREATE VIEW DBO.V_CUST_RCVLBES AS SELECT cust.name，rcvbles.balance，……other columns FROM cust，rcvbles WHERE cust.customer_id = rcvlbes.customer_id AND rcvblls.balance&gt;0 ORDER BY cust.name 然后以下面的方式在视图中查询： SELECT </em> FROM V_CUST_RCVLBES WHERE postcode&gt;“98000” 视图中的行要比主表中的行少，而且物理顺序就是所要求的顺序，减少了磁盘 I/O，所以查询工作量可以得到大幅减少。 12、 <em>能够用BETWEEN的就不要用IN</em> SELECT <em> FROM T1 WHERE ID IN (10,11,12,13,14) 改成： SELECT </em> FROM T1 WHERE ID BETWEEN 10 AND 14 因为IN会使系统无法使用索引,而只能直接搜索表中的数据。 13、 <em>DISTINCT的就不用GROUP BY</em> SELECT OrderID FROM Details WHERE UnitPrice &gt; 10 GROUP BY OrderID 可改为： SELECT DISTINCT OrderID FROM Details WHERE UnitPrice &gt; 10 14、 部分利用索引 1.SELECT employeeID, firstname, lastname FROM names WHERE dept = ‘prod’ or city = ‘Orlando’ or division = ‘food’ 2.SELECT employeeID, firstname, lastname FROM names WHERE dept = ‘prod’ UNION ALL SELECT employeeID, firstname, lastname FROM names WHERE city = ‘Orlando’ UNION ALL SELECT employeeID, firstname, lastname FROM names WHERE division = ‘food’ 如果dept 列建有索引则查询2可以部分利用索引，查询1则不能。 15、 <em>能用UNION ALL就不要用UNION</em> UNION ALL不执行SELECT DISTINCT函数，这样就会减少很多不必要的资源 16、 <em>不要写一些不做任何事的查询</em> 如：SELECT COL1 FROM T1 WHERE 1=0 SELECT COL1 FROM T1 WHERE COL1=1 AND COL1=2 这类死码不会返回任何结果集，但是会消耗系统资源。 17、 <em>尽量不要用SELECT INTO语句。</em> SELECT INTO 语句会导致表锁定，阻止其他用户访问该表。 18、 <em>必要时强制查询优化器使用某个索引</em> SELECT <em> FROM T1 WHERE nextprocess = 1 AND processid IN (8,32,45) 改成： SELECT </em> FROM T1 (INDEX = IX_ProcessID) WHERE nextprocess = 1 AND processid IN (8,32,45) 则查询优化器将会强行利用索引IX_ProcessID 执行查询。 19、 虽然UPDATE、DELETE语句的写法基本固定，但是还是对UPDATE语句给点建 议： <em>a) 尽量不要修改主键字段。 b) 当修改VARCHAR型字段时，尽量使用相同长度内容的值代替。 c) 尽量最小化对于含有UPDATE触发器的表的UPDATE操作。 d) 避免UPDATE将要复制到其他数据库的列。 e) 避免UPDATE建有很多索引的列。 f) 避免UPDATE在WHERE子句条件中的列</em>。 上面我们提到的是一些基本的提高查询速度的注意事项,但是在更多的情况下,往往 需要反复试验比较不同的语句以得到最佳方案。最好的方法当然是测试，看实现相 同功能的SQL语句哪个执行时间最少，但是数据库中如果数据量很少，是比较不出 来的，这时可以用查看执行计划，即：把实现相同功能的多条SQL语句考到查询分 析器，按CTRL+L看查所利用的索引，表扫描次数（这两个对性能影响最大），总体 上看询成本百分比即可。 简单的存储过程可以用向导自动生成：在企业管理器工具栏点击运行向导图标，点 击”数据库”、”创建存储过程向导”。复杂存储过程的调试：在查询分析器左边 的对象浏览器（没有？按F8）选择要调试的存储过程,点右键，点调试，输入参数 执行，出现一个浮动工具条，上面有单步执行，断点设置等。</p>

            
            <p class="more">
                <a href="/2015/11/05/2019030500030/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/05/2019030500030/" title="数据库对于开发应该知道的优化操作">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/05/2019030500048/">
    		InnoDB的行锁，遇到的死锁和分析
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-05T11:59:00.000Z">2015-11-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/InnoDB/" title="InnoDB">InnoDB</a> / 
    
        <a href="/tags/死锁/" title="死锁">死锁</a> / 
    
        <a href="/tags/锁/" title="锁">锁</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>InnoDB的锁，遇到的死锁和总结 行锁有2种 1）S锁，一个事务加锁后，允许其它事务去读被锁的数据集（获得S锁），防止其它事务获得相同数据集的X锁 2）X锁，一个事务加锁后，防止其它事务去读被锁的数据集（获得S锁），防止其它事务获得相同数据集的X锁 另外，为了兼容表锁，加上了IS锁和IX锁 1）IS锁，一个事务想加S锁钱，得先有该表的IS锁 2）IX锁，一个事务想获得X锁前，得有该表的IX锁   意向锁是InnoDB自动加的，无须干预。 对于update，delete，insert，InnoDB会自动给涉及的数据集加X锁，但不一定同一种锁 对于select，InnoDB不会加任何锁 对于select，我们可以通过  for update 加X锁，通过 lock in share mode 加S锁，这个叫显示加锁   索引的实现方式 行锁通过给索引上的索引的key来加锁，没有索引时，通过因此的聚簇索引来加锁 Record lock 对索引key加锁 （索引使用=，并且索引key存在，条件下获得） Gap lock 间隙锁，索引key之间的间隙，第一条记录之前的间隙，最后一条记录之后的间隙 比如  现在有key      5 10 15，   那么(-∞,5)  （5,10）  （10,15）  （15,+∞)，都构成间隙 (索引使用=，索引key不存在，会对key所在的间隙，加上Gap锁) (索引使用&gt;&lt;，索引key不存在，会对那些不存在的部分所在间隙，加上Gap锁) Next-key lock 前面二者的组合，例如（5,10] 前开后毕的间隙等等 (索引使用&gt;，索引key部分存在，会对key和那些不存在的部分所在间隙，加上Next-key锁) InsertIntention lock 插入欲望锁，insert语句会对插入行加一个X锁，但是插入之前得申请一个 InsertIntention的Gap锁，也就是I锁 (insert时，索引项不存在，会找到索引项所在的间隙，申请这个间隙上的InsertIntention lock)   X-X锁兼容矩阵 G    I     R    N &lt;—-当前锁模式 G    +     +    +    + I    -     +    +    - R    +     +    -    - N    +     +    -    -   没有索引，就用表锁   遇到的问题 ————————————————————————————————————— 假设已经有了800-910之间形成一个间隙   1)T1 start 2)T2 start 3)T1 select <em> from table index=900 for update  获得Gap（800，910） 4)T2 select </em> from table index=901 for update  获得Gap（800，910） 5)T1 insert into table  (index)values（900） 需要获得I锁（800，910），等待T2释放Gap（800，910） 6)T2 insert into table (index)values（901） 需要获得I锁（800，910），等待T1释放Gap（800，910）,产生死锁   —————————————————————————————————————</p>

            
            <p class="more">
                <a href="/2015/11/05/2019030500048/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/05/2019030500048/" title="InnoDB的行锁，遇到的死锁和分析">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/10/15/2019030500144/">
    		Oracle MySql SqlServer分页查询
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-10-15T15:14:25.000Z">2015-10-15</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/Oracle/" title="Oracle">Oracle</a> / 
    
        <a href="/tags/sqlserver/" title="sqlserver">sqlserver</a> / 
    
        <a href="/tags/分页查询/" title="分页查询">分页查询</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><strong>SQL Server</strong> 从数据库表中的第M条记录开始取N条记录，利用Top关键字：注意如果Select语句中既有top，又有order by，则是从排序好的结果集中选择：</p>
<ol>
<li>SELECT *</li>
<li>FROM  ( SELECT Top N *</li>
<li>FROM    (SELECT Top (M + N - 1) * FROM 表名称 Order by 主键 desc) t1 ) t2</li>
<li><p>Order by 主键 asc</p>
<p>例如从表Sys_option（主键为sys_id)中从10条记录还是检索20条记录，语句如下：</p>
</li>
<li><p>SELECT *</p>
</li>
<li>FROM ( SELECT TOP 20 *</li>
<li>FROM (SELECT TOP 29 * FROM Sys_option order by sys_id desc) t1) t2</li>
<li><p>Order by sys_id asc</p>
<p><strong> Oralce数据库</strong> 从数据库表中第M条记录开始检索N条记录</p>
</li>
<li><p>SELECT *</p>
</li>
<li>FROM (SELECT ROWNUM r,t1.* From 表名称 t1 where rownum &lt; M + N) t2</li>
<li>where t2.r &gt;= M</li>
</ol>
<p>例如从表Sys_option（主键为sys_id)中从10条记录还是检索20条记录，语句如下：</p>
<ol>
<li>SELECT *</li>
<li>FROM (SELECT ROWNUM R,t1.* From Sys_option where rownum &lt; 30 ) t2</li>
<li>Where t2.R &gt;= 10</li>
</ol>
<p><strong>My sql数据库</strong> My sql数据库最简单，是利用mysql的LIMIT函数,LIMIT [offset,] rows从数据库表中M条记录开始检索N条记录的语句为：</p>
<ol>
<li><p>SELECT * FROM 表名称 LIMIT M,N</p>
<p>例如从表Sys_option（主键为sys_id)中从10条记录还是检索20条记录，语句如下：</p>
</li>
<li><p>select * from sys_option limit 10,20</p>
</li>
</ol>

            
            <p class="more">
                <a href="/2015/10/15/2019030500144/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/10/15/2019030500144/" title="Oracle MySql SqlServer分页查询">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/10/12/2019030500112/">
    		MySQL EXPLAIN SQL 输出信息描述
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-10-12T04:41:26.000Z">2015-10-12</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/SQL/" title="SQL">SQL</a> / 
    
        <a href="/tags/EXPLAIN/" title="EXPLAIN">EXPLAIN</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>EXPLAIN语句能够被用于获取一些关于SQL执行时的相关信息，比如表的连接顺序，对表的方式方式等等。通过对该相关信息进行进一步的分析，我们    可以通过对表添加适当的索引，以及优化连接顺序，使用提示等等手段来达到使SQL高效运行的目的。本文描述了EXPLAIN的用法并给出了相关示例。 一、EXPLAIN概述 EXPLAIN 语句主要是用于解析SQL执行计划，通过分析执行计划采取适当的优化方式提高SQL运行的效率。EXPLAIN 语句输出通常包括id列，select_type，table，type，possible_keys，key等等列信息MySQL 5.6.3后支持SELECT, DELETE, INSERT,REPLACE, and UPDATE. EXPLAIN EXTENDED支持一些额外的执行计划相关的信息EXPLAIN PARTITIONS支持基于分区表查询执行计划的相关信息 二、EXPLAIN输出列描述 – 下面通过示例来展示EXPLAIN输出列(root@localhost) [sakila]&gt; explain select sum(amount) from customer a,    -&gt; payment b where 1=1 and a.customer_id=b.customer_id and    -&gt; <a href="mailto:email=&#39;JANE.BENNETT@sakilacustomer.org" target="_blank" rel="noopener">email=&#39;JANE.BENNETT@sakilacustomer.org</a>‘\G<strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong>           id: 1  select_type: SIMPLE        table: a         type: ALLpossible_keys: PRIMARY          key: NULL      key_len: NULL          ref: NULL         rows: 590        Extra: Using where<strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 2. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong>           id: 1  select_type: SIMPLE        table: b         type: refpossible_keys: idx_fk_customer_id          key: idx_fk_customer_id      key_len: 2          ref: sakila.a.customer_id         rows: 14        Extra: 1、各列表示的意义 Column        Meaning——        ————————————id            The SELECT identifier                       select_type   The SELECT typetable         The table for the output rowpartitions    The matching partitionstype          The join typepossible_keys The possible indexes to choosekey           index actually chosenkey_len       The length of the chosen keyref           The columns compared to the indexrows          Estimate of rows to be examinedfiltered      Percentage of rows filtered by table conditionExtra         Additional information 2、各列上的具体描述 id：    包含一组数字，表示查询中执行select子句或操作表的顺序    id相同，执行顺序由上至下，否则id值越大(通常子查询会产生)优先级越高，越先被执行    id如果相同，可以认为是一组，从上往下顺序执行；在所有组中，id值越大，优先级越高，越先执行 select_type:      表示查询中每个select子句的类型（简单 OR复杂）    select_type              Value Meaning    ————-            ———————————————–    SIMPLE                   Simple SELECT (not using UNION or subqueries)    PRIMARY                  Outermost SELECT 最外层select    UNION                    Second or later SELECT statement in a UNION    DEPENDENT UNION          Second or later SELECT statement in a UNION, dependent on outer query    UNION                    RESULT Result of a UNION.    SUBQUERY                 First SELECT in subquery    DEPENDENT SUBQUERY       First SELECT in subquery, dependent on outer query(通常为相关子查询)    DERIVED                  Derived table SELECT (subquery in FROM clause)    MATERIALIZED             Materialized subquery    UNCACHEABLE SUBQUERY     A subquery for which the result cannot be cached and must be reevaluated                             for each row of the outer query    UNCACHEABLE UNION        The second or later select in a UNION that belongs to an uncacheable                             subquery (see UNCACHEABLE SUBQUERY)    table：      从哪个表(表名)上输出行记录，也可能是下列值:     • &lt;unionM,N&gt;: The row refers to the union of the rows with id values of M and N.    • <derivedn>: The row refers to the derived table result for the row with an id value of N.                   A derived table may result, for example, from a subquery in the FROM clause.    • <subqueryn>: The row refers to the result of a materialized subquery for the row with an id value of N.  partitions:     查询匹配的记录来自哪一个分区，当使用EXPLAIN，分区PARTITIONS关键字被指定时 type：    连接类型    system          表只有一行    const           表最多只有一行匹配，通用用于主键或者唯一索引比较时    eq_ref          每次与之前的表合并行都只在该表读取一行，这是除了system，const之外最好的一种，                    特点是使用=，而且索引的所有部分都参与join且索引是主键或非空唯一键的索引    ref             如果每次只匹配少数行，那就是比较好的一种，使用=或&lt;=&gt;，可以是左覆盖索引或非主键或非唯一键    fulltext        全文搜索    ref_or_null     与ref类似，但包括NULL    index_merge     表示出现了索引合并优化(包括交集，并集以及交集之间的并集)，但不包括跨表和全文索引。                    这个比较复杂，目前的理解是合并单表的范围索引扫描（如果成本估算比普通的range要更优的话）    unique_subquery 在in子查询中，就是value in (select…)把形如“select unique_key_column”的子查询替换。                    PS：所以不一定in子句中使用子查询就是低效的！    index_subquery  同上，但把形如”select non_unique_key_column“的子查询替换    range           常数值的范围    index           a.当查询是索引覆盖的，即所有数据均可从索引树获取的时候（Extra中有Using Index）；                    b.以索引顺序从索引中查找数据行的全表扫描（无 Using Index）；                    c.如果Extra中Using Index与Using Where同时出现的话，则是利用索引查找键值的意思；                    d.如单独出现，则是用读索引来代替读行，但不用于查找    all             全表扫描 possible_keys：    指出MySQL能使用哪个索引在表中找到行。    查询涉及到的字段上若存在索引则该索引将被列出，但不一定被查询使用。    如果改列为NULL，说明该查询不会使用到当前表上的相关索引，考虑是否有必要添加索引key    显示MySQL在查询中实际使用的索引，若没有使用索引，显示为NULL    也可能存在key不等于possible_keys的情形，即possible_keys不适合提取所需的行    而查询所选择的列在使用其他索引时更高效    TIPS：查询中若使用了覆盖索引，则该索引仅出现在key列表中 key_len    表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度 ref    表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值rows    表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数    对于InnoDB，该值为预估，不一定精确 Extra    包含不适合在其他列中显示但十分重要的额外信息 三、使用EXPLAIN EXTENDED 示例 (root@localhost) [sakila]&gt; explain extended select <em> from city where country_id in    -&gt; ( select country_id from country where country=’China’) and 1=1 \G<strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></em> 1. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong>           id: 1  select_type: SIMPLE        table: country         type: ALLpossible_keys: PRIMARY          key: NULL      key_len: NULL          ref: NULL         rows: 109     filtered: 100.00        Extra: Using where<strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 2. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong>           id: 1  select_type: SIMPLE        table: city         type: refpossible_keys: idx_fk_country_id          key: idx_fk_country_id      key_len: 2          ref: sakila.country.country_id         rows: 1     filtered: 100.00        Extra: NULL2 rows in set, 1 warning (0.00 sec) (root@localhost) [sakila]&gt; show warnings\G<strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong>  Level: Note   Code: 1003Message: /<em> select#1 </em>/ select `city`.`city_id` AS `city_id`,`city`.`city` AS `city`,`city`.`country_id` AS `country_id`,`city`.`last_update` AS `last_update` from `sakila`.`country` join `sakila`.`city` where ((`city`.`country_id` = `country`.`country_id`) and (`country`.`country` = ‘China’))1 row in set (0.00 sec) – 从上面的extended使用可以看出，查询中多出了filtered列– 其次原来的SQL语句真正在执行的时候被改写，即原来的1=1的条件被去掉– 对于复杂的SQL语句我们可以通过该方式获得一个比较清晰的真正被执行的SQL语句 四、EXPLAIN PARTITIONS示例 (root@localhost) [sakila]&gt; CREATE TABLE `actor_part` (    -&gt;   `actor_id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,    -&gt;   `first_name` varchar(45) NOT NULL,    -&gt;   `last_name` varchar(45) NOT NULL,    -&gt;   `last_update` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,    -&gt;   PRIMARY KEY (`actor_id`),    -&gt;   KEY `idx_actor_last_name` (`last_name`)    -&gt; ) partition by hash(actor_id) partitions 4;Query OK, 0 rows affected (0.11 sec) (root@localhost) [sakila]&gt; insert into actor_part select <em> from actor;Query OK, 200 rows affected (0.02 sec)Records: 200  Duplicates: 0  Warnings: 0(root@localhost) [sakila]&gt; explain select </em> from actor_part where actor_id=10;  – 未使用partitions时+—-+————-+————+——-+—————+———+———+——-+——+——-+| id | select_type | table      | type  | possible_keys | key     | key_len | ref   | rows | Extra |+—-+————-+————+——-+—————+———+———+——-+——+——-+|  1 | SIMPLE      | actor_part | const | PRIMARY       | PRIMARY | 2       | const |    1 | NULL  |+—-+————-+————+——-+—————+———+———+——-+——+——-+1 row in set (0.00 sec) (root@localhost) [sakila]&gt; explain partitions select * from actor_part where actor_id=10; – 使用partitions时+—-+————-+————+————+——-+—————+———+———+——-+——+——-+| id | select_type | table      | partitions | type  | possible_keys | key     | key_len | ref   | rows | Extra |+—-+————-+————+————+——-+—————+———+———+——-+——+——-+|  1 | SIMPLE      | actor_part | p2         | const | PRIMARY       | PRIMARY | 2       | const |    1 | NULL  |+—-+————-+————+————+——-+—————+———+———+——-+——+——-+1 row in set (0.00 sec)– 多出了partitions列</subqueryn></derivedn></p>

            
            <p class="more">
                <a href="/2015/10/12/2019030500112/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/10/12/2019030500112/" title="MySQL EXPLAIN SQL 输出信息描述">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/2.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    

    
    <nav class="page-navigator">
        <a class="extend prev" rel="prev" href="/categories/MySQL/page/4/">前一页</a><a class="page-number" href="/categories/MySQL/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/MySQL/page/3/">3</a><a class="page-number" href="/categories/MySQL/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/categories/MySQL/page/6/">6</a><a class="page-number" href="/categories/MySQL/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/categories/MySQL/page/10/">10</a><a class="extend next" rel="next" href="/categories/MySQL/page/6/">后一页</a>
    </nav>
    


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="/categories/MySQL/">MySQL</a>
        <span class="badge">(92)</span>
    </li>
    
    <li>
        <a href="/categories/Oracle/">Oracle</a>
        <span class="badge">(40)</span>
    </li>
    
    <li>
        <a href="/categories/NOSQL/">NOSQL</a>
        <span class="badge">(17)</span>
    </li>
    
    <li>
        <a href="/categories/开发语言/">开发语言</a>
        <span class="badge">(7)</span>
    </li>
    
    <li>
        <a href="/categories/SQL-Server/">SQL Server</a>
        <span class="badge">(13)</span>
    </li>
    
    <li>
        <a href="/categories/其他数据库/">其他数据库</a>
        <span class="badge">(4)</span>
    </li>
    
    <li>
        <a href="/categories/MySQL/Oracle/">Oracle</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="/categories/MySQL/Oracle/SQL-Server/">SQL Server</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="/categories/NOSQL/开发语言/">开发语言</a>
        <span class="badge">(1)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="/tags/MySQL/" title="MySQL">MySQL (71)</a>
  
    <a class="tag-item" href="/tags/位运算/" title="位运算">位运算 (0)</a>
  
    <a class="tag-item" href="/tags/sqlplus/" title="sqlplus">sqlplus (1)</a>
  
    <a class="tag-item" href="/tags/PL-SQL/" title="PL/SQL">PL/SQL (5)</a>
  
    <a class="tag-item" href="/tags/数据库/" title="数据库">数据库 (7)</a>
  
    <a class="tag-item" href="/tags/视图/" title="视图">视图 (1)</a>
  
    <a class="tag-item" href="/tags/B-Tree/" title="B+Tree">B+Tree (1)</a>
  
    <a class="tag-item" href="/tags/索引/" title="索引">索引 (1)</a>
  
    <a class="tag-item" href="/tags/redis/" title="redis">redis (6)</a>
  
    <a class="tag-item" href="/tags/SSDB/" title="SSDB">SSDB (1)</a>
  
    <a class="tag-item" href="/tags/SQL/" title="SQL">SQL (17)</a>
  
    <a class="tag-item" href="/tags/ORA-00600/" title="ORA-00600">ORA-00600 (1)</a>
  
    <a class="tag-item" href="/tags/存储过程/" title="存储过程">存储过程 (3)</a>
  
    <a class="tag-item" href="/tags/CentOS/" title="CentOS">CentOS (2)</a>
  
    <a class="tag-item" href="/tags/allow/" title="allow">allow (1)</a>
  
    <a class="tag-item" href="/tags/Apache/" title="Apache">Apache (1)</a>
  
    <a class="tag-item" href="/tags/deny/" title="deny">deny (1)</a>
  
    <a class="tag-item" href="/tags/druid/" title="druid">druid (1)</a>
  
    <a class="tag-item" href="/tags/心跳/" title="心跳">心跳 (1)</a>
  
    <a class="tag-item" href="/tags/事务/" title="事务">事务 (5)</a>
  
    <a class="tag-item" href="/tags/分布式/" title="分布式">分布式 (1)</a>
  
    <a class="tag-item" href="/tags/消息/" title="消息">消息 (1)</a>
  
    <a class="tag-item" href="/tags/KeepAlived/" title="KeepAlived">KeepAlived (1)</a>
  
    <a class="tag-item" href="/tags/Oracle/" title="Oracle">Oracle (30)</a>
  
    <a class="tag-item" href="/tags/schedule-job/" title="schedule job">schedule job (1)</a>
  
    <a class="tag-item" href="/tags/分库/" title="分库">分库 (1)</a>
  
    <a class="tag-item" href="/tags/分库分表/" title="分库分表">分库分表 (1)</a>
  
    <a class="tag-item" href="/tags/分表/" title="分表">分表 (1)</a>
  
    <a class="tag-item" href="/tags/结构同步/" title="结构同步">结构同步 (1)</a>
  
    <a class="tag-item" href="/tags/批量/" title="批量">批量 (1)</a>
  
    <a class="tag-item" href="/tags/truncate/" title="truncate">truncate (1)</a>
  
    <a class="tag-item" href="/tags/Hash索引/" title="Hash索引">Hash索引 (1)</a>
  
    <a class="tag-item" href="/tags/InnoDB/" title="InnoDB">InnoDB (3)</a>
  
    <a class="tag-item" href="/tags/MyISAM/" title="MyISAM">MyISAM (3)</a>
  
    <a class="tag-item" href="/tags/索引优化/" title="索引优化">索引优化 (1)</a>
  
    <a class="tag-item" href="/tags/FineReport/" title="FineReport">FineReport (1)</a>
  
    <a class="tag-item" href="/tags/报表/" title="报表">报表 (1)</a>
  
    <a class="tag-item" href="/tags/数据集/" title="数据集">数据集 (1)</a>
  
    <a class="tag-item" href="/tags/Excel/" title="Excel">Excel (1)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="https://jelon.top" target="_blank" title="Jelon个人前端小站">前端博客小站</a>
        </li>
    
        <li>
            <a href="https://www.baidu.com" target="_blank" title="百度搜索">百度</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2019
    

    <a href="/">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->
<script src="/js/main.js"></script>
</body>
</html>