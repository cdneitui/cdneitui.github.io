<!doctype html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8">
    <meta name="baidu-site-verification" content="dIcXMeY8Ya">
    
    <title>文章归档 | 软件开发吧</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="keywords" content="SQL云,SQL云开发,SQL笔记,SQL开发,云开发,MySQL,Oralce,数据库,数据库云,数据库开发,数据库云开发,SQL教程,数据库教程,开发笔记,MySQL笔记,MySQL教程">
    <meta name="description" content="为满足广大程序猿兄弟对日常工作中学习数据库、使用使用数据库资料查询需求，SQL云开发免费将自己整理的各种数据库技术资料分享出来，并希望与广大猿兄一起讨论学习与进步,致力于一起更方便、快捷资料学习查询,实现更安全、高效的数据存储.">

    
    <link rel="alternative" href="/atom.xml" title="软件开发吧" type="application/atom+xml">
    
    
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->
    
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?fd459238242776d173cdc64918fb32f2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</head>
</html>
<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">软件开发吧</span>
                    <span class="description"></span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/archives/page/8/index.html" class="item ">
                <a href="/" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="/archives/page/8/index.html" class="item ">
                <a href="/lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="/archives/page/8/index.html" class="item ">
                <a href="/about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="/archives/page/8/index.html" class="item ">
                <a href="/comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/sxyyhj" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="/img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon">
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章归档 -->

    <h3 class="widget-hd">
        <strong>
            
                文章归档
                <!-- 文章归档，可以根据日期分类 -->
            
        </strong>
    </h3>
    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/09/2019030500062/">
    		MySQL 5.6关闭DNS查询
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-09T09:07:50.000Z">2015-11-09</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>MySQL服务器的日志记录中看到如下的警告：</p>
<pre><code>2015-11-09 08:37:02 1489 [Warning] IP address &apos;104.223.72.XXX&apos; has been resolved to the host name &apos;104.223.72.XXX.static.quadranet.com&apos;, which resembles IPv4-address itself.
</code></pre><p>分析：104.223.72.XXX经查询，是美国的IP地址，国内有XX防火墙阻拦，DNS解析不了很正常。由于MySQL服务器在内存中维持了一个Host缓存，用于存储客户端的信息，包括：IP地址、Host主机名、错误信息等。对于非本地的TCP连接，MySQL服务器都会查询此缓存。对于使用本地环回地址（比如：127.0.0.1或者::1）的TCP连接、或者是使用Unix套接字文件的TCP连接、命名管道的TCP连接、共享内存的TCP连接，都不会使用Host缓存。 注：Loopback，本地环回接口（或地址），亦称回送地址。此类接口是应用最为广泛的一种虚接口，几乎在每台路由器上都会使用。在Windows系统中，采用127.0.0.1作为本地环回地址。 对于每一个新的客户端连接，MySQL服务器使用客户端的IP地址进行检索，查看客户端的主机名是否在Host缓存中。如果Host缓存中不存在，MySQL服务器会尝试解析主机名。首先，MySQL服务器会解析主机名对应的IP地址，并与客户端的原始IP地址进行比较，确保是同一个IP地址。然后MySQL服务器把这些信息写入Host缓存中。如果Host缓存已满，MySQL服务器会使用最近最少使用算法，删除部分缓存数据。 MySQL服务器执行主机名解析使用了线程安全的gethostbyaddr_r()函数调用和gethostbyname_r()函数调用，只要操作系统支持。否则，执行查找的线程会锁定一个互斥变量，再调用gethostbyaddr()函数和gethostbyname()函数。在这种情况下，如果主机名不在缓存中，也没有别的线程能解析主机名，必须等到互斥变量被释放后才可以。 MySQL服务器使用Host缓存主要有几个目的： 1）通过缓存的IP和主机名的对应关系，避免了对于客户端的每个连接都要做DNS查询。相反，对于给定的主机，只需针对首次连接进行DNS查询。 2）Host缓存中还保护了连接过程中发生的错误信息。有些错误可能是“阻塞”信息，对于给定的客户端如果连续出现这种信息，那么服务器会阻塞来自此客户端的进一步的连接。MySQL的系统变量max_connect_errors就描述了这种情况，意思是MySQL服务器在阻塞客户端连接之前允许客户端连接错误的次数。 要解除已经被阻塞的主机，需要刷新Host缓存，执行语句：</p>
<pre><code>mysql&gt; flush hosts
</code></pre><p>或者是在Shell环境下执行：</p>
<pre><code># mysqladmin flush-hosts
</code></pre><p>Host缓存在MySQL中是默认开启的，要关闭Host缓存，可以在启动MySQL时添加–skip-host-cache参数选项。 要禁用DNS主机名查找，可以在启动MySQL时添加–skip-name-resolve参数选项。在这种情况下，MySQL服务器会只使用IP地址来匹配连接。如果DNS查询很慢，或者是客户端非常多，那么关闭DNS查询可以改进MySQL服务器的性能。 解决办法： 修改my.cnf配置文件，找到[mysqld]处，添加：</p>
<pre><code>skip-name-resolve
</code></pre><p>再重启MySQL服务。 证明：</p>
<pre><code>mysql&gt; show variables like &quot;%skip%&quot;;
+------------------------+-------+
| Variable_name          | Value |
+------------------------+-------+
| skip_external_locking  | ON    |
| skip_name_resolve      | ON    |
| skip_networking        | OFF   |
| skip_show_database     | OFF   |
| slave_skip_errors      | OFF   |
| sql_slave_skip_counter | 0     |
+------------------------+-------+
6 rows in set (0.00 sec)
</code></pre>
            
            <p class="more">
                <a href="/2015/11/09/2019030500062/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/09/2019030500062/" title="MySQL 5.6关闭DNS查询">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/9.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/06/2019030500082/">
    		mysql 学习记录（三）--字段
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-06T04:35:55.000Z">2015-11-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <ol>
<li>1.填充字段</li>
<li>mysql&gt; create database test1;</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; use test1;</p>
</li>
<li>Database changed</li>
<li>mysql&gt; create table t1(id1 int,id2 int(5));</li>
<li><p>Query OK, 0 rows affected (0.06 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+</li>
<li>| id1  | id2  |</li>
<li>+——+——+</li>
<li>|    1 |    1 |</li>
<li>+——+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t1 modify id1 int zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id2 int(5) zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+————+——-+</li>
<li>| id1        | id2   |</li>
<li>+————+——-+</li>
<li>| 0000000001 | 00001 |</li>
<li>+————+——-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1111111);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+————+———+</li>
<li>| id1        | id2     |</li>
<li>+————+———+</li>
<li>| 0000000001 |   00001 |</li>
<li>| 0000000001 | 1111111 |</li>
<li>+————+———+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>2.自增长字段的建立</p>
</li>
<li>mysql&gt; create table ai1(id int auto_increment not null primary key);</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; create table ai2(id int auto_increment not null,primary key(id));</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; create table ai3(id int auto_increment not null,unique(id));</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>3.带小数的字段设置</p>
</li>
<li>mysql&gt; alter table t1 rename t1_test;</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t1_test;</p>
</li>
<li>+——-+—————————+——+—–+———+——-+</li>
<li>| Field | Type                      | Null | Key | Default | Extra |</li>
<li>+——-+—————————+——+—–+———+——-+</li>
<li>| id1   | int(10) unsigned zerofill | YES  |     | NULL    |       |</li>
<li>| id2   | int(5) unsigned zerofill  | YES  |     | NULL    |       |</li>
<li>+——-+—————————+——+—–+———+——-+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t1( id1 float(5,2) default null, id2 double(5,2) default null, id3 decimal(5,2) default null);</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.23,1.23,1.23);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.234,1.234,1.23);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.234,1.234,1.234);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+——+</li>
<li>| id1  | id2  | id3  |</li>
<li>+——+——+——+</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>| 1.23 | 1.23 | 1.23 |</li>
<li>+——+——+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t1 modify id1 float;</p>
</li>
<li>Query OK, 0 rows affected (0.02 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id2 double;</p>
</li>
<li>Query OK, 0 rows affected (0.01 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id3 decimal;</p>
</li>
<li>Query OK, 3 rows affected, 3 warnings (0.04 sec)</li>
<li><p>Records: 3  Duplicates: 0  Warnings: 3</p>
</li>
<li><p>mysql&gt; insert into t1 values(1.234,1.234,1.234);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li>+——-+——+——————————————+</li>
<li>| Level | Code | Message                                  |</li>
<li>+——-+——+——————————————+</li>
<li>| Note  | 1265 | Data truncated for column ‘id3’ at row 1 |</li>
<li>+——-+——+——————————————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——-+——-+——+</li>
<li>| id1   | id2   | id3  |</li>
<li>+——-+——-+——+</li>
<li>|  1.23 |  1.23 |    1 |</li>
<li>|  1.23 |  1.23 |    1 |</li>
<li>|  1.23 |  1.23 |    1 |</li>
<li>| 1.234 | 1.234 |    1 |</li>
<li>+——-+——-+——+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t2(id bit(1));</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t2;</p>
</li>
<li>+——-+——–+——+—–+———+——-+</li>
<li>| Field | Type   | Null | Key | Default | Extra |</li>
<li>+——-+——–+——+—–+———+——-+</li>
<li>| id    | bit(1) | YES  |     | NULL    |       |</li>
<li>+——-+——–+——+—–+———+——-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t2 values(1);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select bin(id),hex(id) from t2;</p>
</li>
<li>+———+———+</li>
<li>| bin(id) | hex(id) |</li>
<li>+———+———+</li>
<li>| 1       | 1       |</li>
<li>+———+———+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t2 values(2);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.00 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li>+———+——+———————————————+</li>
<li>| Level   | Code | Message                                     |</li>
<li>+———+——+———————————————+</li>
<li>| Warning | 1264 | Out of range value for column ‘id’ at row 1 |</li>
<li>+———+——+———————————————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t2 modify id bit(2);</p>
</li>
<li>Query OK, 2 rows affected (0.04 sec)</li>
<li><p>Records: 2  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; insert into t2 values(2);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select bin(id),hex(id) from t2;</p>
</li>
<li>+———+———+</li>
<li>| bin(id) | hex(id) |</li>
<li>+———+———+</li>
<li>| 1       | 1       |</li>
<li>| 1       | 1       |</li>
<li>| 10      | 2       |</li>
<li>+———+———+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t(d date,t time ,dt datetime);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———-+——+—–+———+——-+</li>
<li>| Field | Type     | Null | Key | Default | Extra |</li>
<li>+——-+———-+——+—–+———+——-+</li>
<li>| d     | date     | YES  |     | NULL    |       |</li>
<li>| t     | time     | YES  |     | NULL    |       |</li>
<li>| dt    | datetime | YES  |     | NULL    |       |</li>
<li>+——-+———-+——+—–+———+——-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>4.与时间有关的字段设置</p>
</li>
<li>mysql&gt; insert into t values(now(),now(),now());</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+————+———-+———————+</li>
<li>| d          | t        | dt                  |</li>
<li>+————+———-+———————+</li>
<li>| 2015-10-02 | 06:04:42 | 2015-10-02 06:04:42 |</li>
<li>+————+———-+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_test;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; create table t(id1 timestamp);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———–+——+—–+——————-+—————————–+</li>
<li>| Field | Type      | Null | Key | Default           | Extra                       |</li>
<li>+——-+———–+——+—–+——————-+—————————–+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |</li>
<li>+——-+———–+——+—–+——————-+—————————–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t values(null);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+</li>
<li>| id1                 |</li>
<li>+———————+</li>
<li>| 2015-10-02 06:05:20 |</li>
<li>+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t add id2 timestamp;</p>
</li>
<li>Query OK, 1 row affected (0.04 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; show create table t \G;</p>
</li>
<li><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></li>
<li>Table: t</li>
<li>Create Table: CREATE TABLE `t` (</li>
<li>`id1` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</li>
<li>`id2` timestamp NOT NULL DEFAULT ‘0000-00-00 00:00:00’</li>
<li>) ENGINE=InnoDB DEFAULT CHARSET=utf8</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>ERROR:</p>
</li>
<li><p>No query specified</p>
</li>
<li><p>mysql&gt; create table t8( id1 timestamp not null default current_timestamp, id2 datetime default null );</p>
</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; show variables like ‘time_zone’;</p>
</li>
<li>+—————+——–+</li>
<li>| Variable_name | Value  |</li>
<li>+—————+——–+</li>
<li>| time_zone     | SYSTEM |</li>
<li>+—————+——–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t8 ;</p>
</li>
<li><p>Empty set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t8 values(now(),now());</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t8;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 06:07:16 | 2015-10-02 06:07:16 |</li>
<li>+———————+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; set time_zone=’+9:00’;</p>
</li>
<li><p>Query OK, 0 rows affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from t8;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:07:16 | 2015-10-02 06:07:16 |</li>
<li>+———————+———————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; desc t8;</p>
</li>
<li>+——-+———–+——+—–+——————-+——-+</li>
<li>| Field | Type      | Null | Key | Default           | Extra |</li>
<li>+——-+———–+——+—–+——————-+——-+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP |       |</li>
<li>| id2   | datetime  | YES  |     | NULL              |       |</li>
<li>+——-+———–+——+—–+——————-+——-+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| Field | Type      | Null | Key | Default             | Extra                       |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP   | on update CURRENT_TIMESTAMP |</li>
<li>| id2   | timestamp | NO   |     | 0000-00-00 00:00:00 |                             |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) values(‘19700101080001’);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) values(19700101080001);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) values(19700101080000);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; show warnings;</p>
</li>
<li><p>Empty set (0.00 sec)</p>
</li>
<li><p>mysql&gt; desc t1;</p>
</li>
<li>+——-+—————+——+—–+———+——-+</li>
<li>| Field | Type          | Null | Key | Default | Extra |</li>
<li>+——-+—————+——+—–+———+——-+</li>
<li>| id1   | float         | YES  |     | NULL    |       |</li>
<li>| id2   | double        | YES  |     | NULL    |       |</li>
<li>| id3   | decimal(10,0) | YES  |     | NULL    |       |</li>
<li>+——-+—————+——+—–+———+——-+</li>
<li><p>3 rows in set (0.01 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| Field | Type      | Null | Key | Default             | Extra                       |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li>| id1   | timestamp | NO   |     | CURRENT_TIMESTAMP   | on update CURRENT_TIMESTAMP |</li>
<li>| id2   | timestamp | NO   |     | 0000-00-00 00:00:00 |                             |</li>
<li>+——-+———–+——+—–+———————+—————————–+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) value(‘2038-01-19 11:14:07’);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:07 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) value(‘2038-01-19 11:14:08’);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:07 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:08 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t(id1) value(‘2097-01-19 11:14:08’);</p>
</li>
<li><p>Query OK, 1 row affected, 1 warning (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+———————+———————+</li>
<li>| id1                 | id2                 |</li>
<li>+———————+———————+</li>
<li>| 2015-10-02 22:05:20 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:07 | 0000-00-00 00:00:00 |</li>
<li>| 2038-01-19 11:14:08 | 0000-00-00 00:00:00 |</li>
<li>| 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |</li>
<li>+———————+———————+</li>
<li><p>7 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_date;</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; create table t(y year);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; desc t;</p>
</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| Field | Type    | Null | Key | Default | Extra |</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| y     | year(4) | YES  |     | NULL    |       |</li>
<li>+——-+———+——+—–+———+——-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t values(2100);</p>
</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+——+</li>
<li>| y    |</li>
<li>+——+</li>
<li>| 2100 |</li>
<li>+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table t6(dt datetime);</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(‘2007-9-3 12:10:10’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(‘2007/9/3 12+10+10’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(‘20070903121010’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into t6 values(20070903121010);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t6;</p>
</li>
<li>+———————+</li>
<li>| dt                  |</li>
<li>+———————+</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>| 2007-09-03 12:10:10 |</li>
<li>+———————+</li>
<li><p>4 rows in set (0.01 sec)</p>
</li>
<li><p>5.varchar与char字段的长度</p>
</li>
<li>mysql&gt; create table vc(v varchar(4),c char(4));</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into vc values(‘ab ‘,’ab     ‘);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select length(v),length(c) from vc;</p>
</li>
<li>+———–+———–+</li>
<li>| length(v) | length(c) |</li>
<li>+———–+———–+</li>
<li>|         3 |         2 |</li>
<li>+———–+———–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select concat(v,’+’),concat(c,’+’) from vc;</p>
</li>
<li>+—————+—————+</li>
<li>| concat(v,’+’) | concat(c,’+’) |</li>
<li>+—————+—————+</li>
<li>| ab +          | ab+           |</li>
<li>+—————+—————+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; drop table t;</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; create table t (c binary(3));</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into t set c=’a’;</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select *,hex(c),c=’a’,c=’a\0’,c=’a\0\0’ from t;</p>
</li>
<li>+——+——–+——-+———+———–+</li>
<li>| c    | hex(c) | c=’a’ | c=’a\0’ | c=’a\0\0’ |</li>
<li>+——+——–+——-+———+———–+</li>
<li>| a    | 610000 |     0 |       0 |         1 |</li>
<li>+——+——–+——-+———+———–+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_binary;</p>
</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>6.枚举型字段</p>
</li>
<li>mysql&gt; create table t(gender enum(‘M’,’F’));</li>
<li><p>Query OK, 0 rows affected (0.02 sec)</p>
</li>
<li><p>mysql&gt; insert into t values(‘m’),(‘1’),(‘f’),(null);</p>
</li>
<li>Query OK, 4 rows affected (0.01 sec)</li>
<li><p>Records: 4  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+——–+</li>
<li>| gender |</li>
<li>+——–+</li>
<li>| M      |</li>
<li>| M      |</li>
<li>| F      |</li>
<li>| NULL   |</li>
<li>+——–+</li>
<li><p>4 rows in set (0.01 sec)</p>
</li>
<li><p>mysql&gt; alter table t rename t_enum;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>7.set类型字段设置</p>
</li>
<li>mysql&gt; create table t(col set (‘a’,’b’,’c’,’d’ ));</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; insert into t value(‘a,b’),(‘a,d,a’),(‘a,b’),(‘a,c’),(‘a’);</p>
</li>
<li>Query OK, 5 rows affected (0.01 sec)</li>
<li><p>Records: 5  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from t;</p>
</li>
<li>+——+</li>
<li>| col  |</li>
<li>+——+</li>
<li>| a,b  |</li>
<li>| a,d  |</li>
<li>| a,b  |</li>
<li>| a,c  |</li>
<li>| a    |</li>
<li>+——+</li>
<li>5 rows in set (0.00 sec)</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/06/2019030500082/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/06/2019030500082/" title="mysql 学习记录（三）--字段">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/06/2019030500083/">
    		mysql 学习记录（二）--查询，权限，字段控制
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-06T04:32:01.000Z">2015-11-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <ol>
<li>1.统计列分类数目</li>
<li>mysql&gt; select count(1) from test;</li>
<li>+———-+</li>
<li>| count(1) |</li>
<li>+———-+</li>
<li>|        9 |</li>
<li>+———-+</li>
<li><p>1 row in set (0.02 sec)</p>
</li>
<li><p>2.分组统计</p>
</li>
<li>mysql&gt; select ename,count(1) from test group by ename;</li>
<li>+———-+———-+</li>
<li>| ename    | count(1) |</li>
<li>+———-+———-+</li>
<li>| aaaaa    |        3 |</li>
<li>| ccccc    |        1 |</li>
<li>| def      |        1 |</li>
<li>| newName2 |        1 |</li>
<li>| newName3 |        1 |</li>
<li>| newNane1 |        1 |</li>
<li>| ttttt    |        1 |</li>
<li>+———-+———-+</li>
<li><p>7 rows in set (0.00 sec)</p>
</li>
<li><p>3.在分组的统计数据的基础上再进行相同的统计</p>
</li>
<li>mysql&gt; select ename,count(1) from test group by ename with rollup;</li>
<li>+———-+———-+</li>
<li>| ename    | count(1) |</li>
<li>+———-+———-+</li>
<li>| aaaaa    |        3 |</li>
<li>| ccccc    |        1 |</li>
<li>| def      |        1 |</li>
<li>| newName2 |        1 |</li>
<li>| newName3 |        1 |</li>
<li>| newNane1 |        1 |</li>
<li>| ttttt    |        1 |</li>
<li>| NULL     |        9 |</li>
<li>+———-+———-+</li>
<li><p>8 rows in set (0.00 sec)</p>
</li>
<li><p>4.按分组统计的结果计数</p>
</li>
<li>mysql&gt; select ename,count(1) from test group by ename having count(1) &gt; 1;</li>
<li>+——-+———-+</li>
<li>| ename | count(1) |</li>
<li>+——-+———-+</li>
<li>| aaaaa |        3 |</li>
<li>+——-+———-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>5.统计总数量、最大值、最小值</p>
</li>
<li>mysql&gt; select sum(age),max(age),min(age) from test;</li>
<li>+———-+———-+———-+</li>
<li>| sum(age) | max(age) | min(age) |</li>
<li>+———-+———-+———-+</li>
<li>|      112 |       81 |        1 |</li>
<li>+———-+———-+———-+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>6.左右连接</p>
</li>
<li>mysql&gt; create table emp( ename varchar(20), hiredate date, sal int(11), deptno int(11) );</li>
<li><p>Query OK, 0 rows affected (0.04 sec)</p>
</li>
<li><p>mysql&gt; insert into emp(ename,hiredate,sal,deptno) values (‘zzx’,’2000-01-01’,2000,1), (‘lisa’,’2003-02-01’,4000,2), (‘bjguan’,’</p>
</li>
<li>2004-04-02’,5000,1), (‘bzshen’,’2005-04-01’,4000,3);</li>
<li>Query OK, 4 rows affected (0.00 sec)</li>
<li><p>Records: 4  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from emp;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; create table  dept ( deptno int(11), deptname varchar(20) );</p>
</li>
<li><p>Query OK, 0 rows affected (0.05 sec)</p>
</li>
<li><p>mysql&gt; insert into dept(deptno,deptname) values (1,’tech’), (2,’sale’), (3,’hr’);</p>
</li>
<li>Query OK, 3 rows affected (0.01 sec)</li>
<li><p>Records: 3  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from dept;</p>
</li>
<li>+——–+———-+</li>
<li>| deptno | deptname |</li>
<li>+——–+———-+</li>
<li>|      1 | tech     |</li>
<li>|      2 | sale     |</li>
<li>|      3 | hr       |</li>
<li>+——–+———-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp,dept where emp.deptno = dept.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bjguan | tech     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp</p>
</li>
<li>-&gt; left join dept on emp.deptno = dept.deptno;</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bjguan | tech     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into emp (ename) values (‘dony’);</p>
</li>
<li><p>Query OK, 1 row affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp left join dept on emp.deptno = dept.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bjguan | tech     |</li>
<li>| bzshen | hr       |</li>
<li>| dony   | NULL     |</li>
<li>+——–+———-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>| dony   | NULL       | NULL |   NULL |</li>
<li>+——–+————+——+——–+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp right join dept on emp.deptno = dept.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| bjguan | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select ename,deptname from emp right join dept on dept.deptno=emp.deptno;</p>
</li>
<li>+——–+———-+</li>
<li>| ename  | deptname |</li>
<li>+——–+———-+</li>
<li>| zzx    | tech     |</li>
<li>| bjguan | tech     |</li>
<li>| lisa   | sale     |</li>
<li>| bzshen | hr       |</li>
<li>+——–+———-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp where deptno in ( select deptno from dept);</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>7.几种嵌套查询</p>
</li>
<li>mysql&gt; select * from emp where deptno = ( select deptno from dept limit 1);</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>+——–+————+——+——–+</li>
<li><p>2 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from emp where deptno in ( select deptno from dept );</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select emp.* from emp ,dept where emp.deptno = dept.deptno;</p>
</li>
<li>+——–+————+——+——–+</li>
<li>| ename  | hiredate   | sal  | deptno |</li>
<li>+——–+————+——+——–+</li>
<li>| zzx    | 2000-01-01 | 2000 |      1 |</li>
<li>| lisa   | 2003-02-01 | 4000 |      2 |</li>
<li>| bjguan | 2004-04-02 | 5000 |      1 |</li>
<li>| bzshen | 2005-04-01 | 4000 |      3 |</li>
<li>+——–+————+——+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>8.组合查询</p>
</li>
<li>mysql&gt; select deptno from emp union  select deptno from dept;</li>
<li>+——–+</li>
<li>| deptno |</li>
<li>+——–+</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      3 |</li>
<li>|   NULL |</li>
<li>+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select deptno from emp union all   select deptno from dept;</p>
</li>
<li>+——–+</li>
<li>| deptno |</li>
<li>+——–+</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      1 |</li>
<li>|      3 |</li>
<li>|   NULL |</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      3 |</li>
<li>+——–+</li>
<li><p>8 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select deptno from emp union  select deptno from dept;</p>
</li>
<li>+——–+</li>
<li>| deptno |</li>
<li>+——–+</li>
<li>|      1 |</li>
<li>|      2 |</li>
<li>|      3 |</li>
<li>|   NULL |</li>
<li>+——–+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>9.权限设置举例</p>
</li>
<li>mysql&gt; grant select,update on test1.* to z1@localhost identified by ‘test’;</li>
<li><p>Query OK, 0 rows affected (0.00 sec)</p>
</li>
<li><p>[root@ ~]# mysql -uz1 -ptest</p>
</li>
<li>mysql&gt; use test1;</li>
<li>Reading table information for completion of table and column names</li>
<li><p>You can turn off this feature to get a quicker startup with -A</p>
</li>
<li><p>mysql&gt; insert into emp(sal,deptno) values(‘2000’,3);</p>
</li>
<li><p>ERROR 1142 (42000): INSERT command denied to user ‘z1‘@’localhost’ for table ‘emp’.</p>
</li>
<li><p>10.内置帮助的使用</p>
</li>
<li>mysql&gt; ? contents</li>
<li>You asked for help about help category: “Contents”</li>
<li>For more information, type ‘help <item>‘, where <item> is one of the following</item></item></li>
<li>categories:</li>
<li>Account Management</li>
<li>Administration</li>
<li>Compound Statements</li>
<li>Data Definition</li>
<li>Data Manipulation</li>
<li>Data Types</li>
<li>Functions</li>
<li>Functions and Modifiers for Use with GROUP BY</li>
<li>Geographic Features</li>
<li>Help Metadata</li>
<li>Language Structure</li>
<li>Plugins</li>
<li>Procedures</li>
<li>Storage Engines</li>
<li>Table Maintenance</li>
<li>Transactions</li>
<li>User-Defined Functions</li>
<li><p>Utility</p>
</li>
<li><p>mysql&gt; ? data types</p>
</li>
<li>You asked for help about help category: “Data Types”</li>
<li>For more information, type ‘help <item>‘, where <item> is one of the following</item></item></li>
<li>topics:</li>
<li>AUTO_INCREMENT</li>
<li>BIGINT</li>
<li>BINARY</li>
<li>BIT</li>
<li>BLOB</li>
<li>BLOB DATA TYPE</li>
<li>BOOLEAN</li>
<li>CHAR</li>
<li>CHAR BYTE</li>
<li>DATE</li>
<li>DATETIME</li>
<li>DEC</li>
<li>DECIMAL</li>
<li>DOUBLE</li>
<li>DOUBLE PRECISION</li>
<li>ENUM</li>
<li>FLOAT</li>
<li>INT</li>
<li>INTEGER</li>
<li>LONGBLOB</li>
<li>LONGTEXT</li>
<li>MEDIUMBLOB</li>
<li>MEDIUMINT</li>
<li>MEDIUMTEXT</li>
<li>SET DATA TYPE</li>
<li>SMALLINT</li>
<li>TEXT</li>
<li>TIME</li>
<li>TIMESTAMP</li>
<li>TINYBLOB</li>
<li>TINYINT</li>
<li>TINYTEXT</li>
<li>VARBINARY</li>
<li>VARCHAR</li>
<li><p>YEAR DATA TYPE</p>
</li>
<li><p>11.通过操作此表可以实现迅速修改表名等操作。</p>
</li>
<li><p>mysql&gt; select * from information_schema.tables;</p>
</li>
<li><p>12.字段的长度测试</p>
</li>
<li>mysql&gt; create table t1(id1 int,id2 int(5));</li>
<li><p>Query OK, 0 rows affected (0.06 sec)</p>
</li>
<li><p>mysql&gt; desc t1;</p>
</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| Field | Type    | Null | Key | Default | Extra |</li>
<li>+——-+———+——+—–+———+——-+</li>
<li>| id1   | int(11) | YES  |     | NULL    |       |</li>
<li>| id2   | int(5)  | YES  |     | NULL    |       |</li>
<li><p>+——-+———+——+—–+———+——-+</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+——+——+</li>
<li>| id1  | id2  |</li>
<li>+——+——+</li>
<li>|    1 |    1 |</li>
<li>+——+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table t1 modify id1 int zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table t1 modify id2 int(5) zerofill;</p>
</li>
<li>Query OK, 1 row affected (0.05 sec)</li>
<li><p>Records: 1  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; insert into t1 values(1,1111111);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from t1;</p>
</li>
<li>+————+———+</li>
<li>| id1        | id2     |</li>
<li>+————+———+</li>
<li>| 0000000001 |   00001 |</li>
<li>| 0000000001 | 1111111 |</li>
<li>+————+———+</li>
<li>2 rows in set (0.00 sec)</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/06/2019030500083/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/06/2019030500083/" title="mysql 学习记录（二）--查询，权限，字段控制">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/06/2019030500081/">
    		mysql 学习记录（一）--建表，增加，删除，修改，基本查询
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-06T04:27:38.000Z">2015-11-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/学习/" title="学习">学习</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <ol>
<li>1.建立数据库</li>
<li>mysql&gt; create database test1;</li>
<li><p>Query OK, 1 row affected (0.02 sec)</p>
</li>
<li><p>2.建立了数据再建立，则：</p>
</li>
<li>mysql&gt; create database test1;</li>
<li><p>ERROR 1007 (HY000): Can’t create database ‘test1’; database exists</p>
</li>
<li><p>3.显示数据库信息：</p>
</li>
<li>mysql&gt; show databases;</li>
<li>+——————–+</li>
<li>| Database           |</li>
<li>+——————–+</li>
<li>| information_schema |</li>
<li>| mysql              |</li>
<li>| performance_schema |</li>
<li>| test               |</li>
<li>| test1              |</li>
<li>+——————–+</li>
<li><p>5 rows in set (0.05 sec)</p>
</li>
<li><p>4.进入数据库</p>
</li>
<li>mysql&gt; use test1;</li>
<li><p>Database changed</p>
</li>
<li><p>5.显示表中的数据库：</p>
</li>
<li>mysql&gt; show tables;</li>
<li><p>Empty set (0.00 sec)</p>
</li>
<li><p>6.删除数据库：</p>
</li>
<li>mysql&gt; drop database test1;</li>
<li><p>Query OK, 0 rows affected (0.07 sec)</p>
</li>
<li><p>7.建立表：</p>
</li>
<li>mysql&gt; create database test1;</li>
<li>Query OK, 1 row affected (0.01 sec)</li>
<li>mysql&gt; use test1;</li>
<li>Database changed</li>
<li>mysql&gt; create table emp(ename varchar(10), hiredate date , sal decimal(10,2), deptno int(2));</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li>mysql&gt; desc emp;</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(10)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>8.显示DDL语句：</p>
</li>
<li>mysql&gt; show create table emp \G;</li>
<li><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></li>
<li>Table: emp</li>
<li>Create Table: CREATE TABLE `emp` (</li>
<li>`ename` varchar(10) DEFAULT NULL,</li>
<li>`hiredate` date DEFAULT NULL,</li>
<li>`sal` decimal(10,2) DEFAULT NULL,</li>
<li>`deptno` int(2) DEFAULT NULL</li>
<li>) ENGINE=InnoDB DEFAULT CHARSET=utf8</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>ERROR:</p>
</li>
<li><p>No query specified</p>
</li>
<li><p>9.删除表：</p>
</li>
<li>mysql&gt; drop table emp;</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>10.修改表字段名称，删除表字段</p>
</li>
<li>mysql&gt; create table emp(ename varchar(10), hiredate date , sal decimal(10,2), deptno int(2));\</li>
<li><p>Query OK, 0 rows affected (0.03 sec)</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(10)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp modify ename varchar(20);</p>
</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(20)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp add column age int(3);</p>
</li>
<li>Query OK, 0 rows affected (0.06 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(20)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>| deptno   | int(2)        | YES  |     | NULL    |       |</li>
<li>| age      | int(3)        | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp drop column age;</p>
</li>
<li>Query OK, 0 rows affected (0.06 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| Field    | Type          | Null | Key | Default | Extra |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li>| ename    | varchar(20)   | YES  |     | NULL    |       |</li>
<li>| hiredate | date          | YES  |     | NULL    |       |</li>
<li>| sal      | decimal(10,2) | YES  |     | NULL    |       |</li>
<li>+———-+—————+——+—–+———+——-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp change age age1 int(4);</p>
</li>
<li>ERROR 1054 (42S22): Unknown column ‘age’ in ‘emp’</li>
<li>mysql&gt; alter table emp change sal sal_salart int(4);</li>
<li>Query OK, 0 rows affected (0.04 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>| sal_salart | int(4)      | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>11.修改表字段顺序：</p>
</li>
<li>mysql&gt; alter table emp add birth date after ename;</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table emp add testColumn date after ename;</p>
</li>
<li>Query OK, 0 rows affected (0.08 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| testColumn | date        | YES  |     | NULL    |       |</li>
<li>| birth      | date        | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>| sal_salart | int(4)      | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp modify sal_salart int(5) first;</p>
</li>
<li>Query OK, 0 rows affected (0.06 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| sal_salart | int(5)      | YES  |     | NULL    |       |</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| testColumn | date        | YES  |     | NULL    |       |</li>
<li>| birth      | date        | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li><p>5 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table emp rename emp_test;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>12.增加字段：</p>
</li>
<li>mysql&gt; alter table emp_test add column age int(3);</li>
<li>Query OK, 0 rows affected (0.05 sec)</li>
<li><p>Records: 0  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; desc emp_test;</p>
</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| Field      | Type        | Null | Key | Default | Extra |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>| sal_salart | int(5)      | YES  |     | NULL    |       |</li>
<li>| ename      | varchar(20) | YES  |     | NULL    |       |</li>
<li>| testColumn | date        | YES  |     | NULL    |       |</li>
<li>| birth      | date        | YES  |     | NULL    |       |</li>
<li>| hiredate   | date        | YES  |     | NULL    |       |</li>
<li>| age        | int(3)      | YES  |     | NULL    |       |</li>
<li>+————+————-+——+—–+———+——-+</li>
<li>6 rows in set (0.00 sec)</li>
<li>mysql&gt; alter table emp_test rename test;</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>13.插入数据：</p>
</li>
<li>mysql&gt; use test1;</li>
<li>Reading table information for completion of table and column names</li>
<li><p>You can turn off this feature to get a quicker startup with -A</p>
</li>
<li><p>Database changed</p>
</li>
<li><p>mysql&gt; insert into test(ename,age) values(‘abc’,3);</p>
</li>
<li><p>Query OK, 1 row affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into test(ename,age) values(‘abc’,3),(‘def’,9);</p>
</li>
<li>Query OK, 2 rows affected (0.01 sec)</li>
<li><p>Records: 2  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    9 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>14.修改数据：</p>
</li>
<li>mysql&gt; update test set age = 8 where ename = ‘def’;</li>
<li>Query OK, 1 row affected (0.01 sec)</li>
<li><p>Rows matched: 1  Changed: 1  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    8 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; update test set age = 8 where ename = ‘def22222222’;</p>
</li>
<li>Query OK, 0 rows affected (0.01 sec)</li>
<li><p>Rows matched: 0  Changed: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    8 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; update test set age = 81 where ename = ‘def22222222’;</p>
</li>
<li>Query OK, 0 rows affected (0.01 sec)</li>
<li><p>Rows matched: 0  Changed: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |    8 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; update test set age = 81 where ename = ‘def’;</p>
</li>
<li>Query OK, 1 row affected (0.00 sec)</li>
<li><p>Rows matched: 1  Changed: 1  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | abc   | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>15.删除数据</p>
</li>
<li>mysql&gt; delete from test where age = 3;</li>
<li><p>Query OK, 2 rows affected (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>1 row in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert test(ename,age) values (‘aaaaa’,3),(‘aaaaa’,5),(‘ccccc’,3), (‘aaaaa’,9), (‘ttttt’,2);</p>
</li>
<li>Query OK, 5 rows affected (0.01 sec)</li>
<li><p>Records: 5  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>16.查询数据：</p>
</li>
<li>mysql&gt; alter table test rename test_col;</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from test_col;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table test_col rename test;</p>
</li>
<li><p>Query OK, 0 rows affected (0.01 sec)</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; selecdt distinct ename from test;</p>
</li>
<li>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘selecdt distinct ename from test’ at line 1</li>
<li>mysql&gt; select distinct ename from test;</li>
<li>+——-+</li>
<li>| ename |</li>
<li>+——-+</li>
<li>| def   |</li>
<li>| aaaaa |</li>
<li>| ccccc |</li>
<li>| ttttt |</li>
<li>+——-+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test where ename = ‘aaaaa’;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>3 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test where age &lt; 8;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>4 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test order by age;</p>
</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |</li>
<li>+————+——-+————+——-+———-+——+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; alter table test add column salart int (11);</p>
</li>
<li>Query OK, 6 rows affected (0.06 sec)</li>
<li><p>Records: 6  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; alter table test change salart salary int (11);</p>
</li>
<li>Query OK, 6 rows affected (0.05 sec)</li>
<li><p>Records: 6  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+——-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+——-+————+——-+———-+——+——–+</li>
<li>|       NULL | def   | NULL       | NULL  | NULL     |   81 |   NULL |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    5 |   NULL |</li>
<li>|       NULL | ccccc | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa | NULL       | NULL  | NULL     |    9 |   NULL |</li>
<li>|       NULL | ttttt | NULL       | NULL  | NULL     |    2 |   NULL |</li>
<li>+————+——-+————+——-+———-+——+——–+</li>
<li><p>6 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; insert into test(ename,age,salary) values  (‘newNane1’,1,100),</p>
</li>
<li>-&gt; (‘newName2’,3,80),</li>
<li>-&gt; (‘newName3’,5,10);</li>
<li>Query OK, 3 rows affected (0.01 sec)</li>
<li><p>Records: 3  Duplicates: 0  Warnings: 0</p>
</li>
<li><p>mysql&gt; select * from test;</p>
</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename    | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>|       NULL | def      | NULL       | NULL  | NULL     |   81 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    5 |   NULL |</li>
<li>|       NULL | ccccc    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    9 |   NULL |</li>
<li>|       NULL | ttttt    | NULL       | NULL  | NULL     |    2 |   NULL |</li>
<li>|       NULL | newNane1 | NULL       | NULL  | NULL     |    1 |    100 |</li>
<li>|       NULL | newName2 | NULL       | NULL  | NULL     |    3 |     80 |</li>
<li>|       NULL | newName3 | NULL       | NULL  | NULL     |    5 |     10 |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li><p>9 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test order by salary;</p>
</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename    | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>|       NULL | def      | NULL       | NULL  | NULL     |   81 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    5 |   NULL |</li>
<li>|       NULL | ccccc    | NULL       | NULL  | NULL     |    3 |   NULL |</li>
<li>|       NULL | aaaaa    | NULL       | NULL  | NULL     |    9 |   NULL |</li>
<li>|       NULL | ttttt    | NULL       | NULL  | NULL     |    2 |   NULL |</li>
<li>|       NULL | newName3 | NULL       | NULL  | NULL     |    5 |     10 |</li>
<li>|       NULL | newName2 | NULL       | NULL  | NULL     |    3 |     80 |</li>
<li>|       NULL | newNane1 | NULL       | NULL  | NULL     |    1 |    100 |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li><p>9 rows in set (0.00 sec)</p>
</li>
<li><p>mysql&gt; select * from test order by salary limit 6,3;</p>
</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>| sal_salart | ename    | testColumn | birth | hiredate | age  | salary |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>|       NULL | newName3 | NULL       | NULL  | NULL     |    5 |     10 |</li>
<li>|       NULL | newName2 | NULL       | NULL  | NULL     |    3 |     80 |</li>
<li>|       NULL | newNane1 | NULL       | NULL  | NULL     |    1 |    100 |</li>
<li>+————+———-+————+——-+———-+——+——–+</li>
<li>3 rows in set (0.00 sec)</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/06/2019030500081/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/06/2019030500081/" title="mysql 学习记录（一）--建表，增加，删除，修改，基本查询">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/05/2019030500030/">
    		数据库对于开发应该知道的优化操作
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-05T12:01:04.000Z">2015-11-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/数据库/" title="数据库">数据库</a> / 
    
        <a href="/tags/优化/" title="优化">优化</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><strong>对于数据库的一些优化操作</strong> 1：<em>访问少，查询小，</em> 应用程序中，保证在实现功能的基础上，尽量减少对数据库的访问次数；通过搜索参数，尽量减少对表的访问行数,最小化结果集，从而减轻网络负担；能够分开的操作尽量分开处理，提高每次的响应速度；在数据窗口使用SQL时，尽量把使用的索引放在选择的首列；算法的结构尽量简单；在查询时，不要过多地使用通配符如： SELECT <em> FROM T1语句， 要用到几列就选择几列如：SELECT COL1,COL2 FROM T1； 在可能的情况下尽量限制尽量结果集行数如：SELECT TOP 300 COL1,COL2,COL3 FROM T1,因为某些情况下用户是不需要那么多的数据的。 不要在应用中使用数据库游标，游标是非常有用的工具，但比使用常规的、面向集的SQL语句需要更大的开销；按照特定顺序提取数据的查找。 2：<em>类型不乱用</em> 避免使用不兼容的数据类型。 例如float和int、char和varchar、binary和varbinary是不兼容的。数据类型的不兼容可能使优化器无法执行一些本来可以进行的优化操作。例如: SELECT name FROM employee WHERE salary ＞ 60000 在这条语句中,如salary字段是money型的,则优化器很难对其进行优化,因为60000 是个整型数。我们应当在编程时将整型转化成为钱币型,而不要等到运行时转化。 3：<em>避免在WHERE子句中对字段进行函数或表达式操作</em>， 这将导致引擎放弃使用索引而进行全表扫描。如： SELECT </em> FROM T1 WHERE F1/2=100 应改为: SELECT <em> FROM T1 WHERE F1=100\</em>2 SELECT * FROM RECORD WHERE SUBSTRING(CARD_NO,1,4)=’5378’ 应改为: SELECT <em> FROM RECORD WHERE CARD_NO LIKE ‘5378%’ SELECT member_number, first_name, last_name FROM members WHERE DATEDIFF(yy,datofbirth,GETDATE()) &gt; 21 应改为: SELECT member_number, first_name, last_name FROM members WHERE dateofbirth &lt; DATEADD(yy,-21,GETDATE()) 即：任何对列的操作都将导致表扫描，它包括数据库函数、计算表达式等等，查询 时要尽可能将操作移至等号右边。 4、 <em>避免使用操作符</em> 如：!=或＜＞、IS NULL或IS NOT NULL、IN ，NOT IN等这样的操作符, 因为这会使系统无法使用索引,而只能直接搜索表中的数据。例如: SELECT id FROM employee WHERE id != ‘B%’ 优化器将无法通过索引来确定将要命中的行数,因此需要搜索该表的所有行。 5、 尽量使用数字型字段，一部分开发人员和数据库管理人员喜欢把包含数值信 息的字段 设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在 处理查询和连接回逐个比较字符串中每一个字符，而对于数字型而言只需要比较一 次就够了。 6、 <em>合理使用EXISTS,NOT EXISTS子句</em> 如下所示： a.SELECT SUM(T1.C1)FROM T1 WHERE( (SELECT COUNT(</em>)FROM T2 WHERE T2.C2=T1.C2&gt;0) b.SELECT SUM(T1.C1) FROM T1WHERE EXISTS( SELECT <em> FROM T2 WHERE T2.C2=T1.C2) 两者产生相同的结果，但是后者的效率显然要高于前者。因为后者不会产生大量锁 定的表扫描或是索引扫描。 如果你想校验表里是否存在某条纪录，不要用count(</em>)那样效率很低，而且浪费服 务器资源。可以用EXISTS代替。如： IF (SELECT COUNT(<em>) FROM table_name WHERE column_name = ‘xxx’) 可以写成： IF EXISTS (SELECT </em> FROM table_name WHERE column_name = ‘xxx’) 经常需要写一个T_SQL语句比较一个父结果集和子结果集，从而找到是否存在在父 结果集中有而在子结果集中没有的记录，如： a.SELECT a.hdr_key FROM hdr_tbl a WHERE NOT EXISTS (SELECT <em> FROM dtl_tbl b WHERE a.hdr_key = b.hdr_key) b.SELECT a.hdr_key FROM hdr_tbl a LEFT JOIN dtl_tbl b ON a.hdr_key = b.hdr_key WHERE b.hdr_key IS NULL c.SELECT hdr_key FROM hdr_tbl WHERE hdr_key NOT IN (SELECT hdr_key FROM dtl_tbl) 三种写法都可以得到同样正确的结果，但是效率依次降低。 7、 尽量避免在索引过的字符数据中，使用非打头字母搜索。这也使得引擎无法 利用索引。 见如下例子： SELECT </em> FROM T1 WHERE NAME LIKE ‘%L%’ SELECT <em> FROM T1 WHERE SUBSTING(NAME,2,1)=’L’ SELECT </em> FROM T1 WHERE NAME LIKE ‘L%’ 即使NAME字段建有索引，前两个查询依然无法利用索引完成加快操作，引擎不得不 对全表所有数据逐条操作来完成任务。而第三个查询能够使用索引来加快操作。 8、<em>利用多条件查询</em> 分利用连接条件，在某种情况下，两个表之间可能不只一个的连接条件，这 时在 WHERE 子句中将连接条件完整的写上，有可能大大提高查询速度。 例： SELECT SUM(A.AMOUNT) FROM ACCOUNT A,CARD B WHERE A.CARD_NO = B.CARD_NO SELECT SUM(A.AMOUNT) FROM ACCOUNT A,CARD B WHERE A.CARD_NO = B.CARD_NO AND A.ACCOUNT_NO=B.ACCOUNT_NO 第二句将比第一句执行快得多。 9、 <em>消除对大型表行数据的顺序存取</em> 尽管在所有的检查列上都有索引，但某些形式的WHERE子句强迫优化器使用 顺序存取。如： SELECT <em> FROM orders WHERE (customer_num=104 AND order_num&gt;1001) OR order_num=1008 解决办法可以使用并集来避免顺序存取： SELECT </em> FROM orders WHERE customer_num=104 AND order_num&gt;1001 UNION SELECT <em> FROM orders WHERE order_num=1008 这样就能利用索引路径处理查询。 10、 <em>避免困难的正规表达式</em> LIKE关键字支持通配符匹配，技术上叫正规表达式。但这种匹配特别耗费时 间。例如：SELECT </em> FROM customer WHERE zipcode LIKE “98_ _ _” 即使在zipcode字段上建立了索引，在这种情况下也还是采用顺序扫描的方式。如 果把语句改为SELECT <em> FROM customer WHERE zipcode &gt;“98000”，在执行查询 时就会利用索引来查询，显然会大大提高速度。 11、 <em>使用视图加速查询</em> 把表的一个子集进行排序并创建视图，有时能加速查询。它有助于避免多重排序操作，而且在其他方面还能简化优化器的工作。例如： SELECT cust.name，rcvbles.balance，……other columns FROM cust，rcvbles WHERE cust.customer_id = rcvlbes.customer_id AND rcvblls.balance&gt;0 AND cust.postcode&gt;“98000” ORDER BY cust.name 如果这个查询要被执行多次而不止一次，可以把所有未付款的客户找出来放在一个 视图中，并按客户的名字进行排序： CREATE VIEW DBO.V_CUST_RCVLBES AS SELECT cust.name，rcvbles.balance，……other columns FROM cust，rcvbles WHERE cust.customer_id = rcvlbes.customer_id AND rcvblls.balance&gt;0 ORDER BY cust.name 然后以下面的方式在视图中查询： SELECT </em> FROM V_CUST_RCVLBES WHERE postcode&gt;“98000” 视图中的行要比主表中的行少，而且物理顺序就是所要求的顺序，减少了磁盘 I/O，所以查询工作量可以得到大幅减少。 12、 <em>能够用BETWEEN的就不要用IN</em> SELECT <em> FROM T1 WHERE ID IN (10,11,12,13,14) 改成： SELECT </em> FROM T1 WHERE ID BETWEEN 10 AND 14 因为IN会使系统无法使用索引,而只能直接搜索表中的数据。 13、 <em>DISTINCT的就不用GROUP BY</em> SELECT OrderID FROM Details WHERE UnitPrice &gt; 10 GROUP BY OrderID 可改为： SELECT DISTINCT OrderID FROM Details WHERE UnitPrice &gt; 10 14、 部分利用索引 1.SELECT employeeID, firstname, lastname FROM names WHERE dept = ‘prod’ or city = ‘Orlando’ or division = ‘food’ 2.SELECT employeeID, firstname, lastname FROM names WHERE dept = ‘prod’ UNION ALL SELECT employeeID, firstname, lastname FROM names WHERE city = ‘Orlando’ UNION ALL SELECT employeeID, firstname, lastname FROM names WHERE division = ‘food’ 如果dept 列建有索引则查询2可以部分利用索引，查询1则不能。 15、 <em>能用UNION ALL就不要用UNION</em> UNION ALL不执行SELECT DISTINCT函数，这样就会减少很多不必要的资源 16、 <em>不要写一些不做任何事的查询</em> 如：SELECT COL1 FROM T1 WHERE 1=0 SELECT COL1 FROM T1 WHERE COL1=1 AND COL1=2 这类死码不会返回任何结果集，但是会消耗系统资源。 17、 <em>尽量不要用SELECT INTO语句。</em> SELECT INTO 语句会导致表锁定，阻止其他用户访问该表。 18、 <em>必要时强制查询优化器使用某个索引</em> SELECT <em> FROM T1 WHERE nextprocess = 1 AND processid IN (8,32,45) 改成： SELECT </em> FROM T1 (INDEX = IX_ProcessID) WHERE nextprocess = 1 AND processid IN (8,32,45) 则查询优化器将会强行利用索引IX_ProcessID 执行查询。 19、 虽然UPDATE、DELETE语句的写法基本固定，但是还是对UPDATE语句给点建 议： <em>a) 尽量不要修改主键字段。 b) 当修改VARCHAR型字段时，尽量使用相同长度内容的值代替。 c) 尽量最小化对于含有UPDATE触发器的表的UPDATE操作。 d) 避免UPDATE将要复制到其他数据库的列。 e) 避免UPDATE建有很多索引的列。 f) 避免UPDATE在WHERE子句条件中的列</em>。 上面我们提到的是一些基本的提高查询速度的注意事项,但是在更多的情况下,往往 需要反复试验比较不同的语句以得到最佳方案。最好的方法当然是测试，看实现相 同功能的SQL语句哪个执行时间最少，但是数据库中如果数据量很少，是比较不出 来的，这时可以用查看执行计划，即：把实现相同功能的多条SQL语句考到查询分 析器，按CTRL+L看查所利用的索引，表扫描次数（这两个对性能影响最大），总体 上看询成本百分比即可。 简单的存储过程可以用向导自动生成：在企业管理器工具栏点击运行向导图标，点 击”数据库”、”创建存储过程向导”。复杂存储过程的调试：在查询分析器左边 的对象浏览器（没有？按F8）选择要调试的存储过程,点右键，点调试，输入参数 执行，出现一个浮动工具条，上面有单步执行，断点设置等。</p>

            
            <p class="more">
                <a href="/2015/11/05/2019030500030/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/05/2019030500030/" title="数据库对于开发应该知道的优化操作">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/05/2019030500048/">
    		InnoDB的行锁，遇到的死锁和分析
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-05T11:59:00.000Z">2015-11-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/InnoDB/" title="InnoDB">InnoDB</a> / 
    
        <a href="/tags/死锁/" title="死锁">死锁</a> / 
    
        <a href="/tags/锁/" title="锁">锁</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>InnoDB的锁，遇到的死锁和总结 行锁有2种 1）S锁，一个事务加锁后，允许其它事务去读被锁的数据集（获得S锁），防止其它事务获得相同数据集的X锁 2）X锁，一个事务加锁后，防止其它事务去读被锁的数据集（获得S锁），防止其它事务获得相同数据集的X锁 另外，为了兼容表锁，加上了IS锁和IX锁 1）IS锁，一个事务想加S锁钱，得先有该表的IS锁 2）IX锁，一个事务想获得X锁前，得有该表的IX锁   意向锁是InnoDB自动加的，无须干预。 对于update，delete，insert，InnoDB会自动给涉及的数据集加X锁，但不一定同一种锁 对于select，InnoDB不会加任何锁 对于select，我们可以通过  for update 加X锁，通过 lock in share mode 加S锁，这个叫显示加锁   索引的实现方式 行锁通过给索引上的索引的key来加锁，没有索引时，通过因此的聚簇索引来加锁 Record lock 对索引key加锁 （索引使用=，并且索引key存在，条件下获得） Gap lock 间隙锁，索引key之间的间隙，第一条记录之前的间隙，最后一条记录之后的间隙 比如  现在有key      5 10 15，   那么(-∞,5)  （5,10）  （10,15）  （15,+∞)，都构成间隙 (索引使用=，索引key不存在，会对key所在的间隙，加上Gap锁) (索引使用&gt;&lt;，索引key不存在，会对那些不存在的部分所在间隙，加上Gap锁) Next-key lock 前面二者的组合，例如（5,10] 前开后毕的间隙等等 (索引使用&gt;，索引key部分存在，会对key和那些不存在的部分所在间隙，加上Next-key锁) InsertIntention lock 插入欲望锁，insert语句会对插入行加一个X锁，但是插入之前得申请一个 InsertIntention的Gap锁，也就是I锁 (insert时，索引项不存在，会找到索引项所在的间隙，申请这个间隙上的InsertIntention lock)   X-X锁兼容矩阵 G    I     R    N &lt;—-当前锁模式 G    +     +    +    + I    -     +    +    - R    +     +    -    - N    +     +    -    -   没有索引，就用表锁   遇到的问题 ————————————————————————————————————— 假设已经有了800-910之间形成一个间隙   1)T1 start 2)T2 start 3)T1 select <em> from table index=900 for update  获得Gap（800，910） 4)T2 select </em> from table index=901 for update  获得Gap（800，910） 5)T1 insert into table  (index)values（900） 需要获得I锁（800，910），等待T2释放Gap（800，910） 6)T2 insert into table (index)values（901） 需要获得I锁（800，910），等待T1释放Gap（800，910）,产生死锁   —————————————————————————————————————</p>

            
            <p class="more">
                <a href="/2015/11/05/2019030500048/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/05/2019030500048/" title="InnoDB的行锁，遇到的死锁和分析">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/NOSQL/">NOSQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/05/2019030500059/">
    		mongodb的安装和启动
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-05T11:57:53.000Z">2015-11-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MongoDB/" title="MongoDB">MongoDB</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>1、安装 安装非常简单，在管网上下载mongodb-win32-x86_64-2008plus-2.6.3.zip安装包； 创建数据库文件存放目录； 2、启动 进入dos窗口，cd到安装bin目录下，然后操作命令启动mongodb服务：mongod –dbpath 你创建的数据库文件存放目录 mongodb默认连接端口27017，如果可以打开<a href="http://localhost:27017" target="_blank" rel="noopener">http://localhost:27017</a> 则表示启动成功 页面显示：It looks like you are trying to access MongoDB over HTTP on the native driver port. 3、设置自动启动 用记事本打开mongo.config输入： dbpath=你创建的数据库文件存放目录 logpath=你创建的数据库文件存放目录\log\mongo.log 用管理员身份打开cmd命令行，进入你创建的数据库文件存放目录，输入如下的命令： mongod –config 你创建的数据库文件存放目录\mongo.config</p>

            
            <p class="more">
                <a href="/2015/11/05/2019030500059/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/05/2019030500059/" title="mongodb的安装和启动">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/Oracle/">Oracle</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/10/30/2019030500123/">
    		ORA-12514: TNS:监听程序当前无法识别连接描述符中请求的服务
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-10-30T01:22:34.000Z">2015-10-30</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/Oracle/" title="Oracle">Oracle</a> / 
    
        <a href="/tags/PL-SQL/" title="PL/SQL">PL/SQL</a> / 
    
        <a href="/tags/ORA-12514/" title="ORA-12514">ORA-12514</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>PL/SQL连接Oracle数据库的时候 报”ORA-12514: TNS:监听程序当前无法识别连接描述符中请求的服务” 错误   本例原因： 安装Oracle时一般默认实例都是orcl，发现有人不按套路出牌，改了名字，如图 <img src="http://img.blog.csdn.net/20151023163912605?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt>   解决方法： 在Oracle安装目录 找到listener.ora文件 路径为 D:\oracle\product\11.2.0\dbhome_1\NETWORK\ADMIN (根据自己情况查找) 修改：   # listener.ora Network Configuration File: D:\oracl\product\11.2.0\dbhome_1\network\admin\listener.ora # Generated by Oracle configuration tools. SID_LIST_LISTENER = (SID_LIST = (SID_DESC = (SID_NAME = CLRExtProc) (ORACLE_HOME = D:\oracle\product\11.2.0\dbhome_1) (PROGRAM = extproc) (ENVS = “EXTPROC_DLLS=ONLY:D:\oracle\product\11.2.0\dbhome_1\bin\oraclr11.dll”) ) (SID_DESC = (GLOBAL_DBNAME = JTW) (ORACLE_HOME = D:\oracle\product\11.2.0\dbhome_1) (SID_NAME = JTW) ) ) LISTENER = (DESCRIPTION_LIST = (DESCRIPTION = (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521)) (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521)) ) )   红色部分为新添加内容，JTW为监听的实例名 然后修改(添加)instantclient_11_2\network\admin\tnsnames.ora</p>
<p><strong>[plain]</strong></p>
<ol>
<li>MyOracle =</li>
<li>(DESCRIPTION =</li>
<li>(ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))</li>
<li>(CONNECT_DATA =</li>
<li>(SERVER = DEDICATED)</li>
<li>(SERVICE_NAME = jtw)</li>
<li>)</li>
<li>)</li>
</ol>
<p>重启Oracle监听 即可。</p>

            
            <p class="more">
                <a href="/2015/10/30/2019030500123/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/10/30/2019030500123/" title="ORA-12514: TNS:监听程序当前无法识别连接描述符中请求的服务">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/0.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/NOSQL/">NOSQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/10/28/2019030500052/">
    		Linux下快速安装MongoDB
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-10-28T04:54:47.000Z">2015-10-28</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MongoDB/" title="MongoDB">MongoDB</a> / 
    
        <a href="/tags/Database/" title="Database">Database</a> / 
    
        <a href="/tags/dba/" title="dba">dba</a> / 
    
        <a href="/tags/NoSQL/" title="NoSQL">NoSQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>Mongo DB 是目前在IT行业非常流行的一种非关系型数据库(NoSql),其灵活的数据存储方式备受当前IT从业人员的青睐。Mongo DB很好的实现了面向对象的思想(OO思想),在Mongo DB中 每一条记录都是一个Document对象。Mongo DB最大的优势在于所有的数据持久操作都无需开发人员手动编写SQL语句,直接调用方法就可以轻松的实现CRUD操作。本文介绍了如何快速安装mongodb供大家参考。 一、安装配置mongodb Step 1: 设置系统环境及确保缺省端口27107可用 ###当前环境 # cat /etc/issue Red Hat Enterprise Linux Server release 6.5 (Santiago) # vi /etc/selinux/config SELINUX=disabled Step 2: 下载安装文件 下载地址： <a href="https://www.mongodb.org/downloads" target="_blank" rel="noopener">https://www.mongodb.org/downloads</a>. 或者直接在命令提示符下使用curl命令下载 curl -O <a href="https://fastdl.mongodb.org/linux/mongodb-linux-x86\_64-3.0.6.tgz" target="_blank" rel="noopener">https://fastdl.mongodb.org/linux/mongodb-linux-x86\_64-3.0.6.tgz</a> Step 3: 解压下载的文件 # pwd /usr/local/src # tar -xvf mongodb-linux-x86_64-rhel62-3.0.6.gz  ###注，本文直接从网站下载，所以文件为.gz Step 4: 复制解压文件到运行目录 # mkdir -p /var/lib/mongodb # cp -R -n /usr/local/src/mongodb-linux-x86_64-rhel62-3.0.6/. /var/lib/mongodb/ Step 5: 设置环境变量 e.g. export PATH=<mongodb-install-directory>/bin:$PATH # vi ~/.bash_profile export PATH=/var/lib/mongodb/bin:$PATH # source ~/.bash_profile Step 6: 创建数据目录 # mkdir -p /data/mongodata 二、启动及验证mongodb ###启动mongo # mongod –dbpath /data/mongodata ###以下内容为启动后输出的相关信息 2015-10-28T10:03:33.100+0800 I JOURNAL  [initandlisten] journal dir=/data/mongodata/journal 2015-10-28T10:03:33.101+0800 I JOURNAL  [initandlisten] recover : no journal files present, no recovery needed 2015-10-28T10:03:33.264+0800 I JOURNAL  [initandlisten] preallocateIsFaster=true 2.18 2015-10-28T10:03:33.398+0800 I JOURNAL  [durability] Durability thread started 2015-10-28T10:03:33.398+0800 I JOURNAL  [journal writer] Journal writer thread started 2015-10-28T10:03:33.401+0800 I CONTROL  [initandlisten] MongoDB starting : pid=10191 port=27017 dbpath=/data/mongodata 64-bit host=java_2 2015-10-28T10:03:33.401+0800 I CONTROL  [initandlisten] <strong> WARNING: You are running this process as the root user, which is not recommended. 2015-10-28T10:03:33.401+0800 I CONTROL  [initandlisten] 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] </strong> WARNING: /sys/kernel/mm/transparent_hugepage/enabled is ‘always’. 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] <strong>        We suggest setting it to ‘never’ 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] </strong> WARNING: /sys/kernel/mm/transparent_hugepage/defrag is ‘always’. 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] <strong>        We suggest setting it to ‘never’ 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] db version v3.0.6 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] git version: 1ef45a23a4c5e3480ac919b28afcba3c615488f2 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] build info: Linux ip-10-67-194-123 2.6.32-220.el6.x86_64 #1 SMP Wed Nov 9 08:03:13 EST 2011 x86_64 BOOST_LIB_VERSION=1_49 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] allocator: tcmalloc 2015-10-28T10:03:33.402+0800 I CONTROL  [initandlisten] options: { storage: { dbPath: “/data/mongodata” } } 2015-10-28T10:03:33.404+0800 I INDEX    [initandlisten] allocating new ns file /data/mongodata/local.ns, filling with zeroes… 2015-10-28T10:03:33.491+0800 I STORAGE  [FileAllocator] allocating new datafile /data/mongodata/local.0, filling with zeroes… 2015-10-28T10:03:33.491+0800 I STORAGE  [FileAllocator] creating directory /data/mongodata/_tmp 2015-10-28T10:03:33.497+0800 I STORAGE  [FileAllocator] done allocating datafile /data/mongodata/local.0, size: 64MB,  took 0.001 secs 2015-10-28T10:03:33.511+0800 I NETWORK  [initandlisten] waiting for connections on port 27017 ###停止mongo，直接使用ctrl + c ^C2015-10-28T10:09:21.510+0800 I CONTROL  [signalProcessingThread] got signal 2 (Interrupt), will terminate after current cmd ends 2015-10-28T10:09:21.511+0800 I CONTROL  [signalProcessingThread] now exiting 2015-10-28T10:09:21.511+0800 I NETWORK  [signalProcessingThread] shutdown: going to close listening sockets… 2015-10-28T10:09:21.511+0800 I NETWORK  [signalProcessingThread] closing listening socket: 5 2015-10-28T10:09:21.511+0800 I NETWORK  [signalProcessingThread] closing listening socket: 6 2015-10-28T10:09:21.511+0800 I NETWORK  [signalProcessingThread] removing socket file: /tmp/mongodb-27017.sock 2015-10-28T10:09:21.511+0800 I NETWORK  [signalProcessingThread] shutdown: going to flush diaglog… 2015-10-28T10:09:21.511+0800 I NETWORK  [signalProcessingThread] shutdown: going to close sockets… 2015-10-28T10:09:21.512+0800 I STORAGE  [signalProcessingThread] shutdown: waiting for fs preallocator… 2015-10-28T10:09:21.512+0800 I STORAGE  [signalProcessingThread] shutdown: final commit… 2015-10-28T10:09:21.512+0800 I JOURNAL  [signalProcessingThread] journalCleanup… 2015-10-28T10:09:21.512+0800 I JOURNAL  [signalProcessingThread] removeJournalFiles 2015-10-28T10:09:21.515+0800 I JOURNAL  [signalProcessingThread] Terminating durability thread … 2015-10-28T10:09:21.615+0800 I JOURNAL  [journal writer] Journal writer thread stopped 2015-10-28T10:09:21.615+0800 I JOURNAL  [durability] Durability thread stopped 2015-10-28T10:09:21.615+0800 I STORAGE  [signalProcessingThread] shutdown: closing all files… 2015-10-28T10:09:21.618+0800 I STORAGE  [signalProcessingThread] closeAllFiles() finished 2015-10-28T10:09:21.618+0800 I STORAGE  [signalProcessingThread] shutdown: removing fs lock… 2015-10-28T10:09:21.618+0800 I CONTROL  [signalProcessingThread] dbexit:  rc: 0 ###修复启动过程中的两个警告，关于使用root用户启动mongo的警告先忽略 # echo “never” &gt; /sys/kernel/mm/transparent_hugepage/enabled # echo “never” &gt; /sys/kernel/mm/transparent_hugepage/defrag ###再次重启，后置于后台进程， # mongod –dbpath /data/mongodata &amp; ###查看启动后的进程 # ps -ef|grep mongo |grep -v grep root     11115 27956  0 10:11 pts/2    00:00:00 mongod –dbpath /data/mongodata # lsof -i:27017 COMMAND   PID USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME mongod  11115 root    5u  IPv4 50567119      0t0  TCP *:27017 (LISTEN) ###使用mongo连接到mongod # mongo MongoDB shell version: 3.0.6 connecting to: test 2015-10-28T10:14:30.685+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:53907 #1 (1 connection now open) Server has startup warnings: 2015-10-28T10:11:49.217+0800 I CONTROL  [initandlisten] </strong> WARNING: You are running this process as the root user, which is not recommended. 2015-10-28T10:11:49.217+0800 I CONTROL  [initandlisten] &gt; help db.help()                    help on db methods db.mycoll.help()             help on collection methods sh.help()                    sharding helpers rs.help()                    replica set helpers help admin                   administrative help help connect                 connecting to a db help help keys                    key shortcuts help misc                    misc things to know help mr                      mapreduce show dbs                     show database names show collections             show collections in current database show users                   show users in current database show profile                 show most recent system.profile entries with time &gt;= 1ms show logs                    show the accessible logger names show log [name]              prints out the last segment of log in memory, ‘global’ is default use &lt;db_name&gt;                set current database db.foo.find()                list objects in collection foo db.foo.find( { a : 1 } )     list objects in foo where a == 1 it                           result of the last line evaluated; use to further iterate DBQuery.shellBatchSize = x   set default number of items to display on shell exit                         quit the mongo shell &gt; db.getCollection(“version”); test.version &gt; exit bye 三、mongodb相关工具 ###在安装文件下有README，描述了常用的mongodb相关命令行工具 # more /usr/local/mongodb/README MongoDB README Welcome to MongoDB! COMPONENTS bin/mongod - The database process. bin/mongos - Sharding controller. bin/mongo  - The database shell (uses interactive javascript). UTILITIES bin/mongodump         - MongoDB dump tool - for backups, snapshots, etc.. bin/mongorestore      - MongoDB restore a dump bin/mongoexport       - Export a single collection to test (JSON, CSV) bin/mongoimport       - Import from JSON or CSV bin/mongofiles        - Utility for putting and getting files from MongoDB GridFS bin/mongostat         - Show performance statistics RUNNING For command line options invoke: $ ./mongod –help To run a single server database: $ mkdir /data/db $ ./mongod $ $ # The mongo javascript shell connects to localhost and test database by default: $ ./mongo &gt; help DRIVERS Client drivers for most programming languages are available at mongodb.org.  Use the shell (“mongo”) for administrative tasks. ###获取单个命令用法 # <command> –help # mongod –help|more Options: General options: -h [ –help ]               show this usage information –version                   show version information # mongod –version db version v3.0.6 git version: 1ef45a23a4c5e3480ac919b28afcba3c615488f2</mongodb-install-directory></p>

            
            <p class="more">
                <a href="/2015/10/28/2019030500052/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/10/28/2019030500052/" title="Linux下快速安装MongoDB">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/8.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/NOSQL/">NOSQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/10/28/2019030500154/">
    		Spring集成MongoDB
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-10-28T04:50:04.000Z">2015-10-28</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MongoDB/" title="MongoDB">MongoDB</a> / 
    
        <a href="/tags/Spring/" title="Spring">Spring</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h2 id="开篇"><a href="#开篇" class="headerlink" title="开篇"></a>开篇</h2><pre><code>Spring提供了对非关系数据库的集成，Spring的spring-data包提供了对mongoDB和redis集成的工具包。此篇博客介绍一下Spring和MongoDB的集成。
</code></pre><h2 id="导入工具包"><a href="#导入工具包" class="headerlink" title="导入工具包"></a>导入工具包</h2><pre><code>需要的工具包有spring的jar包、spring-common的jar包以及spring-data的mongoDB的jar包。
其中，
spring的jar包有aop、asm、aspects、beans、context、core、expression、jdbc、transaction等。
spring-common的jar包有commons-beanutils、commons-codec、commons-collections、commons-io、commons-lang、commons-logging、commons-pool等。
spring-data的mongoDB的jar包有spring-data-commons-aspects、spring-data-commons-core、spring-data-document-core、spring-data-mongodb、spring-data-mongodb-cross-store、spring-data-mongodb-log4j等。
另外还有一个是mongo.jar
</code></pre><h2 id="工具包截图"><a href="#工具包截图" class="headerlink" title="工具包截图"></a>工具包截图</h2><p><img src="http://img.blog.csdn.net/20151028115904114" alt="这里写图片描述"></p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;  
          xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;  
          xmlns:context=&quot;http://www.springframework.org/schema/context&quot;  
          xmlns:mongo=&quot;http://www.springframework.org/schema/data/mongo&quot;  
          xsi:schemaLocation=&quot;http://www.springframework.org/schema/context   
          http://www.springframework.org/schema/context/spring-context-3.0.xsd   
          http://www.springframework.org/schema/data/mongo   
          http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd   
          http://www.springframework.org/schema/beans   
          http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;&gt;   

        &lt;mongo:mongo host=&quot;192.168.0.138&quot; port=&quot;27017&quot;/&gt;



       &lt;bean id=&quot;mongoTemplate&quot; class=&quot;org.springframework.data.document.mongodb.MongoTemplate&quot;&gt;   
        &lt;constructor-arg ref=&quot;mongo&quot;/&gt;   
        &lt;constructor-arg name=&quot;databaseName&quot; value=&quot;db&quot;/&gt;   
        &lt;constructor-arg name=&quot;defaultCollectionName&quot; value=&quot;person&quot; /&gt;   
      &lt;/bean&gt;   

     &lt;bean id=&quot;personRepository&quot; class=&quot;com.mongo.dao.impl.PersonRepository&quot;&gt;   
        &lt;property name=&quot;mongoTemplate&quot; ref=&quot;mongoTemplate&quot;&gt;&lt;/property&gt;   
    &lt;/bean&gt;   

     &lt;context:annotation-config /&gt;

&lt;/beans&gt; 
</code></pre><h2 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h2><p>实体类：</p>
<pre><code>public class Person implements Serializable {

    /**
     * 
     */
    private static final long serialVersionUID = 3617931430808763429L;

    private String id;   
    private String name;   
    private int age;
    public Person() {
        super();
    }
    public Person(String id, String name, int age) {
        super();
        this.id = id;
        this.name = name;
        this.age = age;
    }
    /**
     * @return the id
     */
    public String getId() {
        return id;
    }
    /**
     * @param id the id to set
     */
    public void setId(String id) {
        this.id = id;
    }
    /**
     * @return the name
     */
    public String getName() {
        return name;
    }
    /**
     * @param name the name to set
     */
    public void setName(String name) {
        this.name = name;
    }
    /**
     * @return the age
     */
    public int getAge() {
        return age;
    }
    /**
     * @param age the age to set
     */
    public void setAge(int age) {
        this.age = age;
    }
    /**
     * 
     * @param name
     * @param age
     */
    public Person(String name, int age) {
        super();
        this.name = name;
        this.age = age;
    }   

     public String toString() {   
            return &quot;Person[id=&quot;+id+&quot;,name=&quot;+name+&quot;,age=&quot;+age+&quot;]&quot;;   
        }   


}
</code></pre><p>DAO层接口</p>
<pre><code>public interface AbstractRepository {


    public void insert(Person person); 


    public Person findOne(String id);   

    public List&lt;Person&gt; findAll();   

    public List&lt;Person&gt; findByRegex(String regex);

    public void removeOne(String id);   

    public void removeAll();   

    public void findAndModify(String id);   


}
</code></pre><p>DAO层接口实现</p>
<pre><code>public class PersonRepository implements AbstractRepository {

      private MongoTemplate mongoTemplate;   


    @Override
    public List&lt;Person&gt; findAll() {
        return getMongoTemplate().find(new Query(), Person.class);   

    }


    @Override
    public void findAndModify(String id) {

        getMongoTemplate().updateFirst(new Query(Criteria.where(&quot;id&quot;).is(id)), new Update().inc(&quot;age&quot;, 3));

    }


    @Override
    public List&lt;Person&gt; findByRegex(String regex) {
         Pattern pattern = Pattern.compile(regex,Pattern.CASE_INSENSITIVE);   
          Criteria criteria = new Criteria(&quot;name&quot;).regex(pattern.toString());   
            return getMongoTemplate().find(new Query(criteria), Person.class);   

    }


    @Override
    public Person findOne(String id) {
         return getMongoTemplate().findOne(new Query(Criteria.where(&quot;id&quot;).is(id)), Person.class);   

    }


    @Override
    public void insert(Person person) {
        getMongoTemplate().insert(person);   
    }


    @Override
    public void removeAll() {
        List&lt;Person&gt; list = this.findAll();   
        if(list != null){   
            for(Person person : list){   
                getMongoTemplate().remove(person);   
            }   
        }   

    }


    @Override
    public void removeOne(String id) {
        Criteria criteria = Criteria.where(&quot;id&quot;).in(id);   
        if(criteria == null){   
             Query query = new Query(criteria);   
             if(query != null &amp;&amp; getMongoTemplate().findOne(query, Person.class) != null)   
                 getMongoTemplate().remove(getMongoTemplate().findOne(query, Person.class));   
        }   

    }

    /**
     * @return the mongoTemplate
     */
    public MongoTemplate getMongoTemplate() {
        return mongoTemplate;
    }

    /**
     * @param mongoTemplate the mongoTemplate to set
     */
    public void setMongoTemplate(MongoTemplate mongoTemplate) {
        this.mongoTemplate = mongoTemplate;
    }

}
测试程序
public class MongoTest {

    private static Log log = LogFactory.getLog(MongoTest.class.getName());

    private  AbstractRepository pr=null;


    public void init(){

         ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
          pr= (PersonRepository)ctx.getBean(&quot;personRepository&quot;);



    }

    public void insert(){

        Person p=new Person(&quot;cuiran&quot;,27);
         pr.insert(p);
    }

    public void findOne(){
        String id=&quot;50c83cb552c2ceb0463177d6&quot;;
        Person p= pr.findOne(id);
        log.debug(p);
    }



    public void listAll(){

        List&lt;Person&gt; list=pr.findAll();

        for (Person p:list){
            log.debug(p.toString());
        }


    }


    public void start(){
        init();

        //insert();
        //listAll();

        findOne();
    }

    public static void main(String[] args) {
        MongoTest t=new MongoTest();
        t.start();
    }

}
</code></pre><h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><pre><code>通过Spring集成MongoDB的底层代码封装，项目中用到非关系型数据MongoDB存储就变得容易很多。
</code></pre>
            
            <p class="more">
                <a href="/2015/10/28/2019030500154/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/10/28/2019030500154/" title="Spring集成MongoDB">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/8.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    

    
    <nav class="page-navigator">
        <a class="extend prev" rel="prev" href="/archives/page/7/">前一页</a><a class="page-number" href="/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/6/">6</a><a class="page-number" href="/archives/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/archives/page/9/">9</a><a class="page-number" href="/archives/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/18/">18</a><a class="extend next" rel="next" href="/archives/page/9/">后一页</a>
    </nav>
    


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="/categories/MySQL/">MySQL</a>
        <span class="badge">(92)</span>
    </li>
    
    <li>
        <a href="/categories/开发语言/">开发语言</a>
        <span class="badge">(7)</span>
    </li>
    
    <li>
        <a href="/categories/Oracle/">Oracle</a>
        <span class="badge">(40)</span>
    </li>
    
    <li>
        <a href="/categories/NOSQL/">NOSQL</a>
        <span class="badge">(17)</span>
    </li>
    
    <li>
        <a href="/categories/SQL-Server/">SQL Server</a>
        <span class="badge">(13)</span>
    </li>
    
    <li>
        <a href="/categories/其他数据库/">其他数据库</a>
        <span class="badge">(4)</span>
    </li>
    
    <li>
        <a href="/categories/MySQL/Oracle/">Oracle</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="/categories/MySQL/Oracle/SQL-Server/">SQL Server</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="/categories/NOSQL/开发语言/">开发语言</a>
        <span class="badge">(1)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="/tags/MySQL/" title="MySQL">MySQL (71)</a>
  
    <a class="tag-item" href="/tags/位运算/" title="位运算">位运算 (0)</a>
  
    <a class="tag-item" href="/tags/allow/" title="allow">allow (1)</a>
  
    <a class="tag-item" href="/tags/Apache/" title="Apache">Apache (1)</a>
  
    <a class="tag-item" href="/tags/deny/" title="deny">deny (1)</a>
  
    <a class="tag-item" href="/tags/sqlplus/" title="sqlplus">sqlplus (1)</a>
  
    <a class="tag-item" href="/tags/CentOS/" title="CentOS">CentOS (2)</a>
  
    <a class="tag-item" href="/tags/druid/" title="druid">druid (1)</a>
  
    <a class="tag-item" href="/tags/心跳/" title="心跳">心跳 (1)</a>
  
    <a class="tag-item" href="/tags/redis/" title="redis">redis (6)</a>
  
    <a class="tag-item" href="/tags/分库/" title="分库">分库 (1)</a>
  
    <a class="tag-item" href="/tags/分库分表/" title="分库分表">分库分表 (1)</a>
  
    <a class="tag-item" href="/tags/分表/" title="分表">分表 (1)</a>
  
    <a class="tag-item" href="/tags/Oracle/" title="Oracle">Oracle (30)</a>
  
    <a class="tag-item" href="/tags/schedule-job/" title="schedule job">schedule job (1)</a>
  
    <a class="tag-item" href="/tags/事务/" title="事务">事务 (5)</a>
  
    <a class="tag-item" href="/tags/分布式/" title="分布式">分布式 (1)</a>
  
    <a class="tag-item" href="/tags/消息/" title="消息">消息 (1)</a>
  
    <a class="tag-item" href="/tags/KeepAlived/" title="KeepAlived">KeepAlived (1)</a>
  
    <a class="tag-item" href="/tags/数据库/" title="数据库">数据库 (7)</a>
  
    <a class="tag-item" href="/tags/结构同步/" title="结构同步">结构同步 (1)</a>
  
    <a class="tag-item" href="/tags/truncate/" title="truncate">truncate (1)</a>
  
    <a class="tag-item" href="/tags/FineReport/" title="FineReport">FineReport (1)</a>
  
    <a class="tag-item" href="/tags/SQL/" title="SQL">SQL (17)</a>
  
    <a class="tag-item" href="/tags/报表/" title="报表">报表 (1)</a>
  
    <a class="tag-item" href="/tags/数据集/" title="数据集">数据集 (1)</a>
  
    <a class="tag-item" href="/tags/Excel/" title="Excel">Excel (1)</a>
  
    <a class="tag-item" href="/tags/Sqlite/" title="Sqlite">Sqlite (1)</a>
  
    <a class="tag-item" href="/tags/批量/" title="批量">批量 (1)</a>
  
    <a class="tag-item" href="/tags/Linux/" title="Linux">Linux (2)</a>
  
    <a class="tag-item" href="/tags/Character-set/" title="Character set">Character set (1)</a>
  
    <a class="tag-item" href="/tags/NLS-LANG/" title="NLS_LANG">NLS_LANG (1)</a>
  
    <a class="tag-item" href="/tags/rowid/" title="rowid">rowid (2)</a>
  
    <a class="tag-item" href="/tags/重复/" title="重复">重复 (1)</a>
  
    <a class="tag-item" href="/tags/Hash索引/" title="Hash索引">Hash索引 (1)</a>
  
    <a class="tag-item" href="/tags/InnoDB/" title="InnoDB">InnoDB (3)</a>
  
    <a class="tag-item" href="/tags/MyISAM/" title="MyISAM">MyISAM (3)</a>
  
    <a class="tag-item" href="/tags/索引优化/" title="索引优化">索引优化 (1)</a>
  
    <a class="tag-item" href="/tags/mysqldump/" title="mysqldump">mysqldump (2)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="http://www.devba.com" target="_blank" title="软件开发吧">软件开发吧</a>
        </li>
    
        <li>
            <a href="https://www.sqlyun.cn" target="_blank" title="SQL云笔记">SQL云</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2019
    

    <a href="/">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->
<script src="/js/main.js"></script>
</body>
</html>