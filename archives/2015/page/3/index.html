<!doctype html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8">
    <meta name="baidu-site-verification" content="dIcXMeY8Ya">
    
    <title>文章归档: 2015 | 软件开发吧</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="keywords" content="SQL云,SQL云开发,SQL笔记,SQL开发,云开发,MySQL,Oralce,数据库,数据库云,数据库开发,数据库云开发,SQL教程,数据库教程,开发笔记,MySQL笔记,MySQL教程">
    <meta name="description" content="为满足广大程序猿兄弟对日常工作中学习数据库、使用使用数据库资料查询需求，SQL云开发免费将自己整理的各种数据库技术资料分享出来，并希望与广大猿兄一起讨论学习与进步,致力于一起更方便、快捷资料学习查询,实现更安全、高效的数据存储.">

    
    <link rel="alternative" href="/atom.xml" title="软件开发吧" type="application/atom+xml">
    
    
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->
    
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?fd459238242776d173cdc64918fb32f2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</head>
</html>
<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">软件开发吧</span>
                    <span class="description"></span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/archives/2015/page/3/index.html" class="item ">
                <a href="/" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="/archives/2015/page/3/index.html" class="item ">
                <a href="/lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="/archives/2015/page/3/index.html" class="item ">
                <a href="/about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="/archives/2015/page/3/index.html" class="item ">
                <a href="/comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/sxyyhj" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="/img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon">
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章归档 -->

    <h3 class="widget-hd">
        <strong>
            
                文章归档
                <!-- 文章归档，可以根据日期分类 -->
            
        </strong>
    </h3>
    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/12/03/2019030500090/">
    		MySQL性能优化 - 修改配置文件my.cnf
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-12-03T06:45:30.000Z">2015-12-03</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/my-cnf/" title="my.cnf">my.cnf</a> / 
    
        <a href="/tags/优化/" title="优化">优化</a> / 
    
        <a href="/tags/性能/" title="性能">性能</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>在Apache, PHP, MySQL的体系架构中，MySQL对于性能的影响最大，也是关键的核心部分。对于Discuz!论坛程序也是如此，MySQL的设置是否合理优化，直接影响到论坛的速度和承载量！同时，MySQL也是优化难度最大的一个部分，不但需要理解一些MySQL专业知识，同时还需要长时间的观察统计并且根据经验进行判断，然后设置合理的参数。 下面我们了解一下MySQL优化的一些基础，MySQL的优化我分为两个部分，一是服务器物理硬件的优化，二是MySQL自身(my.cnf)的优化。 一、服务器硬件对MySQL性能的影响 ①磁盘寻道能力（磁盘I/O）,以目前高转速SCSI硬盘(7200转/秒)为例，这种硬盘理论上每秒寻道7200次，这是物理特性决定的，没有办法改变。MySQL每秒钟都在进行大量、复杂的查询操作，对磁盘的读写量可想而知。所以，通常认为磁盘I/O是制约MySQL性能的最大因素之一，对于日均访问量在100万PV以上的Discuz!论坛，由于磁盘I/O的制约，MySQL的性能会非常低下！解决这一制约因素可以考虑以下几种解决方案： 使用RAID-0+1磁盘阵列，注意不要尝试使用RAID-5，MySQL在RAID-5磁盘阵列上的效率不会像你期待的那样快。 ②CPU 对于MySQL应用，推荐使用S.M.P.架构的多路对称CPU，例如：可以使用两颗Intel Xeon 3.6GHz的CPU，现在我较推荐用4U的服务器来专门做数据库服务器，不仅仅是针对于mysql。 ③物理内存对于一台使用MySQL的Database Server来说，服务器内存建议不要小于2GB，推荐使用4GB以上的物理内存，不过内存对于现在的服务器而言可以说是一个可以忽略的问题，工作中遇到了高端服务器基本上内存都超过了16G。 二、MySQL自身因素当解决了上述服务器硬件制约因素后，让我们看看MySQL自身的优化是如何操作的。 对MySQL自身的优化主要是对其配置文件my.cnf中的各项参数进行优化调整。下面我们介绍一些对性能影响较大的参数。 由于my.cnf文件的优化设置是与服务器硬件配置息息相关的， 因而我们指定一个假想的服务器硬件环境：CPU: 2颗Intel Xeon 2.4GHz 内存: 4GB DDR 硬盘: SCSI 73GB(很常见的2U服务器 ) 。 下面，我们根据以上硬件配置结合一份已经优化好的my.cnf进行说明： [mysqld] port = 3306 serverid = 1 socket = /tmp/mysql.sock skip-locking #避免MySQL的外部锁定，减少出错几率增强稳定性。 skip-name-resolve #禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。但需要注意，如果开启该选项，则所有远程主机连接授权都要使用IP地址方式，否则MySQL将无法正常处理连接请求！ back_log = 384 #back_log参数的值指出在MySQL暂时停止响应新请求之前的短时间内多少个请求可以被存在堆栈中。 如果系统在一个短时间内有很多连接，则需要增大该参数的值，该参数值指定到来的TCP/IP连接的侦听队列的大小。不同的操作系统在这个队列大小上有它自己的限制。 试图设定back_log高于你的操作系统的限制将是无效的。默认值为50。对于Linux系统推荐设置为小于512的整数。 key_buffer_size = 256M #key_buffer_size指定用于索引的缓冲区大小，增加它可得到更好的索引处理性能。对于内存在4GB左右的服务器该参数可设置为256M或384M。注意：该参数值设置的过大反而会是服务器整体效率降低！ max_allowed_packet = 4M thread_stack = 256K table_cache = 128K sort_buffer_size = 6M #查询排序时所能使用的缓冲区大小。注意：该参数对应的分配内存是每连接独占，如果有100个连接，那么实际分配的总共排序缓冲区大小为100 × 6 ＝ 600MB。所以，对于内存在4GB左右的服务器推荐设置为6-8M。 read_buffer_size = 4M #读查询操作所能使用的缓冲区大小。和sort_buffer_size一样，该参数对应的分配内存也是每连接独享。 join_buffer_size = 8M #联合查询操作所能使用的缓冲区大小，和sort_buffer_size一样，该参数对应的分配内存也是每连接独享。 myisam_sort_buffer_size = 64M table_cache = 512 thread_cache_size = 64 query_cache_size = 64M #指定MySQL查询缓冲区的大小。可以通过在MySQL控制台观察，如果Qcache_lowmem_prunes的值非常大，则表明经常出现缓冲不够的情况；如果Qcache_hits的值非常大，则表明查询缓冲使用非常频繁，如果该值较小反而会影响效率，那么可以考虑不用查询缓冲；Qcache_free_blocks，如果该值非常大，则表明缓冲区中碎片很多。 tmp_table_size = 256M max_connections = 768 #指定MySQL允许的最大连接进程数。如果在访问论坛时经常出现Too Many Connections的错误提 示，则需要增大该参数值。 max_connect_errors = 10000000 wait_timeout = 10 #指定一个请求的最大连接时间，对于4GB左右内存的服务器可以设置为5-10。 thread_concurrency = 8 #该参数取值为服务器逻辑CPU数量*2，在本例中，服务器有2颗物理CPU，而每颗物理CPU又支持H.T超线程，所以实际取值为4*2=8 skip-networking #开启该选项可以彻底关闭MySQL的TCP/IP连接方式，如果WEB服务器是以远程连接的方式访问MySQL数据库服务器则不要开启该选项！否则将无法正常连接！ table_cache=1024 #物理内存越大,设置就越大.默认为2402,调到512-1024最佳 innodb_additional_mem_pool_size=4M #默认为2M innodb_flush_log_at_trx_commit=1 #设置为0就是等到innodb_log_buffer_size列队满后再统一储存,默认为1 innodb_log_buffer_size=2M #默认为1M innodb_thread_concurrency=8 #你的服务器CPU有几个就设置为几,建议用默认一般为8 key_buffer_size=256M #默认为218，调到128最佳 tmp_table_size=64M #默认为16M，调到64-256最挂 read_buffer_size=4M #默认为64K read_rnd_buffer_size=16M #默认为256K sort_buffer_size=32M #默认为256K thread_cache_size=120 #默认为60 query_cache_size=32M ※值得注意的是： 很多情况需要具体情况具体分析 一、如果Key_reads太大，则应该把my.cnf中Key_buffer_size变大，保持Key_reads/Key_read_requests至少1/100以上，越小越好。 二、如果Qcache_lowmem_prunes很大，就要增加Query_cache_size的值。</p>

            
            <p class="more">
                <a href="/2015/12/03/2019030500090/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/12/03/2019030500090/" title="MySQL性能优化 - 修改配置文件my.cnf">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/3.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/12/03/2019030500078/">
    		mysql-存储引擎
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-12-03T06:44:18.000Z">2015-12-03</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/InnoDB/" title="InnoDB">InnoDB</a> / 
    
        <a href="/tags/MyISAM/" title="MyISAM">MyISAM</a> / 
    
        <a href="/tags/BDB/" title="BDB">BDB</a> / 
    
        <a href="/tags/EXAMPLE/" title="EXAMPLE">EXAMPLE</a> / 
    
        <a href="/tags/Federated/" title="Federated">Federated</a> / 
    
        <a href="/tags/Memory/" title="Memory">Memory</a> / 
    
        <a href="/tags/Merge/" title="Merge">Merge</a> / 
    
        <a href="/tags/存储引擎/" title="存储引擎">存储引擎</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="mysql-存储引擎"><a href="#mysql-存储引擎" class="headerlink" title="mysql-存储引擎"></a>mysql-存储引擎</h1><p>mysql 存储引擎一般有 MyISAM、InnoDB、Memory、Merge、BDB、EXAMPLE、Federated 存储引擎。 一、MyISAM存储引擎 不支持事务的存储引擎，它是基于更老的ISAM存储引擎，每个MyISAM 存储引擎类型的表在磁盘上存储3个文件：tablename.frm存储定义文件、tablename.MYD :存储表的数据文件 tableName.MYI存储表的索引文件。我们指明设置一个表的存储引擎为MyISAM 存储引擎可以：Create table t(i int primarykey) engine=MyISAM ，注意老版本（5.1之前）的是使用type关键字 ，而从5.1之后是使用engine关键字。MyISAM存储引擎是mysql默认的存储引擎，但是在5.5以及5.5版本之后mysql的默认存储引擎是InnoDB 存储引擎。 MyISAM存储引擎的特性： 1、每个MyISAM存储引擎的表最大支持64个索引文件 2、blob和text列可以被设置为索引 3、提供高速的存储和压缩表以及全文检索功能 4、MyISAM是对整个表进行加锁的，不是对行锁的，读取时候会对其读取的所有表进行加共享锁，写入的时候会对表加入排他锁，但是在表的读取查询的同时，也可以往表里插入新的记录。 5、MyISAM表使用了B型树的索引 索引文件大小为： （key_length +4） * 0.67 加上所有键的和。 6、MyISAM支持三种不同的存储格式：固定格式、动态格式和压缩格式，固定格式和动态格式根据正在使用的列进行自动选择，对于已经压缩的格式则必须使用myisampack工具来创建。 7、MyISAM存储引擎使用前缀压缩使得索引更小。 二、InnoDB存储引擎 InnoDB给mysql数据库提供了具有提交、回滚和崩溃恢复的事务安全存储引擎，InnoDB锁定在行级别并也在查询的select语句中非锁定读–这些特性增加了mysql数据库的吞吐量，我们都知道mysql在解决高并发的环境下使用了共享锁和排他锁（其实这就像我们在java语言中的JDK1.5中添加的并发包中的ReentrantReadWriteLock 类，多个线程可以持有读锁-共享锁，有且仅当有一个线程具有写锁-排他锁，并且写锁的优先级最高，当写锁到达的时候必须插入到所有读锁之前，其他获得的读锁的线程必须等待写锁完成）那如何看待Innodb的性能呢？ 1、innodb是行级别的锁定适合非常小的空间而不是像MyISAM存储引擎基本上是整张表进行锁定，innodb支持外键特性 innodb是为处理巨大数据量的最大性能而设计的，它为主内存中缓冲数据和索引而维护自己的缓冲池，innodb存储它的表和索引在一个表的空间中，表空间可以包含数个文件 innodb表可以使任何尺寸的，即使文件大小受操作系统的限制也是可以的。 被InnoDB存储引擎所管理的资源包含有innodb的表空间和它的日志文件。   转摘于：<a href="http://qq466862016.iteye.com/blog/2261069" target="_blank" rel="noopener">http://qq466862016.iteye.com/blog/2261069</a></p>

            
            <p class="more">
                <a href="/2015/12/03/2019030500078/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/12/03/2019030500078/" title="mysql-存储引擎">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/3.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/12/01/2019030500065/">
    		mysql中的字符串的拼接
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-12-01T07:01:03.000Z">2015-12-01</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/字符串/" title="字符串">字符串</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>字符串的拼接 1，Mysql 在Java、C#等编程语言中字符串的拼接可以通过加号“+”来实现，比如：”1”+”3”、”a”+”b”。 在MYSQL中也可以使用加号“+”来连接两个字符串，比如下面的SQL： Sql代码 复制代码 收藏代码 1.SELECT ‘12’+’33’,FAge+’1’ FROM T_Employee 执行结果 Sql代码 复制代码 收藏代码 1.’12’+’33’  FAge+’1’ 2.45    26 3.45  29 4.45  24 5.45  26 6.45  29 7.45  28 8.45  24 9.45  29 10.45  23 MYSQL会尝试将加号两端的字段值尝试转换为数字类型，如果转换失败则认为字段值为 0，比如我们执行下面的SQL语句： Sql代码 复制代码 收藏代码 1.SELECT ‘abc’+’123’,FAge+’a’ FROM T_Employee 执行完毕我们就能在输出结果中看到下面的执行结果： Html代码 复制代码 收藏代码 1. 2.’abc’+’123’  FAge+’a’ 3.123  25 4.123  28 5.123  23 6.123  25 7.123  28 8.123  27 9.123  23 10.123  28 11.123  22 在MYSQL中进行字符串的拼接要使用CONCAT函数，CONCAT函数支持一个或者多个参数， 参数类型可以为字符串类型也可以是非字符串类型，对于非字符串类型的参数MYSQL将尝试 将其转化为字符串类型，CONCAT函数会将所有参数按照参数的顺序拼接成一个字符串做为 返回值。比如下面的SQL语句用于将用户的多个字段信息以一个计算字段的形式查询出来： Sql代码 复制代码 收藏代码 1.SELECT CONCAT(‘工号为:’,FNumber,’的员工的幸福指数:’,FSalary/(FAge-21)) FROM T_Employee  执行完毕我们就能在输出结果中看到下面的执行结果： Java代码 复制代码 收藏代码 1.CONCAT(‘工号为:’,FNumber,’的员工的幸福指数:’,FSalary/(FAge-21)) 2.工号为:DEV001的员工的幸福指数:2075.000000 3.工号为:DEV002的员工的幸福指数:328.685714 4.工号为:HR001的员工的幸福指数:1100.440000 MYSQL中还提供了另外一个进行字符串拼接的函数CONCAT_WS， CONCAT_WS可以在待拼接的字符串之间加入指定的分隔符，它的第一个参数值为采用的分 隔符，而剩下的参数则为待拼接的字符串值，比如执行下面的SQL： Sql代码 复制代码 收藏代码 1.SELECT CONCAT_WS(‘,’,FNumber,FAge,FDepartment,FSalary) FROM T_Employee 执行完毕我们就能在输出结果中看到下面的执行结果： Java代码 复制代码 收藏代码 1.CONCAT_WS(‘,’,FNumber,FAge,FDepartment,FSalary) 2.DEV001,25,Development,8300.00 3.DEV002,28,Development,2300.80 4.HR001,23,HumanResource,2200.88 5.HR002,25,HumanResource,5200.36 6.IT001,28,InfoTech,3900.00 7.IT002,27,InfoTech,2800.00 8.SALES001,23,Sales,5000.00 9.SALES002,28,Sales,6200.00 10.SALES003,22,Sales,1200.00 2，oracle Oracle中使用“||”进行字符串拼接，其使用方式和MSSQLServer中的加号“+”一样。 比如执行下面的SQL语句： Sql代码 复制代码 收藏代码 1.SELECT ‘工号为’||FNumber||’的员工姓名为’||FName FROM T_Employee 2.WHERE FName IS NOT NULL 执行完毕我们就能在输出结果中看到下面的执行结果： Html代码 复制代码 收藏代码 1.工号为||FNUMBER||的员工姓名为||FNAME 2.工号为DEV001的员工姓名为Tom 3.工号为DEV002的员工姓名为Jerry 4.工号为SALES001的员工姓名为John 5.工号为SALES002的员工姓名为Kerry 6.工号为SALES003的员工姓名为Stone 7.工号为HR001的员工姓名为Jane 8.工号为HR002的员工姓名为Tina 9.工号为IT001的员工姓名为Smith 除了“||”，Oracle还支持使用CONCAT()函数进行字符串拼接，比如执行下面的SQL语句： Sql代码 复制代码 收藏代码 1.SELECT CONCAT(‘工号:’,FNumber) FROM T_Employee 执行完毕我们就能在输出结果中看到下面的执行结果： Html代码 复制代码 收藏代码 1.CONCAT(工号:,FNUMBER) 2.工号:DEV001 3.工号:DEV002 4.工号:HR001 5.工号:HR002 6.工号:IT001 7.工号:IT002 8.工号:SALES001 9.工号:SALES002 10.工号:SALES003 如果CONCAT中连接的值不是字符串，Oracle会尝试将其转换为字符串， 与MYSQL的CONCAT()函数不同，Oracle的CONCAT()函数只支持两个参数，不支持两个以 上字符串的拼接。如果要进行多个字符串的拼接的话，可以使用多个CONCAT()函数嵌套使用。 Sql代码 复制代码 收藏代码 1.SELECT CONCAT(CONCAT(CONCAT(‘工号为’,FNumber),’的员工姓名为’),FName) FROM 2.T_Employee 3.WHERE FName IS NOT NULL 执行完毕我们就能在输出结果中看到下面的执行结果： Html代码 复制代码 收藏代码 1.CONCAT(CONCAT(CONCAT(工号为,FNUMBER),的员工姓名为),FNAME) 2.工号为DEV001的员工姓名为Tom 3.工号为DEV002的员工姓名为Jerry 4.工号为SALES001的员工姓名为John 5.工号为SALES002的员工姓名为Kerry 6.工号为SALES003的员工姓名为Stone 7.工号为HR001的员工姓名为Jane 8.工号为HR002的员工姓名为Tina 9.工号为IT001的员工姓名为Smith</p>

            
            <p class="more">
                <a href="/2015/12/01/2019030500065/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/12/01/2019030500065/" title="mysql中的字符串的拼接">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/1.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/30/2019030500103/">
    		mysql 用户管理和权限设置
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-30T05:37:20.000Z">2015-11-30</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a> / 
    
        <a href="/tags/权限/" title="权限">权限</a> / 
    
        <a href="/tags/用户/" title="用户">用户</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>用户管理</p>
<p>mysql&gt;use mysql;</p>
<p>查看</p>
<p>mysql&gt; select host,user,password from user ;</p>
<p>创建</p>
<p>mysql&gt; create user  zx_root   IDENTIFIED by ‘xxxxx’;   //identified by 会将纯文本密码加密作为散列值存储</p>
<p>修改</p>
<p>mysql&gt;rename   user  feng  to   newuser；//mysql 5之后可以使用，之前需要使用update 更新user表</p>
<p>删除</p>
<p>mysql&gt;drop user newuser;   //mysql5之前删除用户时必须先使用revoke 删除用户权限，然后删除用户，mysql5之后drop 命令可以删除用户的同时删除用户的相关权限</p>
<p>更改密码</p>
<p>mysql&gt; set password for zx_root =password(‘xxxxxx’);</p>
<p> mysql&gt; update  mysql.user  set  password=password(‘xxxx’)  where user=’otheruser’</p>
<p>查看用户权限</p>
<p>mysql&gt; show grants for zx_root;</p>
<p>赋予权限</p>
<p>mysql&gt; grant select on dmc_db.*  to zx_root;</p>
<p>回收权限</p>
<p>mysql&gt; revoke  select on dmc_db.*  from  zx_root;  //如果权限不存在会报错</p>
<p>上面的命令也可使用多个权限同时赋予和回收，权限之间使用逗号分隔</p>
<p>mysql&gt; grant select，update，delete  ，insert  on dmc_db.*  to  zx_root;</p>
<p>如果想立即看到结果使用</p>
<p>flush  privileges ;</p>
<p>命令更新</p>
<p>设置权限时必须给出一下信息</p>
<p>1，要授予的权限</p>
<p>2，被授予访问权限的数据库或表</p>
<p>3，用户名</p>
<p>grant和revoke可以在几个层次上控制访问权限</p>
<p>1，整个服务器，使用 grant ALL  和revoke  ALL</p>
<p>2，整个数据库，使用on  database.*</p>
<p>3，特点表，使用on  database.table</p>
<p>4，特定的列</p>
<p>5，特定的存储过程</p>
<p>user表中host列的值的意义</p>
<p>%              匹配所有主机</p>
<p>localhost    localhost不会被解析成IP地址，直接通过UNIXsocket连接</p>
<p>127.0.0.1      会通过TCP/IP协议连接，并且只能在本机访问；</p>
<p>::1                 ::1就是兼容支持ipv6的，表示同ipv4的127.0.0.1</p>
<p>grant 普通数据用户，查询、插入、更新、删除 数据库中所有表数据的权利。 grant select on testdb.<em> to common_user@’%’ grant insert on testdb.</em> to common_user@’%’ grant update on testdb.<em> to common_user@’%’ grant delete on testdb.</em> to common_user@’%’ 或者，用一条 MySQL 命令来替代： grant select, insert, update, delete on testdb.<em> to common_user@’%’ 9&gt;.grant 数据库开发人员，创建表、索引、视图、存储过程、函数。。。等权限。 grant 创建、修改、删除 MySQL 数据表结构权限。 grant create on testdb.</em> to developer@’192.168.0.%’; grant alter on testdb.<em> to developer@’192.168.0.%’; grant drop on testdb.</em> to developer@’192.168.0.%’; grant 操作 MySQL 外键权限。 grant references on testdb.<em> to developer@’192.168.0.%’; grant 操作 MySQL 临时表权限。 grant create temporary tables on testdb.</em> to developer@’192.168.0.%’; grant 操作 MySQL 索引权限。 grant index on testdb.<em> to developer@’192.168.0.%’; grant 操作 MySQL 视图、查看视图源代码 权限。 grant create view on testdb.</em> to developer@’192.168.0.%’; grant show view on testdb.<em> to developer@’192.168.0.%’; grant 操作 MySQL 存储过程、函数 权限。 grant create routine on testdb.</em> to developer@’192.168.0.%’; – now, can show procedure status grant alter routine on testdb.<em> to developer@’192.168.0.%’; – now, you can drop a procedure grant execute on testdb.</em> to developer@’192.168.0.%’; 10&gt;.grant 普通 DBA 管理某个 MySQL 数据库的权限。 grant all privileges on testdb to dba@’localhost’ 其中，关键字 “privileges” 可以省略。 11&gt;.grant 高级 DBA 管理 MySQL 中所有数据库的权限。 grant all on <em>.</em> to dba@’localhost’ 12&gt;.MySQL grant 权限，分别可以作用在多个层次上。 1. grant 作用在整个 MySQL 服务器上： grant select on <em>.</em> to dba@localhost; – dba 可以查询 MySQL 中所有数据库中的表。 grant all on <em>.</em> to dba@localhost; – dba 可以管理 MySQL 中的所有数据库 2. grant 作用在单个数据库上： grant select on testdb.* to dba@localhost; – dba 可以查询 testdb 中的表。 3. grant 作用在单个数据表上： grant select, insert, update, delete on testdb.orders to dba@localhost; 4. grant 作用在表中的列上： grant select(id, se, rank) on testdb.apache_log to dba@localhost; 5. grant 作用在存储过程、函数上： grant execute on procedure testdb.pr_add to ’dba’@’localhost’ grant execute on function testdb.fn_add to ’dba’@’localhost’ 注意：修改完权限以后 一定要刷新服务，或者重启服务，刷新服务用：FLUSH PRIVILEGES。</p>
<p>权限表</p>
<p>权限</p>
<p>说明</p>
<p>all</p>
<p>alter</p>
<p>alter routine</p>
<p>使用alter procedure 和drop procedure</p>
<p>create</p>
<p>create routine</p>
<p>使用create  procedure</p>
<p>create temporary tables</p>
<p>使用create temporary table</p>
<p>create  user</p>
<p>create view</p>
<p>delete</p>
<p>drop</p>
<p>execute</p>
<p>使用call和存储过程</p>
<p>file</p>
<p>使用select into outfile  和load data infile</p>
<p>grant option</p>
<p>可以使用grant和revoke</p>
<p>index</p>
<p>可以使用create index 和drop index</p>
<p>insert</p>
<p>lock tables</p>
<p>锁表</p>
<p>process</p>
<p>使用show full processlist</p>
<p>reload</p>
<p>   使用flush</p>
<p>replication client</p>
<p>服务器位置访问</p>
<p>replocation slave</p>
<p>由复制从属使用</p>
<p>select</p>
<p>show databases</p>
<p>show view</p>
<p>shutdown</p>
<p>使用mysqladmin shutdown 来关闭mysql</p>
<p>super</p>
<p>update</p>
<p>usage</p>
<p>无访问权限</p>

            
            <p class="more">
                <a href="/2015/11/30/2019030500103/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/30/2019030500103/" title="mysql 用户管理和权限设置">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/0.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/Oracle/">Oracle</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/30/2019030500145/">
    		Oracle rownum rowid 区别
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-30T03:08:24.000Z">2015-11-30</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/Oracle/" title="Oracle">Oracle</a> / 
    
        <a href="/tags/rowid/" title="rowid">rowid</a> / 
    
        <a href="/tags/rownum/" title="rownum">rownum</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>oracle中rownum和rowid的区别   . rownum和rowid都是伪列，但是两者的根本是不同的，rownum是根据sql查询出的结果给每行分配一个逻辑编号，所以你的sql不同也就会导致最终rownum不同，但是rowid是物理结构上的，在每条记录insert到数据库中时，都会有一个唯一的物理记录 ， 例如  AAAMgzAAEAAAAAgAAB 7499 ALLEN SALESMAN 7698 1981/2/20 1600.00 300.00 30 这里的AAAMgzAAEAAAAAgAAB物理位置对应了这条记录，这个记录是不会随着sql的改变而改变。 因此，这就导致了他们的使用场景不同了，通常在sql分页时或是查找某一范围内的记录时，我们会使用rownum。 1、rownum 例如： 查找2到10范围内的记录（这里包括2和10的记录） select <em> from (select rownum rn, a.</em> from emp a) t where t.rn between 2 and 10; 查找前三名的记录 select <em> from emp a where rownum &lt; 3；这里我们要注意，直接用rownum查找的范围必须要包含1；因为rownum是从1开始记录的，当然你可以把rownum查出来后放在一个虚表中作为这个虚表的字段再根据条件查询。 例如： select </em> from (select rownum rn, a.<em> from emp a) t where t.rn &gt; 2;这就可以了 2、rowid 我们在处理一张表中重复记录时经常用到他，当然你也可以用一个很原始的方法，就是将有重复记录的表中的数据导到另外一张表中，最后再倒回去。 SQL&gt;create table stu_tmp as select distinct</em> from stu; SQL&gt;truncate table sut;        //清空表记录 SQL&gt;insert into stu select * from stu_tmp;    //将临时表中的数据添加回原表但是要是stu的表数据是百万级或是更大的千万级的，那这样的方法显然是不明智的，因此我们可以根据rowid来处理，rowid具有唯一性，查询时效率是很高的， 例如，学生表中的姓名会有重复的情况，但是学生的学号是不会重复的，如果我们要删除学生表中姓名重复只留学号最大的学生的记录，怎么办呢？ delete from stu a where rowid not  in (select max(rowid) from stu b where a.name = b.name and a.stno &lt; b.stno); 这样就可以了。</p>

            
            <p class="more">
                <a href="/2015/11/30/2019030500145/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/30/2019030500145/" title="Oracle rownum rowid 区别">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/0.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/27/2019030500007/">
    		druid 心跳检测作用
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-27T04:36:55.000Z">2015-11-27</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/druid/" title="druid">druid</a> / 
    
        <a href="/tags/心跳/" title="心跳">心跳</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>数据库中连接时间设置：</p>
<ol>
<li>connect_timeout:  服务器关闭非交互连接之前等待活动的秒数</li>
<li>interactive_timeout:服务器关闭交互式连接前等待活动的秒数</li>
<li>这两个值默认都是288000（8小时），如果这两个值设置过大 或造成mysql产生大量的sleep进行，从而影响mysql的性能</li>
<li><p>MySQL服务器所支持的最大连接数是有上限的，因为每个连接的建立都会消耗内存，因此我们希望客户端在连接到MySQL Server处理完相应的操作后，应该断开连接并释放占用的内存。如果你的MySQL Server有大量的闲置连接，他们不仅会白白消耗内存，而且如果连接一直在累加而不断开，最终肯定会达到MySQL Server的连接上限数，这会报’too many connections’的错误。</p>
</li>
<li><p>在交互模式下，interactive_timeout取代wait_timeout。这样，如果有的客户端是交互模式方式连接mysql server。那么客户端的timeout受制于interactive_timeout。如果有的客户端是非交互模式，长连接mysql server。那么客户端的timeout受制于wait_timeout。(是否是交互模式的连接，由客户端决定)</p>
</li>
</ol>
<p>druid 规避  连接 异常：</p>
<ol>
<li>如果数据库连接超时 修改了的话，有可能为了提高数据库性能减小数据库压力，会将timeout设置的很小。那么 需要设置 druid的心跳检测来方式出现连接异常：</li>
<li>t;!– 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 –&gt;</li>
<li><property name="timeBetweenEvictionRunsMillis" value="5000">

</property></li>
</ol>
<p><strong>注意：如果心跳检测的时间设置的大于数据库的timeout，那么心跳检测是不起作用的！！！！</strong></p>

            
            <p class="more">
                <a href="/2015/11/27/2019030500007/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/27/2019030500007/" title="druid 心跳检测作用">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/7.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/Oracle/">Oracle</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/27/2019030500146/">
    		Oracle-SQL-排序操作
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-27T04:25:20.000Z">2015-11-27</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/Oracle/" title="Oracle">Oracle</a> / 
    
        <a href="/tags/SQL/" title="SQL">SQL</a> / 
    
        <a href="/tags/排序/" title="排序">排序</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>1、普通排序</p>
<ol>
<li>select * from emp  order by empno   asc(desc);</li>
</ol>
<p>2、根据多字段排序</p>
<ol>
<li>select * from emp order by ename,job  asc(desc);</li>
</ol>
<p>3、按子串排序</p>
<p>Sql代码</p>
<ol>
<li>select * from emp order by substr(ename,length(ename)-2)</li>
<li>通过substr函数实现子串的截取，然后进行排序</li>
</ol>
<p>4、对于字母、数字混合的数据进行排序 通过translate或者replace替换掉数字或字符部分，然后排序 translate(string,from,to) 字符级别的替换； 如果to的长度小于from则在from中存在，在to中不存在的将被直接删掉； replace(string,from ,to) 字符串级别的替换 5、排序时的空值处理 a、使用case when对空值进行替换，例如空值替换为0，非空值替换为1，然后可以参与排序 b、oracle9i以后的版本提供了 nulls first  和nulls  last操作。 6、根据数据项的键排序 采用类似占位符的方式来实现排序</p>
<ol>
<li>select empno,ename,job,case when job=’SALESMAN’ then comm else sal end from emp order by 4;</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/27/2019030500146/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/27/2019030500146/" title="Oracle-SQL-排序操作">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/7.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/Oracle/">Oracle</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/25/2019030500142/">
    		ORACLE遇到ORA-16038 错误处理
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-25T09:10:13.000Z">2015-11-25</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/Oracle/" title="Oracle">Oracle</a> / 
    
        <a href="/tags/ORA-16038/" title="ORA-16038">ORA-16038</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <ol>
<li>SQL&gt; shutdown</li>
<li><p>ORA-01507: database not mounted</p>
</li>
<li><p>ORACLE instance shut down.</p>
</li>
<li>SQL&gt; startup</li>
<li><p>ORACLE instance started.</p>
</li>
<li><p>Total System Global Area 2147483648 bytes</p>
</li>
<li>Fixed Size                  2022144 bytes</li>
<li>Variable Size            1560282368 bytes</li>
<li>Database Buffers          570425344 bytes</li>
<li>Redo Buffers               14753792 bytes</li>
<li>Database mounted.</li>
<li>ORA-16038: log 2 sequence# 391 cannot be archived</li>
<li>ORA-19809: limit exceeded for recovery files</li>
<li><p>ORA-00312: online log 2 thread 1: ‘/data1/oracle/oradata/xxdbse/redo02.log’</p>
<p> 解决：  </p>
</li>
<li><p>SQL&gt; select group#,sequence#,archived,status from v$log;</p>
</li>
<li><p>GROUP#  SEQUENCE# ARC STATUS</p>
</li>
<li><hr>
</li>
<li>1        394 NO  CURRENT</li>
<li>3        393 NO  INACTIVE</li>
<li><p>2        391 NO  INACTIVE</p>
</li>
<li><p>SQL&gt; alter database clear unarchived logfile group 3;</p>
</li>
<li><p>Database altered.</p>
</li>
<li><p>SQL&gt; alter database open;</p>
</li>
<li><p>Database altered.</p>
</li>
<li><p>SQL&gt; select group#,sequence#,archived,status from v$log;</p>
</li>
<li><p>GROUP#  SEQUENCE# ARC STATUS</p>
</li>
<li><hr>
</li>
<li>1        394 NO  INACTIVE</li>
<li>2        391 NO  INACTIVE</li>
<li>3        395 NO  CURRENT</li>
</ol>

            
            <p class="more">
                <a href="/2015/11/25/2019030500142/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/25/2019030500142/" title="ORACLE遇到ORA-16038 错误处理">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/MySQL/">MySQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/24/2019030500111/">
    		MySQL 高可用架构在业务层面的分析研究
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-24T07:28:29.000Z">2015-11-24</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/MySQL/" title="MySQL">MySQL</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><strong>前言：</strong> 相对于传统行业的相对服务时间9x9x6或者9x12x5，因为互联网电子商务以及互联网游戏的实时性，所以服务要求7<em>24小时，业务架构不管是应用还是数据库，都需要容灾互备，在mysql的体系中，最好通过在最开始阶段的数据库架构阶段来实现容灾系统。所以这里从业务宏观角度阐述下mysql架构的方方面面。 <strong>一. MySQL架构设计—业务分析</strong> （1）读多写少 虚线表示跨机房部署，比如电子商务系统，一个Master既有读也有些写，对读数据一致性需要比较重要的，读要放在Master上面。 M(R)仅仅是一个备库，只有M(WR)挂了之后，才会切换到M(R)上，这个时候M(R)就变成了读写库。比如游戏系统，有很多Salve会挂载后面一个M(R)上面。 （2）读多写少MMS-电商 如果是电子商务类型的，这种读多写少的，一般是1个master拖上4到6个slave，所有slave挂载在一个master也足够了。 切换的时候，把M1的读写业务切换到M2上面，然后把所有M1上的slave挂到M2上面去，如下所示：<img src="/uploads/2015/11/26230597_14125236608Q14.png" alt> （3）读多写少MMSS-游戏 如果是游戏行业的话，读非常多蛮明显的，会出现一般1个Master都会挂上10个以上的Slave的情况，所以这个时候，可以把一部分Slave挂载新的M(R)上面。至少会减少一些压力，这样至少服务器挂掉的时候，不会对所有的slave有影响，还有一部分在M(R)上的slave在继续，不会对所有的slave受到影响，见图3，<img src="/uploads/2015/11/26230597_14125236982QDx.png" alt> 图3 （4）读少写多 意味着读并不会影响写的效率，所以读写都可以放在一个M1(WR)，而另外一个不提供读也不提供写，只提供standby冗余异地容灾。<img src="/uploads/2015/11/26230597_1412523725kDa3.png" alt> 这个异地容灾是非常重要的，否则如果是单机的，单边的业务，万一idc机房故障了，一般就会影响在线业务的，这种 造成业务2小时无法应用，对于在线电子商务交易来说，影响是蛮大的，所以为了最大限度的保证7</em>24小时，必须要做到异地容灾，MM要跨idc机房。虽然对资源有一些要求，但是对HA来说是不可缺少的，一定要有这个MM机制。 做切换的时候，把所有的读写从M1直接切换到M2上就可以了。<img src="/uploads/2015/11/26230597_1412523759LF7F.png" alt> （5）读写平分秋色 读和写差不多，但是读不能影响写的能力，把读写放在M1(WR)上，然后把一部分读也放在M2(R)上面，当然M1和M2也是跨机房部署的。 切换的时候，把一部分读和全部写从M1切换到M2上就可以了。 <strong>二. MySQL架构设计—常见架构</strong> （1）强一致性 对读一致性的权衡，如果是对读写实时性要求非常高的话，就将读写都放在M1上面，M2只是作为standby，就是采取和上面的一（4）的读少写多的一样的架构模式。 比如，订单处理流程，那么对读需要强一致性，实时写实时读，类似这种涉及交易的或者动态实时报表统计的都要采用这种架构模式<img src="/uploads/2015/11/26230597_1412523786141I.png" alt> （2）弱一致性 如果是弱一致性的话，可以通过在M2上面分担一些读压力和流量，比如一些报表的读取以及静态配置数据的读取模块都可以放到M2上面。比如月统计报表，比如首页推荐商品业务实时性要求不是很高，完全可以采用这种弱一致性的设计架构模式。<img src="/uploads/2015/11/26230597_1412523811aApV.png" alt> （3）中间一致性 如果既不是很强的一致性又不是很弱的一致性，那么我们就采取中间的策略，就是在同机房再部署一个S1(R)，作为备库，提供读取服务，减少M1(WR)的压力，而另外一个idc机房的M2只做standby容灾方式的用途。 当然这里会用到3台数据库服务器，也许会增加采购压力，但是我们可以提供更好的对外数据服务的能力和途径，实际中尽可能两者兼顾。 <img src="/uploads/2015/11/26230597_1412523913ceoM.png" alt> （4）统计业务 比如PV、UV操作、页数的统计、流量的统计、数据的汇总等等，都可以划归为统计类型的业务。 数据库上做大查询的统计是非常消耗资源的。统计分为实时的统计和非实时的统计，由于mysql主从是逻辑sql的模式，所以不能达到100%的实时，如果是online要严格的非常实时的统计比如像火车票以及金融异地结算等的统计，mysql这块不是它的强项，就只有查询M1主库来实现了。 A，但是对于不是严格的实时性的统计，mysql有个很好的机制是binlog，我们可以通过binlog进行解析Parser，解析出来写入统计表进行统计或者发消息给应用端程序来进行统计。这种是准实时的统计操作，有一定的短暂的可接受的统计延迟现象，如果要100%实时性统计只有查询M1主库了。 通过binlog的方式实现统计，在互联网行业，尤其是电商和游戏这块，差不多可以解决90%以上的统计业务。有时候如果用户或者客户提出要实时read-time了，大家可以沟通一下为什么需要实时，了解具体的业务场景，有些可能真的不需要实时统计，需要有所权衡，需要跟用户和客户多次有效沟通，做出比较适合业务的统计架构模型。 B，还有一种offline统计业务，比如月份报表年报表统计等，这种完全可以把数据放到数据仓库里面或者第三方Nosql里面进行统计。 <img src="/uploads/2015/11/26230597_1412523957JKio.png" alt> （5）历史数据迁移 历史数据迁移，需要尽量不影响现在线上的业务，尽量不影响现在线上的查询写入操作，为什么要做历史数据迁移？因为有些业务的数据是有时效性的，比如电商中的已经完成的历史订单等，不会再有更新操作了，只有很简单的查询操作，而且查询也不会很频繁，甚至可能一天都不会查询一次。 如果这时候历史数据还在online库里面或者online表里面，那么就会影响online的性能，所以对于这种，可以把数据迁移到新的历史数据库上，这个历史数据库可以是mysql也可以是nosql，也可以是数据仓库甚至hbase大数据等。 实现途径是通过slave库查询出所有的数据，然后根据业务规则比如时间、某一个纬度等过滤筛选出数据，放入历史数据库(History Databases)里面。迁移完了，再回到主库M1上，删除掉这些历史数据。这样在业务层面，查询就要兼顾现在实时数据和历史数据，可以在filter上面根据迁移规则把online查询和history查询对接起来。比如说一个月之内的在online库查询一个月之前的在history库查询，可以把这个规则放在DB的迁移filter层和应用查询业务模块层。如果可以的话，还可以配置更细化，通过应用查询业务模块层来影响DB的迁移filter层，比如以前查询分为一个月为基准，现在查询业务变化了，以15天为基准，那么应用查询业务模块层变化会自动让DB的filter层也变化，实现半个自动化，更加智能一些。 <img src="/uploads/2015/11/26230597_1412524001L6F6.png" alt> （6）MySQL Sharding 像oracle这种基于rac基于共享存储的方式，不需要sharding只需要扩从rac存储就能实现了。但是这种代价相对会比较高一些，共享存储一般都比较贵，随着业务的扩展数据的爆炸式增长，你会不停累计你的成本，甚至达到一个天文数字。 目前这种share disk的方式，除了oracle的业务逻辑层做的非常完善之外其他的解决方案都还不是很完美。 Mysql的sharding也有其局限性，sharding之后的数据查询访问以及统计都会有很大的问题，mysql的sharding是解决share nothing的存储的一种分布式的方法，大体上分为垂直拆分和水平拆分。 （6.1）垂直拆分 可以横向拆分，可以纵向拆分，可以横向纵向拆分，还可以按照业务拆分。 6.1.1横向拆分 Mysql库里面的横向拆分是指，每一个数据库实例里面都有很多个db库，每一个db库里面都有A表B表，比如db1库有A表B表，db2库里也有A表和B表，那么我们把db1、db2库的A表B表拆分出来，把一个库分成2个，就拆分成db1、db2、db3、db4，其中db1库和db2库放A表数据，db3库和db4库放B表的数据，db1、db2库里面只有A表数据，db3、db4库里面只有B表的数据。 打个比方，作为电商来说，每个库里面都有日志表和订单表，假如A表是日志表log表，B表是订单表Order表，一般说来写日志和写订单没有强关联性，我们可以讲A表日志表和B表订单表拆分出来。那么这个时候就做了一次横向的拆分工作，将A表日志表和B表订单表拆分开来放在不同的库，当然A表和B表所在的数据库名也可以保持一致(PS：在不同的实例里面)，如下图所示： <img src="/uploads/2015/11/26230597_1412524048ma3Z.png" alt> PS：这种拆分主要针对于不同的业务对表的影响不大，表之间的业务关联很弱或者基本上没有业务关联。拆分的好处是不相关的数据表拆分到不同的实例里面，对数据库的容量扩展和性能提高的均衡来说，都是蛮有好处的。 6.1.2纵向拆分 把同一个实例上的不同的db库拆分出来，放入单独的不同实例中。这种拆分的适应场景和要求是db1和db2是没有多少业务联系的，类似6.1.2里面的A表和B表那样。如果你用到了跨库业务同时使用db1和db2的话，个人建议要重新考虑下业务，重新梳理下尽量把一个模块的表放在一个库里面，不要垮库操作。 这种库纵向拆分里面，单独的库db1，表A和表B是强关联的。如下图所示： <img src="/uploads/2015/11/26230597_1412524091tz9A.png" alt> PS：看到很多使用mysql的人，总是把很多没有业务关联性的表放在一个库里面，或者总是把很多个的db库放在同一个实例里面，就像使用oracle那样就一个instance的概念而已。Mysql的使用一大原则就是简单，尽量单一，简单的去使用mysql，库要严格的分开；表没有关系的，要严格拆分成库。这样的话扩展我们的业务就非常方便简单了，只需要把业务模块所在的db拆分出来，放入新的数据库服务器上即可。 6.1.3横向纵向拆分 有些刚起步的，开始为了快速出产品，就把所以的库所有的表都放在一个实例上，等业务发展后，就面临着数据拆分，这里就会把横向纵向拆分结合起来，一起实现，如下图所示： <img src="/uploads/2015/11/26230597_1412524129f4bF.png" alt> 6.1.4业务拆分 跟水平拆分有点类似，但是有不同的地方。比如一个供应商，可能整个网站上有10个供应商，一个网站上面每一个供应商都有一定的量，而且供应商之间的数据量规模都差不多的规模，那么这个时候就可以使用供应商的纬度来做拆分。 比如usern库中，a、b、c表都是强关联的，都有完整的业务逻辑存在，这里只有用户（供应商）纬度是没有关联的，那这个时候就可以把数据以用户的纬度来进行拆分。 就是用户1和用户2各自都有一套完整的业务逻辑，而且彼此之间不关联，所以就可以把用户1和用户2数据拆分到不同的数据库实例上面。目前很多互联网公司或者游戏公司有很多业务都是以用户纬度进行拆分的，比如qunaer、sohu game、sina等。 <img src="/uploads/2015/11/26230597_1412524160Vz9P.png" alt> （6.2） 水平拆分 水平拆分相对要简单一些，但是难度偏大，会导致分布式的情况、跨数据的情况、跨事务的情况可以分为大概三类，1是历史数据和实时数据拆分，2是单库多表拆分，3是多库多表拆分。 <strong>　　6.2.1实时数据历史数据的拆分</strong> 和历史数据迁移是一样的逻辑，就是要将online库的数据迁移到listory的数据库里面，对于实时的读写来说，数据是放在online db库里面，对于时间较远的数据来说，是放在历史History DB记录库里面的，这里的历史库可以是mysql也可以是别的nosql库等。 <img src="/uploads/2015/11/26230597_1412524200g5G6.png" alt> <strong>　　6.2.2单库多表拆分</strong> 主要不是解决容量问题，而是解决性能问题而扩展的，加入当前实例只有一个DB，有一个大表，一个大表就把整个实例占满了，这个时候就不能拆分db了，因为只有一个单表，这个时候我们就只能拆表了，拆表的方式主要是解决性能问题，因为单个表越大，对于mysql来说遍历表的树形结构遍历数据会消耗更多的资源，有时候一个简单的查询就可能会引起整个db的很多叶子节点都要变动。表的insert、update、delete操作都会引起几乎所有节点的变更，此时操作量会非常大，操作的时候读写性能都会很低，这个时候我们就可以考虑把大表拆分成多个小表，工作经历中是按照hash取模打散成16个小表，也有按照id主键/50取模打散到50个小表当中，下图实例是打散成2个小表。 <img src="/uploads/2015/11/26230597_1412524223NCxs.png" alt> <strong>　　6.2.3多库多表拆分</strong> 在单库多表的基础上，如果单库空间资源已经不足以提供业务支撑的话，可以考虑多库多表的方式来做，解决了空间问题和性能问题，不过会有一个问题就是跨库查询操作，查询就会有另外的策略，比如说加一个logic db层来实现跨库跨实例自动查询，简单如下图所示： <img src="/uploads/2015/11/26230597_1412524249tDq8.png" alt> <strong>　　6.2.4水平拆分小结</strong> 水平拆分原则： -- a.尽量均匀的拆分维度。 – b.尽量避免跨库事务。 – c.尽量避免跨库查询。 设计： –a根据拆分维度，做mod进行数据表拆分，大部分都是取模的拆分机制，比如hash的16模原则等。 –b根据数据容量，划分数据库拆分 数据操作 –a跨事务操作：分布式事务，通过预写日志的方式来间接地实现。 –b跨库查询：数据汇总or消息服务 <strong>　　6.2.5案例说明</strong> u 案例： – 按照用户维度进行拆分成64个分库，1024个分表 ?user_id%1024拆分到1024张分表中 ? 每个分库中存放1024/64张分表 ? 取模的时候，可以用id的最后4位数据或者3位数字来取模就可以了。 <img src="/uploads/2015/11/26230597_1412524295NgP6.png" alt> u 操作1：采用Configure DB – 拆分之后的查询操作，做一个Configure DB，这个DB存放的是所有实例的库表的映射关系，当我APP发来有一个请求查询user1的数据，那么这个user1的数据是存放在上千个实例中的哪一个库表呢？这个关联信息就在Configure DB里面，APP先去Configure DB里面取得user1的关联系信息(比如是存放在d_01库上的t_0016表里面)，然后APP根据关联信息直接去查询对应的d_01实例的t_0016表里面取得数据。 <img src="/uploads/2015/11/26230597_1412524329zfFY.png" alt> u 操作2：采用Proxy – 拆分之后的查询操作，做一个Proxy，APP访问Proxy，Proxy根据访问规则就可以直接路由到具体的db实例，生成新的sql去操作对应的db实例，然后通过Proxy协议进行操作把操作结果返回给APP。 – 优势是Proxy和db实例是在一个网段，这样Proxy与db实例的操作的时间是非常短的。 <img src="/uploads/2015/11/26230597_1412524367P848.png" alt> u 操作3：采用Data Engine – 拆分之后的查询操作，有一个Data Engine Service，这个DES里面配置了所有数据库实例的映射关系，需要在APP应用端安装一个Agent，是同步逻辑，在JDBC层实现，DES可以实现读写分离，原理可以参考TDDL的实现。 <img src="/uploads/2015/11/26230597_1412524397urm8.png" alt> <strong>　　6.3集群管理</strong> 纵向扩容：一个实例拆分成多个实例，纵向拆分比较简单，修改的东西比较少，拆分的时候要通知到Configure DB或者DES，以免拆分之后查询不到数据或者数据录入不到新的db上面，如下图所示： <img src="/uploads/2015/11/26230597_14125244398C03.png" alt> 横向扩容：比较复杂，在纵向扩容成2个库的基础之上，再一次对库的表进行扩容，所以需要及时通知Configure DB和DES更细库和表的路由连接信息。 <img src="/uploads/2015/11/26230597_1412524468uW2X.png" alt></p>

            
            <p class="more">
                <a href="/2015/11/24/2019030500111/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/24/2019030500111/" title="MySQL 高可用架构在业务层面的分析研究">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/4.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/NOSQL/">NOSQL</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="/2015/11/24/2019030500006/">
    		CentOS7安装redis
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2015-11-24T07:09:26.000Z">2015-11-24</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/redis/" title="redis">redis</a> / 
    
        <a href="/tags/CentOS7/" title="CentOS7">CentOS7</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>本文介绍在CentOS7上安装redis数据库。 系统配置信息如下：  </p>
<p>C代码</p>
<ol>
<li>[linus@localhost ~]$ uname -r</li>
<li>3.10.0-229.20.1.el7.x86_64</li>
<li>[linus@localhost ~]$ more /etc/redhat-release</li>
<li>CentOS Linux release 7.1.1503 (Core)</li>
<li>[linus@localhost ~]$</li>
</ol>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>1、下载Redis，当前最新版本是3.0.5，然后安装。</p>
<ol>
<li>[linus@localhost redis]$ wget <a href="http://download.redis.io/releases/redis-3.0.5.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-3.0.5.tar.gz</a></li>
<li>–2015-11-24 13:33:32–  <a href="http://download.redis.io/releases/redis-3.0.5.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-3.0.5.tar.gz</a></li>
<li>Resolving download.redis.io (download.redis.io)… 109.74.203.151</li>
<li>Connecting to download.redis.io (download.redis.io)|109.74.203.151|:80… connected.</li>
<li>HTTP request sent, awaiting response… 200 OK</li>
<li>Length: 1366160 (1.3M) [application/x-gzip]</li>
<li><p>Saving to: ‘redis-3.0.5.tar.gz’</p>
</li>
<li><p>100%[==============================================&gt;] 1,366,160   40.0KB/s   in 25s</p>
</li>
<li><p>2015-11-24 13:33:58 (54.1 KB/s) - ‘redis-3.0.5.tar.gz’ saved [1366160/1366160]</p>
</li>
<li><p>[linus@localhost redis]$</p>
</li>
<li>[linus@localhost redis]$ ls</li>
<li>redis-3.0.5.tar.gz</li>
<li>[linus@localhost redis]$ tar -zxf redis-3.0.5.tar.gz</li>
<li>[linus@localhost redis]$ cd redis-3.0.5/</li>
<li>[linus@localhost redis-3.0.5]$ make</li>
<li>cd src &amp;&amp; make all</li>
<li>make[1]: Entering directory `/home/linus/redis/redis-3.0.5/src’</li>
<li>rm -rf redis-server redis-sentinel redis-cli redis-benchmark redis-check-dump redis-check-aof <em>.o </em>.gcda <em>.gcno </em>.gcov redis.info lcov-html</li>
<li>(cd ../deps &amp;&amp; make distclean)</li>
<li>make[2]: Entering directory `/home/linus/redis/redis-3.0.5/deps’</li>
<li>(cd hiredis &amp;&amp; make clean) &gt; /dev/null || true</li>
<li>(cd linenoise &amp;&amp; make clean) &gt; /dev/null || true</li>
<li>(cd lua &amp;&amp; make clean) &gt; /dev/null || true</li>
<li>(cd jemalloc &amp;&amp; [ -f Makefile ] &amp;&amp; make distclean) &gt; /dev/null || true</li>
<li>(rm -f .make-*)</li>
<li>make[2]: Leaving directory `/home/linus/redis/redis-3.0.5/deps’</li>
<li>(rm -f .make-*)</li>
<li>echo STD=-std=c99 -pedantic &gt;&gt; .make-settings</li>
<li>echo WARN=-Wall -W &gt;&gt; .make-settings</li>
<li>echo OPT=-O2 &gt;&gt; .make-settings</li>
<li>echo MALLOC=jemalloc &gt;&gt; .make-settings</li>
<li>echo CFLAGS= &gt;&gt; .make-settings</li>
<li>echo LDFLAGS= &gt;&gt; .make-settings</li>
<li>echo REDIS_CFLAGS= &gt;&gt; .make-settings</li>
<li>echo REDIS_LDFLAGS= &gt;&gt; .make-settings</li>
<li>echo PREV_FINAL_CFLAGS=-std=c99 -pedantic -Wall -W -O2 -g -ggdb   -I../deps/hiredis -I../deps/linenoise -I../deps/lua/src -DUSE_JEMALLOC -I../deps/jemalloc/include &gt;&gt; .make-settings</li>
<li>echo PREV_FINAL_LDFLAGS=  -g -ggdb -rdynamic &gt;&gt; .make-settings</li>
<li>。。。</li>
<li>。。。</li>
<li>LINK redis-server</li>
<li>INSTALL redis-sentinel</li>
<li>CC redis-cli.o</li>
<li>LINK redis-cli</li>
<li>CC redis-benchmark.o</li>
<li>LINK redis-benchmark</li>
<li>CC redis-check-dump.o</li>
<li>LINK redis-check-dump</li>
<li>CC redis-check-aof.o</li>
<li><p>LINK redis-check-aof</p>
</li>
<li><p>Hint: It’s a good idea to run ‘make test’ ;)</p>
</li>
<li><p>make[1]: Leaving directory `/home/linus/redis/redis-3.0.5/src’</p>
</li>
</ol>
<p>然后执行make test进行验证，报如下错误，安装tcl之后就可以正常执行了：</p>
<ol>
<li>[linus@localhost redis-3.0.5]$ make test</li>
<li>cd src &amp;&amp; make test</li>
<li>make[1]: Entering directory `/home/linus/redis/redis-3.0.5/src’</li>
<li>You need tcl 8.5 or newer in order to run the Redis test</li>
<li>make[1]: *** [test] Error 1</li>
<li>make[1]: Leaving directory `/home/linus/redis/redis-3.0.5/src’</li>
<li>make: *** [test] Error 2</li>
<li>[linus@localhost redis-3.0.5]$ make test</li>
<li>…</li>
<li>…</li>
<li><p>The End</p>
</li>
<li><p>Execution time of different units:</p>
</li>
<li>1 seconds - unit/printver</li>
<li>2 seconds - unit/scan</li>
<li>2 seconds - unit/quit</li>
<li>3 seconds - unit/auth</li>
<li>3 seconds - unit/multi</li>
<li>5 seconds - unit/protocol</li>
<li>11 seconds - unit/expire</li>
<li>21 seconds - unit/type/list</li>
<li>35 seconds - unit/other</li>
<li>40 seconds - unit/type/list-2</li>
<li>19 seconds - integration/aof</li>
<li>41 seconds - unit/type/hash</li>
<li>42 seconds - unit/dump</li>
<li>3 seconds - integration/logging</li>
<li>2 seconds - unit/pubsub</li>
<li>8 seconds - integration/rdb</li>
<li>3 seconds - unit/slowlog</li>
<li>2 seconds - unit/introspection</li>
<li>6 seconds - integration/convert-zipmap-hash-on-load</li>
<li>2 seconds - unit/limits</li>
<li>12 seconds - unit/scripting</li>
<li>19 seconds - unit/bitops</li>
<li>67 seconds - unit/type/set</li>
<li>72 seconds - integration/replication-2</li>
<li>30 seconds - unit/memefficiency</li>
<li>77 seconds - unit/type/zset</li>
<li>79 seconds - unit/sort</li>
<li>79 seconds - unit/aofrw</li>
<li>84 seconds - unit/basic</li>
<li>42 seconds - unit/maxmemory</li>
<li>91 seconds - unit/type/list-3</li>
<li>117 seconds - integration/replication-4</li>
<li>67 seconds - unit/hyperloglog</li>
<li>122 seconds - integration/replication-3</li>
<li>137 seconds - integration/replication</li>
<li>134 seconds - integration/replication-psync</li>
<li><p>114 seconds - unit/obuf-limits</p>
</li>
<li><p>\o/ All tests passed without errors!</p>
</li>
<li><p>Cleanup: may take some time… OK</p>
</li>
<li>make[1]: Leaving directory `/home/linus/redis/redis-3.0.5/src’</li>
<li>[linus@localhost redis-3.0.5]$</li>
</ol>
<p>安装完成后，可以切换src目录下，执行redis-server命令启动redis服务器：  </p>
<ol>
<li>[linus@localhost src]$ ./redis-server &amp;</li>
<li>[1] 8921</li>
<li>[linus@localhost src]$ 8921:C 24 Nov 13:44:17.995 # Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf</li>
<li>8921:M 24 Nov 13:44:17.997 # You requested maxclients of 10000 requiring at least 10032 max file descriptors.</li>
<li>8921:M 24 Nov 13:44:17.997 # Redis can’t set maximum open files to 10032 because of OS error: Operation not permitted.</li>
<li>8921:M 24 Nov 13:44:17.997 # Current maximum open files is 4096. maxclients has been reduced to 4064 to compensate for low ulimit. If you need higher maxclients increase ‘ulimit -n’.</li>
<li>_._</li>
<li><em>.-<code></code>__ ‘’-.</em></li>
<li><em>.-<code></code>    <code>.</code></em>.  ‘’-._           Redis 3.0.5 (00000000/0) 64 bit</li>
<li>.-<code>.-`</code>.  <code>`</code>\/    _.,_ ‘’-._</li>
<li>(    ‘      ,       .-<code>|</code>,    )     Running in standalone mode</li>
<li>|<code>-._</code>-…-<code>__...-.`</code>-._|’` _.-‘|     Port: 6379</li>
<li>|    <code>-._</code>._    /     _.-‘    |     PID: 8921</li>
<li><code>-._</code>-._  `-./  _.-‘    _.-‘</li>
<li>|<code>-._</code>-._    `-.__.-‘    <em>.-‘</em>.-‘|</li>
<li>|    <code>-._</code>-._        <em>.-‘</em>.-‘    |           <a href="http://redis.io" target="_blank" rel="noopener">http://redis.io</a>        </li>
<li><code>-._</code>-.<em>`-.__.-‘</em>.-‘    _.-‘</li>
<li>|<code>-._</code>-._    `-.__.-‘    <em>.-‘</em>.-‘|</li>
<li>|    <code>-._</code>-._        <em>.-‘</em>.-‘    |</li>
<li><code>-._</code>-.<em>`-.__.-‘</em>.-‘    _.-‘</li>
<li><code>-._</code>-.__.-‘    _.-‘</li>
<li>`-._        _.-‘</li>
<li><p>`-.__.-‘</p>
</li>
<li><p>8921:M 24 Nov 13:44:17.998 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</p>
</li>
<li>8921:M 24 Nov 13:44:17.999 # Server started, Redis version 3.0.5</li>
<li>8921:M 24 Nov 13:44:17.999 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add ‘vm.overcommit_memory = 1’ to /etc/sysctl.conf and then reboot or run the command ‘sysctl vm.overcommit_memory=1’ for this to take effect.</li>
<li>8921:M 24 Nov 13:44:17.999 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command ‘echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled’ as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</li>
<li>8921:M 24 Nov 13:44:17.999 * DB loaded from disk: 0.000 seconds</li>
<li><p>8921:M 24 Nov 13:44:17.999 * The server is now ready to accept connections on port 6379</p>
<p>此时可以通过redis-cli命令连接该redis服务器，并且可以通过SHUTDOWN命令关闭服务器：</p>
</li>
<li><p>[linus@localhost src]$ ./redis-cli</p>
</li>
<li>127.0.0.1:6379&gt; INFO</li>
<li><h1 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h1></li>
<li>redis_version:3.0.5</li>
<li>redis_git_sha1:00000000</li>
<li>redis_git_dirty:0</li>
<li>redis_build_id:cdf25f7608cc4cbe</li>
<li>redis_mode:standalone</li>
<li>os:Linux 3.10.0-229.20.1.el7.x86_64 x86_64</li>
<li>arch_bits:64</li>
<li>multiplexing_api:epoll</li>
<li>gcc_version:4.8.3</li>
<li>process_id:8921</li>
<li>run_id:c4bf78bec7e54a517634bb62430406946c91733d</li>
<li>tcp_port:6379</li>
<li>uptime_in_seconds:104</li>
<li>uptime_in_days:0</li>
<li>hz:10</li>
<li>lru_clock:5503385</li>
<li><p>config_file:</p>
</li>
<li><h1 id="Clients"><a href="#Clients" class="headerlink" title="Clients"></a>Clients</h1></li>
<li>connected_clients:1</li>
<li>client_longest_output_list:0</li>
<li>client_biggest_input_buf:0</li>
<li><p>blocked_clients:0</p>
</li>
<li><h1 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h1></li>
<li>used_memory:508712</li>
<li>used_memory_human:496.79K</li>
<li>used_memory_rss:8024064</li>
<li>used_memory_peak:508712</li>
<li>used_memory_peak_human:496.79K</li>
<li>used_memory_lua:36864</li>
<li>mem_fragmentation_ratio:15.77</li>
<li><p>mem_allocator:jemalloc-3.6.0</p>
</li>
<li><h1 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h1></li>
<li>loading:0</li>
<li>rdb_changes_since_last_save:0</li>
<li>rdb_bgsave_in_progress:0</li>
<li>rdb_last_save_time:1448343857</li>
<li>rdb_last_bgsave_status:ok</li>
<li>rdb_last_bgsave_time_sec:-1</li>
<li>rdb_current_bgsave_time_sec:-1</li>
<li>aof_enabled:0</li>
<li>aof_rewrite_in_progress:0</li>
<li>aof_rewrite_scheduled:0</li>
<li>aof_last_rewrite_time_sec:-1</li>
<li>aof_current_rewrite_time_sec:-1</li>
<li>aof_last_bgrewrite_status:ok</li>
<li><p>aof_last_write_status:ok</p>
</li>
<li><h1 id="Stats"><a href="#Stats" class="headerlink" title="Stats"></a>Stats</h1></li>
<li>total_connections_received:1</li>
<li>total_commands_processed:0</li>
<li>instantaneous_ops_per_sec:0</li>
<li>total_net_input_bytes:14</li>
<li>total_net_output_bytes:0</li>
<li>instantaneous_input_kbps:0.00</li>
<li>instantaneous_output_kbps:0.00</li>
<li>rejected_connections:0</li>
<li>sync_full:0</li>
<li>sync_partial_ok:0</li>
<li>sync_partial_err:0</li>
<li>expired_keys:0</li>
<li>evicted_keys:0</li>
<li>keyspace_hits:0</li>
<li>keyspace_misses:0</li>
<li>pubsub_channels:0</li>
<li>pubsub_patterns:0</li>
<li>latest_fork_usec:0</li>
<li><p>migrate_cached_sockets:0</p>
</li>
<li><h1 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h1></li>
<li>role:master</li>
<li>connected_slaves:0</li>
<li>master_repl_offset:0</li>
<li>repl_backlog_active:0</li>
<li>repl_backlog_size:1048576</li>
<li>repl_backlog_first_byte_offset:0</li>
<li><p>repl_backlog_histlen:0</p>
</li>
<li><h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1></li>
<li>used_cpu_sys:0.10</li>
<li>used_cpu_user:0.04</li>
<li>used_cpu_sys_children:0.00</li>
<li><p>used_cpu_user_children:0.00</p>
</li>
<li><h1 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h1></li>
<li><p>cluster_enabled:0</p>
</li>
<li><h1 id="Keyspace"><a href="#Keyspace" class="headerlink" title="Keyspace"></a>Keyspace</h1></li>
<li>127.0.0.1:6379&gt;</li>
<li>127.0.0.1:6379&gt; SHUTDOWN</li>
<li><p>not connected&gt;</p>
</li>
<li><p>服务器端会打印：</p>
</li>
<li>8921:M 24 Nov 13:46:52.838 # User requested shutdown…</li>
<li>8921:M 24 Nov 13:46:52.838 * Saving the final RDB snapshot before exiting.</li>
<li>8921:M 24 Nov 13:46:52.844 * DB saved on disk</li>
<li>8921:M 24 Nov 13:46:52.844 # Redis is now ready to exit, bye bye…</li>
</ol>
<p>服务器端配置：   最关键的配置以下选项：</p>
<ol>
<li><h1 id="By-default-Redis-does-not-run-as-a-daemon-Use-‘yes’-if-you-need-it"><a href="#By-default-Redis-does-not-run-as-a-daemon-Use-‘yes’-if-you-need-it" class="headerlink" title="By default Redis does not run as a daemon. Use ‘yes’ if you need it."></a>By default Redis does not run as a daemon. Use ‘yes’ if you need it.</h1></li>
<li><h1 id="Note-that-Redis-will-write-a-pid-file-in-var-run-redis-pid-when-daemonized"><a href="#Note-that-Redis-will-write-a-pid-file-in-var-run-redis-pid-when-daemonized" class="headerlink" title="Note that Redis will write a pid file in /var/run/redis.pid when daemonized."></a>Note that Redis will write a pid file in /var/run/redis.pid when daemonized.</h1></li>
<li>daemonize yes</li>
<li><h1 id="Specify-the-server-verbosity-level"><a href="#Specify-the-server-verbosity-level" class="headerlink" title="Specify the server verbosity level."></a>Specify the server verbosity level.</h1></li>
<li><h1 id="This-can-be-one-of"><a href="#This-can-be-one-of" class="headerlink" title="This can be one of:"></a>This can be one of:</h1></li>
<li><h1 id="debug-a-lot-of-information-useful-for-development-testing"><a href="#debug-a-lot-of-information-useful-for-development-testing" class="headerlink" title="debug (a lot of information, useful for development/testing)"></a>debug (a lot of information, useful for development/testing)</h1></li>
<li><h1 id="verbose-many-rarely-useful-info-but-not-a-mess-like-the-debug-level"><a href="#verbose-many-rarely-useful-info-but-not-a-mess-like-the-debug-level" class="headerlink" title="verbose (many rarely useful info, but not a mess like the debug level)"></a>verbose (many rarely useful info, but not a mess like the debug level)</h1></li>
<li><h1 id="notice-moderately-verbose-what-you-want-in-production-probably"><a href="#notice-moderately-verbose-what-you-want-in-production-probably" class="headerlink" title="notice (moderately verbose, what you want in production probably)"></a>notice (moderately verbose, what you want in production probably)</h1></li>
<li><h1 id="warning-only-very-important-critical-messages-are-logged"><a href="#warning-only-very-important-critical-messages-are-logged" class="headerlink" title="warning (only very important / critical messages are logged)"></a>warning (only very important / critical messages are logged)</h1></li>
<li>loglevel notice</li>
<li><h1 id="Specify-the-log-file-name-Also-the-empty-string-can-be-used-to-force"><a href="#Specify-the-log-file-name-Also-the-empty-string-can-be-used-to-force" class="headerlink" title="Specify the log file name. Also the empty string can be used to force"></a>Specify the log file name. Also the empty string can be used to force</h1></li>
<li><h1 id="Redis-to-log-on-the-standard-output-Note-that-if-you-use-standard"><a href="#Redis-to-log-on-the-standard-output-Note-that-if-you-use-standard" class="headerlink" title="Redis to log on the standard output. Note that if you use standard"></a>Redis to log on the standard output. Note that if you use standard</h1></li>
<li><h1 id="output-for-logging-but-daemonize-logs-will-be-sent-to-dev-null"><a href="#output-for-logging-but-daemonize-logs-will-be-sent-to-dev-null" class="headerlink" title="output for logging but daemonize, logs will be sent to /dev/null"></a>output for logging but daemonize, logs will be sent to /dev/null</h1></li>
<li>logfile /var/log/redis.log</li>
<li><h1 id="The-working-directory"><a href="#The-working-directory" class="headerlink" title="The working directory."></a>The working directory.</h1></li>
<li>#</li>
<li><h1 id="The-DB-will-be-written-inside-this-directory-with-the-filename-specified"><a href="#The-DB-will-be-written-inside-this-directory-with-the-filename-specified" class="headerlink" title="The DB will be written inside this directory, with the filename specified"></a>The DB will be written inside this directory, with the filename specified</h1></li>
<li><h1 id="above-using-the-‘dbfilename’-configuration-directive"><a href="#above-using-the-‘dbfilename’-configuration-directive" class="headerlink" title="above using the ‘dbfilename’ configuration directive."></a>above using the ‘dbfilename’ configuration directive.</h1></li>
<li>#</li>
<li><h1 id="The-Append-Only-File-will-also-be-created-inside-this-directory"><a href="#The-Append-Only-File-will-also-be-created-inside-this-directory" class="headerlink" title="The Append Only File will also be created inside this directory."></a>The Append Only File will also be created inside this directory.</h1></li>
<li>#</li>
<li><h1 id="Note-that-you-must-specify-a-directory-here-not-a-file-name"><a href="#Note-that-you-must-specify-a-directory-here-not-a-file-name" class="headerlink" title="Note that you must specify a directory here, not a file name."></a>Note that you must specify a directory here, not a file name.</h1></li>
<li><p>dir ./</p>
<p>添加启动脚本/etc/init.d/redis：</p>
</li>
<li><p>#!/bin/sh</p>
</li>
<li>#</li>
<li><h1 id="redis-Startup-script-for-Redis-Server"><a href="#redis-Startup-script-for-Redis-Server" class="headerlink" title="redis        Startup script for Redis Server"></a>redis        Startup script for Redis Server</h1></li>
<li>#</li>
<li><h1 id="chkconfig-90-10"><a href="#chkconfig-90-10" class="headerlink" title="chkconfig: - 90 10"></a>chkconfig: - 90 10</h1></li>
<li><h1 id="description-Redis-is-an-open-source-advanced-key-value-store"><a href="#description-Redis-is-an-open-source-advanced-key-value-store" class="headerlink" title="description: Redis is an open source, advanced key-value store."></a>description: Redis is an open source, advanced key-value store.</h1></li>
<li>#</li>
<li><h1 id="processname-redis-server"><a href="#processname-redis-server" class="headerlink" title="processname: redis-server"></a>processname: redis-server</h1></li>
<li><h1 id="config-etc-redis-conf"><a href="#config-etc-redis-conf" class="headerlink" title="config: /etc/redis.conf"></a>config: /etc/redis.conf</h1></li>
<li><h1 id="pidfile-var-run-redis-pid"><a href="#pidfile-var-run-redis-pid" class="headerlink" title="pidfile: /var/run/redis.pid"></a>pidfile: /var/run/redis.pid</h1></li>
<li><p>REDISPORT=6379</p>
</li>
<li><h1 id="下面的目录要看编译的目录，这两个文件会在编译目录的src目录下。"><a href="#下面的目录要看编译的目录，这两个文件会在编译目录的src目录下。" class="headerlink" title="下面的目录要看编译的目录，这两个文件会在编译目录的src目录下。"></a>下面的目录要看编译的目录，这两个文件会在编译目录的src目录下。</h1></li>
<li>EXEC=/usr/local/bin/redis-server</li>
<li><p>REDIS_CLI=/usr/local/bin/redis-cli</p>
</li>
<li><p>PIDFILE=/var/run/redis.pid</p>
</li>
<li><h1 id="下面的目录要看编译的目录，这个文件会在编译目录下。"><a href="#下面的目录要看编译的目录，这个文件会在编译目录下。" class="headerlink" title="下面的目录要看编译的目录，这个文件会在编译目录下。"></a>下面的目录要看编译的目录，这个文件会在编译目录下。</h1></li>
<li><p>CONF=”/usr/src/redis-2.8.13/redis.conf”</p>
</li>
<li><p>case “$1” in</p>
</li>
<li>start)</li>
<li>if [ -f $PIDFILE ]</li>
<li>then</li>
<li>echo “$PIDFILE exists, process is already running or crashed”</li>
<li>else</li>
<li>echo “Starting Redis server…”</li>
<li>$EXEC $CONF</li>
<li>fi</li>
<li>if [ “$?”=”0” ]</li>
<li>then</li>
<li>echo “Redis is running…”</li>
<li>fi</li>
<li>;;</li>
<li>stop)</li>
<li>if [ ! -f $PIDFILE ]</li>
<li>then</li>
<li>echo “$PIDFILE does not exist, process is not running”</li>
<li>else</li>
<li>PID=$(cat $PIDFILE)</li>
<li>echo “Stopping …”</li>
<li>$REDIS_CLI -p $REDISPORT SHUTDOWN</li>
<li>while [ -x ${PIDFILE} ]</li>
<li>do</li>
<li>echo “Waiting for Redis to shutdown …”</li>
<li>sleep 1</li>
<li>done</li>
<li>echo “Redis stopped”</li>
<li>fi</li>
<li>;;</li>
<li>restart|force-reload)</li>
<li>${0} stop</li>
<li>${0} start</li>
<li>;;</li>
<li>*)</li>
<li>echo “Usage: /etc/init.d/redis {start|stop|restart|force-reload}” &gt;&amp;2</li>
<li>exit 1</li>
<li><p>esac</p>
<p>添加redis为系统的服务：</p>
</li>
<li><p>[root@localhost redis]# ll /etc/init.d/redis</p>
</li>
<li>-rw-r–r–. 1 root root 1394 Nov 24 14:06 /etc/init.d/redis</li>
<li>[root@localhost redis]# chmod +x /etc/init.d/redis</li>
<li>[root@localhost redis]# ll /etc/init.d/redis</li>
<li>-rwxr-xr-x. 1 root root 1394 Nov 24 14:06 /etc/init.d/redis</li>
<li>[root@localhost redis]#</li>
<li>[root@localhost redis]# chkconfig –add redis</li>
<li>[root@localhost redis]# chkconfig redis on</li>
<li><p>[root@localhost redis]# chkconfig</p>
</li>
<li><p>Note: This output shows SysV services only and does not include native</p>
</li>
<li>systemd services. SysV configuration data might be overridden by native</li>
<li><p>systemd configuration.</p>
</li>
<li><p>If you want to list systemd services use ‘systemctl list-unit-files’.</p>
</li>
<li>To see services enabled on particular target use</li>
<li><p>‘systemctl list-dependencies [target]‘.</p>
</li>
<li><p>netconsole      0:off   1:off   2:off   3:off   4:off   5:off   6:off</p>
</li>
<li>network         0:off   1:off   2:on    3:on    4:on    5:on    6:off</li>
<li>redis           0:off   1:off   2:on    3:on    4:on    5:on    6:off</li>
<li>[root@localhost redis]#</li>
</ol>
<p>ok，现在就安装好了。启动redis使用<code>service redis start</code> 或者<code>/etc/init.d/redis start</code> ，停止redis的命令<code>service redis stop</code> 或者<code>/etc/init.d/redis stop。</code></p>

            
            <p class="more">
                <a href="/2015/11/24/2019030500006/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img>
            <a href="/2015/11/24/2019030500006/" title="CentOS7安装redis">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/4.jpg" alt="默认配图">
                
            </a>
        </div>
    </div>
</article>

    

    
    <nav class="page-navigator">
        <a class="extend prev" rel="prev" href="/archives/2015/page/2/">前一页</a><a class="page-number" href="/archives/2015/">1</a><a class="page-number" href="/archives/2015/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/archives/2015/page/4/">4</a><a class="page-number" href="/archives/2015/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/archives/2015/page/14/">14</a><a class="extend next" rel="next" href="/archives/2015/page/4/">后一页</a>
    </nav>
    


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="/categories/MySQL/">MySQL</a>
        <span class="badge">(92)</span>
    </li>
    
    <li>
        <a href="/categories/开发语言/">开发语言</a>
        <span class="badge">(7)</span>
    </li>
    
    <li>
        <a href="/categories/Oracle/">Oracle</a>
        <span class="badge">(40)</span>
    </li>
    
    <li>
        <a href="/categories/NOSQL/">NOSQL</a>
        <span class="badge">(17)</span>
    </li>
    
    <li>
        <a href="/categories/SQL-Server/">SQL Server</a>
        <span class="badge">(13)</span>
    </li>
    
    <li>
        <a href="/categories/其他数据库/">其他数据库</a>
        <span class="badge">(4)</span>
    </li>
    
    <li>
        <a href="/categories/MySQL/Oracle/">Oracle</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="/categories/MySQL/Oracle/SQL-Server/">SQL Server</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="/categories/NOSQL/开发语言/">开发语言</a>
        <span class="badge">(1)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="/tags/MySQL/" title="MySQL">MySQL (71)</a>
  
    <a class="tag-item" href="/tags/位运算/" title="位运算">位运算 (0)</a>
  
    <a class="tag-item" href="/tags/allow/" title="allow">allow (1)</a>
  
    <a class="tag-item" href="/tags/Apache/" title="Apache">Apache (1)</a>
  
    <a class="tag-item" href="/tags/deny/" title="deny">deny (1)</a>
  
    <a class="tag-item" href="/tags/sqlplus/" title="sqlplus">sqlplus (1)</a>
  
    <a class="tag-item" href="/tags/CentOS/" title="CentOS">CentOS (2)</a>
  
    <a class="tag-item" href="/tags/druid/" title="druid">druid (1)</a>
  
    <a class="tag-item" href="/tags/心跳/" title="心跳">心跳 (1)</a>
  
    <a class="tag-item" href="/tags/redis/" title="redis">redis (6)</a>
  
    <a class="tag-item" href="/tags/分库/" title="分库">分库 (1)</a>
  
    <a class="tag-item" href="/tags/分库分表/" title="分库分表">分库分表 (1)</a>
  
    <a class="tag-item" href="/tags/分表/" title="分表">分表 (1)</a>
  
    <a class="tag-item" href="/tags/Oracle/" title="Oracle">Oracle (30)</a>
  
    <a class="tag-item" href="/tags/schedule-job/" title="schedule job">schedule job (1)</a>
  
    <a class="tag-item" href="/tags/事务/" title="事务">事务 (5)</a>
  
    <a class="tag-item" href="/tags/分布式/" title="分布式">分布式 (1)</a>
  
    <a class="tag-item" href="/tags/消息/" title="消息">消息 (1)</a>
  
    <a class="tag-item" href="/tags/KeepAlived/" title="KeepAlived">KeepAlived (1)</a>
  
    <a class="tag-item" href="/tags/数据库/" title="数据库">数据库 (7)</a>
  
    <a class="tag-item" href="/tags/结构同步/" title="结构同步">结构同步 (1)</a>
  
    <a class="tag-item" href="/tags/truncate/" title="truncate">truncate (1)</a>
  
    <a class="tag-item" href="/tags/FineReport/" title="FineReport">FineReport (1)</a>
  
    <a class="tag-item" href="/tags/SQL/" title="SQL">SQL (17)</a>
  
    <a class="tag-item" href="/tags/报表/" title="报表">报表 (1)</a>
  
    <a class="tag-item" href="/tags/数据集/" title="数据集">数据集 (1)</a>
  
    <a class="tag-item" href="/tags/Excel/" title="Excel">Excel (1)</a>
  
    <a class="tag-item" href="/tags/Sqlite/" title="Sqlite">Sqlite (1)</a>
  
    <a class="tag-item" href="/tags/批量/" title="批量">批量 (1)</a>
  
    <a class="tag-item" href="/tags/Linux/" title="Linux">Linux (2)</a>
  
    <a class="tag-item" href="/tags/Character-set/" title="Character set">Character set (1)</a>
  
    <a class="tag-item" href="/tags/NLS-LANG/" title="NLS_LANG">NLS_LANG (1)</a>
  
    <a class="tag-item" href="/tags/rowid/" title="rowid">rowid (2)</a>
  
    <a class="tag-item" href="/tags/重复/" title="重复">重复 (1)</a>
  
    <a class="tag-item" href="/tags/Hash索引/" title="Hash索引">Hash索引 (1)</a>
  
    <a class="tag-item" href="/tags/InnoDB/" title="InnoDB">InnoDB (3)</a>
  
    <a class="tag-item" href="/tags/MyISAM/" title="MyISAM">MyISAM (3)</a>
  
    <a class="tag-item" href="/tags/索引优化/" title="索引优化">索引优化 (1)</a>
  
    <a class="tag-item" href="/tags/mysqldump/" title="mysqldump">mysqldump (2)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="http://www.devba.com" target="_blank" title="软件开发吧">软件开发吧</a>
        </li>
    
        <li>
            <a href="https://www.sqlyun.cn" target="_blank" title="SQL云笔记">SQL云</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2019
    

    <a href="/">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->
<script src="/js/main.js"></script>
</body>
</html>